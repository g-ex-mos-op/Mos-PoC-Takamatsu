<html xmlns:m="http://www.seasar.org/maya" m:extends="/jsf/layout/layoutNoNavi.html" m:action="#{mosChickenInfoEditAction.initialize}">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=Windows-31j" />
  <title>ﾋﾟｰｽ・ﾏﾈｰｼﾞｬｰ予約入力（編集画面）</title>
 </head>
 <body>
  <span m:inject="f:param" m:name="layoutTitle" m:value="ﾋﾟｰｽ・ﾏﾈｰｼﾞｬｰ予約入力（編集画面）"/>
  <span m:inject="s:insert" m:name="bodyTitleName">■ﾋﾟｰｽ・ﾏﾈｰｼﾞｬｰ予約入力（編集画面）</span>
  <span m:inject="f:param" m:name="onLoadName" m:value="bodyLoad();"/>
  <span m:inject="f:param" m:name="viewIdValue" m:value="BBS016V02"/>
  <span m:inject="s:insert" m:name="body">
  <div style="margin-top:-18px">
  <STYLE type="text/css">
  <!--
   /* 入力フィールドの右詰入力へ指定するためのスタイルシート */
   .ratio_style {
     text-align       : right;
     background-color : #FFFFFF;
     color            : black;
     ime-mode         : disabled;
    }
    .scroll_area {
    	width:759px; height:230px;
    }
   //-->
  </STYLE>
  <script type="text/javascript">
   <!--
   function bodyLoad() {
	focusElement("mosChickenRevEdit");
    cancelFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:cancelFlg'].value;
    document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value = "ON";
   	if(cancelFlg == 1){
		document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:insertFin'].disabled = true;
		document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:insertNext'].disabled = true;
		document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:addNewMenu'].disabled = true;
   	}
   }
    /**
    * 登録・終了ボタン押下時処理
    */
    function updateExit(){
      loadingFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value;
      cancelFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:cancelFlg'].value;
      if(cancelFlg == 0){
         if(loadingFlg == "ON"){
	        document.mosChickenRevEdit.elements['mosChickenRevEdit:__link_clicked__'].value='mosChickenRevEdit:updateExit';
            document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value = "";
            document.mosChickenRevEdit.submit();
	     }
	  }
	  return false;
    }
    /**
    * 登録して次の新規予約ボタン押下時処理
    */
    function updateNext(){
      loadingFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value;
      cancelFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:cancelFlg'].value;
      if(cancelFlg == 0){
          if(loadingFlg == "ON"){
	          document.mosChickenRevEdit.elements['mosChickenRevEdit:__link_clicked__'].value='mosChickenRevEdit:updateNext';
              document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value = "";
         	  document.mosChickenRevEdit.submit();
          }
   	  }
	  return false;
    }
    /**
    * キャンセルボタン押下時処理
    */
    function notReserve(){
      loadingFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value;
      if(loadingFlg == "ON"){
	      document.mosChickenRevEdit.elements['mosChickenRevEdit:__link_clicked__'].value='mosChickenRevEdit:notReserve';
          document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value = "";
    	  document.mosChickenRevEdit.submit();
	  }
	  return false;
    }
    /**
    * 商品追加押下時処理
    */
    function addMenu(){
      loadingFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value;
      cancelFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:cancelFlg'].value;
      if(cancelFlg == 0){
          if(loadingFlg == "ON"){
		      document.mosChickenRevEdit.elements['mosChickenRevEdit:__link_clicked__'].value='mosChickenRevEdit:addNewMenu';
        	  document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value = "";
	    	  document.mosChickenRevEdit.submit();
		  }
	  }
	  return false;
    }

    /**
    * 戻るボタン押下時処理
    *
    */
    function execBack(confirmMsg){
     //実行前に確認アラートを出力
     cancelFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:cancelFlg'].value;
      loadingFlg = document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value;
      if(loadingFlg == "ON"){
	     if(confirm(confirmMsg)){
    	  document.mosChickenRevEdit.elements['mosChickenRevEdit:__link_clicked__'].value='mosChickenRevEdit:execBack';
          document.forms['mosChickenRevEdit'].elements['mosChickenRevEdit:loadingFlg'].value = "";
      	  document.mosChickenRevEdit.submit();
      	}
      }
    }
   -->
   </script>

   <form m:id="mosChickenRevEdit">
    <a id="execBack" m:action="#{mosChickenInfoEditAction.back}"/>
    <input type="hidden" m:id="windowId" m:value="#{mosChickenRevInfoDto.windowId}"/>
    <a id="notReserve" m:action="#{mosChickenInfoEditAction.notReserve}"/>
    <a id="updateExit" m:action="#{mosChickenInfoEditAction.updateExit}"/>
    <a id="updateNext" m:action="#{mosChickenInfoEditAction.updateNext}"/>
    <a id="addNewMenu" m:action="#{mosChickenRevAddMenuAction.addMenuInit}"/>

    <input type="hidden" m:id="viewId" m:value="#{viewIdValue}"/>
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
    <input type="hidden" m:id="cancelFlg" m:value="#{mosChickenRevInfoDto.cancelFlg}"/>
	<input type="hidden" id="loadingFlg" value="ON"/>
	<input type="hidden" id="newFlg" value="#{mosChickenRevInfoDto.newFlg}"/>
    <span>&nbsp;</span>
    <table width="740px">
     <tr>
      <td width="120px">
       <input type="button" value="戻る"
              onClick="execBack('編集中の内容がある場合は破棄されます。よろしいですか？');"
              onDblClick="return false"/>
      </td>
      <td width="85x">
       <input type="button" m:name="mosChickenRevEdit:insertFin" value="登録・終了" onClick="updateExit();" onDblClick="return false"/>
      </td>
      <td width="160px">
       <input type="button" m:name="mosChickenRevEdit:insertNext" value="登録して次の新規予約" onClick="updateNext();" DblClick="return false"/>
      </td>
      <td width="*" align="right">
       <span m:rendered="#{mosChickenRevInfoDto.newFlg == 0}">
        <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 0}">
         <input type="button" m:id="reserve" value="予約キャンセル" onClick="notReserve();" onDblClick="return false"/>
        </span>
        <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 1}">
         <input type="button" m:id="reserveNot" value="キャンセル取消" onClick="notReserve();" onDblClick="return false"/>
        </span>
       </span>
      </td>
     </tr>
    </table>
    <table class="body_table2" width="740px" style="border-bottom-width:0px;">
      <tr>
        <th nowrap="nowrap">
          タイトル</th>
        <td width="325px">
          <span m:converter="#{characterEncodingConverter}" m:value="#{mosChickenRevInfoDto.title}"/>
        </td>
        <th nowrap="nowrap">
          お渡し日</th>
        <td colspan="2">
          <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 0}">
            <div class="hideArea width_136_s">
              <select class="condition_field"
                 m:id="reservDate"
                 m:value="#{mosChickenRevInfoDto.reservDate}"
                 m:items="#{mosChickenRevInfoDto.listDate}"
                 m:itemValue="code"
		         m:itemLabel="name"
                 m:nullLabel=" ">
                 <option value="">選択</option>
              </select>
            </div>
          </span>
          <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 1}">
            <span m:value="#{mosChickenRevInfoDto.reservDate}" m:converter="#{dateConverter}"/>
          </span>
        </td>
      </tr>
      <tr>
       <th nowrap="nowrap">対象店舗</th>
       <td>
        <span m:value="#{mosChickenRevInfoDto.miseCd}"/>&nbsp;
        <span m:converter="#{characterEncodingConverter}" m:value="#{mosChickenRevInfoDto.miseNmKj}"/>
       </td>
       <th nowrap="nowrap">お渡し時間</th>
       <td m:rendered="#{mosChickenRevInfoDto.cancelFlg == 0}" colspan="2">
        <div class="hideArea">
         <select class="condition_field"
          m:id="reservHH"
          m:value="#{mosChickenRevInfoDto.reservHour}"
          m:items="#{mosChickenRevInfoDto.reservHh}"
          m:itemValue="#{mosChickenRevInfoDto.reservHh}"
          m:itemLabel="#{mosChickenRevInfoDto.reservHh}">
         </select>時
         <select class="condition_field"
          m:id="reservMM"
          m:value="#{mosChickenRevInfoDto.reservMin}"
          m:items="#{mosChickenRevInfoDto.reservMm}"
          m:itemValue="#{mosChickenRevInfoDto.reservMm}"
          m:itemLabel="#{mosChickenRevInfoDto.reservMm}">
         </select>分
        </div>
       </td>
       <td m:rendered="#{mosChickenRevInfoDto.cancelFlg == 1}" colspan="2">
        <span m:value="#{mosChickenRevInfoDto.reserveYYMM}"/>
       </td>
      </tr>
      <tr>
       <th nowrap="nowrap" colspan="3">
        備考</th>
       <th nowrap="nowrap" width="80px">
        プレミアム</th>
       <th nowrap="nowrap" width="47px">
        代金</th>
      </tr>
     <tr>
       <td colspan="3">
       	<span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 0}">
        <input class="width_530" m:id="bikou"  type="text" m:maxlength="100" size="100"
               m:value="#{mosChickenRevInfoDto.bikou}"
               converter="#{moschickenreservationCharEncConverter}"/>
        </span>
         <span m:converter="#{characterEncodingConverter}" m:rendered="#{mosChickenRevInfoDto.cancelFlg == 1}" m:value="#{mosChickenRevInfoDto.bikou}"/>
       </td>
       <td>
        <div m:rendered="#{mosChickenRevInfoDto.cancelFlg == 0}"
             class="hideArea">
         <select m:id="premiumFlg" m:name="premiumFlg" m:value="#{mosChickenRevInfoDto.premiumFlg}">
          <option value=""></option>
          <option value="1">済</option>
          <option value="0">未</option>
         </select>
        </div>
       <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 1}" m:value="#{mosChickenRevInfoDto.premiumFlg==1?'済':'未'}" />
       </td>
       <td>
        <div m:rendered="#{mosChickenRevInfoDto.cancelFlg == 0}"
             class="hideArea">
         <select m:id="paymentFlg" m:name="paymentFlg" m:value="#{mosChickenRevInfoDto.paymentFlg}">
          <option value=""></option>
          <option value="1">済</option>
          <option value="0">未</option>
         </select>
        </div>
       <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 1}" m:value="#{mosChickenRevInfoDto.paymentFlg==1?'済':'未'}" />
       </td>
     </tr>
    </table>
    <table  style="border-top-width:0px" class="body_table2" width="740px">
     <tr class="non_top_border">
      <th nowrap="nowrap" width="*">
       お買い上げ商品</th>
      <th nowrap="nowrap" class="width_136_s" width="130px">
       予約数</th>
     </tr>
    </table>
    <div class="scroll_area">
     <table style="border-top-width:0px" class="body_table2" width="740px">
      <div m:inject="s:forEach" m:items="#{mosChickenRevInfoDto.listMosChiCkenDatailInfo}" m:var="e" m:varindex="i">
       <tr class="non_top_border">
        <td align="left" width="*">
         <span m:converter="#{characterEncodingConverter}" m:value="#{e.menuCd}"/>&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{e.menuNameKj}"/>
        </td>
        <td align="right" class="width_136_s" width="130px">
        <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 0}">
         <input class="imenotuse ratio_style width_90" m:id="reserveAmt"
               type="text" m:maxlength="3" size="15" m:value="#{e.strReserveAmt}" m:converter="#{moschickenreservationNumericConverter}"/>
        </span>
        <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 1}">
         <span m:value="#{e.strReserveAmt}"/>
        </span>
        </td>
       </tr>
      </div>
     </table>
    </div>
    <table class="body_table2" width="740px">
     <tr>
      <th>メモ</th>
     </tr>
     <tr>
      <td>
       <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 0}">
        <textarea class="width_690 height_45" m:id="memo" cols="96"  m:maxlength="200" rows="3" m:value="#{mosChickenRevInfoDto.memo}" m:converter="#{moschickenreservationCharEncConverter}"></textarea>
       </span>
       <span m:rendered="#{mosChickenRevInfoDto.cancelFlg == 1}">
        <span m:rendered="#{mosChickenRevInfoDto.memo != null}">
         <textarea m:id="memo2" cols="96" m:maxlength="200" rows="3" m:value="#{mosChickenRevInfoDto.memo}" readonly="readonly" m:converter="#{moschickenreservationCharEncConverter}"></textarea>
        </span>
       </span>
       <span m:rendered="#{mosChickenRevInfoDto.memo != null}";>
        &nbsp;
       </span>
      </td>
     </tr>
    </table>
    <br/>
    <table>
     <input type="button" m:name="mosChickenRevEdit:addNewMenu"
            value="商品追加"  onClick="addMenu();" onDblClick="return false"/>
    </table>
   </form>
   </div>
  </span>
 </body>
</html>
