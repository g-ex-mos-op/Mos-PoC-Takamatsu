<html xmlns:m="http://www.seasar.org/maya" m:action="#{MssChousaDataRefAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=Windows-31j" />
    <title>ミステリーショッパーズ店舗別評価</title>
  </head>
  <body>
    <span m:inject="f:param" m:name="layoutTitle" m:value="ミステリーショッパーズ店舗別評価"/>
    <span m:inject="s:insert" m:name="bodyTitleName">ミステリーショッパーズ店舗別評価</span>
    <span m:inject="f:param" m:name="onLoadName" m:value="init();"/>
    <span m:inject="f:param" m:name="viewIdValue" m:value="BSM011V01"/>
    <span m:inject="s:insert" m:name="body">
	<style type="text/css">
    <!--
    .scroll_area {
    	overflow:auto;
    	width:820px;
    	height:400px;
    }
    -->
    </style>
      <SCRIPT LANGUAGE="javascript">
<!--
function init(){
	userTypeCode = document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:usertypeCd'].value;
	selectFlg = document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:selectH'].value;
	if(userTypeCode == '01') {
	    if(selectFlg == '0'){
		    document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:miseT'].focus();
		}else{
		    document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:onerT'].focus();
		}
	}
}
function offButtonJen(){
    document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:onerB'].disabled = true;
	document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:miseB'].disabled = true;
}
function offOn(para){
	offButtonJen();
	if(para=='1'){
		document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:onerR'].checked = true;
		document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:onerB'].disabled = false;
	}else if(para=='2'){
		document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:miseR'].checked = true;
		document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:miseB'].disabled = false;
	}
}
function offOn2(){
	offButtonJen();
	var meta = document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:selectH'].value;
	offOn(meta);
}

function search(){
    if(document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:usertypeCd'].value == '01'){
  	  onButtonJen();
    }
  	document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:__link_clicked__'].value='mssChousaDataSelect:search';
    document.forms['mssChousaDataSelect'].submit();
}

function onerSearch(){
	onButtonJen();
    document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:__link_clicked__'].value='mssChousaDataSelect:onerSearch';
    document.forms['mssChousaDataSelect'].submit();
}

function miseSearch(){
	onButtonJen();
    document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:__link_clicked__'].value='mssChousaDataSelect:miseSearch';
    document.forms['mssChousaDataSelect'].submit();
}

function onButtonJen(){
	document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:onerB'].disabled = false;
	document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:onerT'].disabled = false;
	document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:miseB'].disabled = false;
	document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:miseT'].disabled = false;
}

function download(tabIndex, listIndex) {
	document.mssChousaDataSelect.elements["mssChousaDataSelect:downloadIndex"].value=tabIndex;
	document.mssChousaDataSelect.elements["mssChousaDataSelect:listIndex"].value=listIndex;
	document.mssChousaDataSelect.elements['mssChousaDataSelect:__link_clicked__'].value='mssChousaDataSelect:download';
	document.mssChousaDataSelect.submit();
}

function doAction(){
	document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:onerS'].checked = false;
	document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:miseS'].checked = true;
}

function changeCompanyCd(){
        userTypeCode = document.forms['mssChousaDataSelect'].elements['mssChousaDataSelect:usertypeCd'].value;
        if(userTypeCode == '02'){
			document.mssChousaDataSelect.elements['mssChousaDataSelect:__link_clicked__'].value='mssChousaDataSelect:changeCompanyCd';
			document.mssChousaDataSelect.submit();
	    	return false;
	    }
}
//-->
      </SCRIPT>
	 <form m:id="mssChousaDataSelect" onKeyDown="return setDefaultSubmitButton('mssChousaDataSelect','execute');" style="float:left">
		<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
		<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
     	<input type="hidden" m:id="viewId" m:value="#{viewIdValue}"/>
     	<input type="hidden" m:id="usertypeCd" m:value="#{mssChousaDataRefDto.usertypeCd}"/>
		<input type="hidden" m:id="downloadIndex" m:value="#{mssChousaDataRefDto.downloadIndex}"/>
		<input type="hidden" m:id="listIndex" m:value="#{mssChousaDataRefDto.listIndex}"/>
		<input m:id="selectH" type="hidden" m:value="#{mssChousaDataRefDto.selectFlg}"/>
		<a id="download" m:action="#{mssChousaDownloadAction.download}"/>
		<a id="changeCompanyCd" m:action="#{MssChousaDataRefAction.changeCompany}"/>
		<table class="hiddenBody">
			<tr>
				<td>
				<span m:inject="s:selectOneRadio" m:value="#{mssChousaDataRefDto.selectFlg}">
		    	<table class="body_table">
					<tr>
						<th nowrap=" nowrap">会社</th>
						<td>
					        <div class="hideArea">
								<select class="condition_field" style="width:120px;"
										m:id="companyCd"
										m:value="#{mssChousaDataRefDto.companyCd}"
										m:items="#{mssChousaDataRefDto.companyList}"
										m:itemValue="companyCd"
										m:itemLabel="companyName"
	    								m:onChange="changeCompanyCd()">
	    							<option value="00">モスフードサービス</option>
									<option value="01">トモス</option>
									<option value="02">四季菜</option>
								</select>
						  	</div>
						</td>
						<span m:rendered="#{mssChousaDataRefDto.usertypeCd == 01}">
							<th nowrap="nowrap" style="border-right-width:0px;" valign="middle">
							  <input m:id="onerR" type="radio" name="selectFlg" m:value="1" onclick="offOn('1');"/>
						    </th>
						    <th nowrap="nowrap" style="border-left-width:0px;border-right-width:0px;" valign="middle">
						      &nbsp;オーナー&nbsp;
						    </th>
						    <th nowrap="nowrap" style="border-left-width:0px;" valign="middle">
						      <input m:name="mssChousaDataSelect:onerB" type="button" value="検索"  m:onclick="onerSearch();"/>
						    </th>
							<td>
								<input m:id="onerT" class="imenotuse" type="text" m:maxlength="5" size="15" m:value="#{mssChousaDataRefDto.onerCd}" m:converter="#{codeConerterOwner}" onFocus="offOn('1')"/>
								<a m:id="onerSearch" m:action="#{MssChousaDataRefAction.onerSearch}"/></td>
							<th nowrap="nowrap" style="border-right-width:0px;" valign="middle">
								<input m:id="miseR" type="radio" name="selectFlg" m:value="0" onclick="offOn('2');"/>
							</th>
							<th nowrap="nowrap" style="border-left-width:0px;border-right-width:0px;" valign="middle">
								&nbsp;個店&nbsp;
							</th>
							<th nowrap="nowrap" style="border-left-width:0px;" valign="middle">
								<input m:name="mssChousaDataSelect:miseB" type="button" value="検索"  m:onclick="miseSearch();"/></th>
							<td>
								<input m:id="miseT" class="imenotuse" type="text" m:maxlength="5" size="15" m:value="#{mssChousaDataRefDto.miseCd}" m:converter="#{codeConverterMise}" onFocus="offOn('2')"/>
									<a m:id="miseSearch" m:action="#{MssChousaDataRefAction.miseSrearch}"/></td>
						</span>
						<span m:rendered="#{mssChousaDataRefDto.usertypeCd == 02}">
							<th nowrap=" nowrap"><input m:id="onerS" type="radio" name="selectFlg" m:value="1"/>&nbsp;全店&nbsp;</th>
							<th nowrap=" nowrap"><input m:id="miseS" type="radio" name="selectFlg" m:value="0"/>&nbsp;店舗&nbsp;</th>
							<td>
		    					<div class="hideArea">
		                      	<select class="condition_field" style="width:250px;"
		                      	    m:value="#{mssChousaDataRefDto.miseCd}"
									m:items="#{mssChousaDataRefDto.miseList}"
									m:itemValue="miseCd"
									m:itemLabel="miseNameKj"
									m:onchange="doAction();">
									<option value="">MOS</option>
								</select>
							  </div>
							</td>
						</span>
						<th nowrap=" nowrap">実施年度</th>
						<td nowrap=" nowrap">
							<div class="hideArea">
								<select m:value="#{mssChousaDataRefDto.jissiNendo}"
									m:items="#{mssChousaDataRefDto.taishoNendo}"
									m:itemValue="#{mssChousaDataRefDto.taishoNendo}"
									m:itemLabel="#{mssChousaDataRefDto.taishoNendo}">
									<option value=""></option>
								</select>年度
							</div>
						</td>
					</tr>
			    </table>
			</span>
			</td>
			<td>&nbsp;<input m:name="mssChousaDataSelect:execute" type="button"
			              value="#{mssChousaDataRefDto.reExecuteFlg != 1?'実行':'再検索'}"
			              m:onclick="search();"/>
			  <a m:id="search" m:action="#{MssChousaDataRefAction.execute}"/>
			</td>
			</tr>
	   		<tr style="height:5px;"><td colspan="*"/></tr>
		</table>
	</form>
	<br/>
	<span m:rendered="#{mssChousaDataRefDto.fileList != null}">
	 <form m:id="viewForm">
		<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
		<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
		<table class="element_browser" cellspacing="0" cellpadding="2" style="clear:both;" width="800px;">
		  <tr>
		  	<span  m:inject="s:forEach" m:items="#{mssChousaDataRefDto.tabList}" m:var="tab" m:varindex="i">
		    <td class="tab_change_area_#{i} body_#{i==0?'':'non_'}active_cell" width="100px"
		        onClick="changeTabArea('#{i}');"
		        onMouseOver="this.style.cursor='pointer';">
	    	 	<span m:value="#{tab.tabName}" /></td>
	    	</span>
	    	<td width="*"></td>
		  </tr>
		</table>

		<div class="body_caption" style="width:800px;height:5px;"/>
    	<table class="element_browser body_table2" width="800px;">
			<tr>
				<th style="text-align:center;" width="435px">店舗</th>
				<th style="text-align:center;" width="*">分析名</th>
			</tr>
		</table>
		<div class="scroll_area">
			<span m:inject="s:forEach" m:items="#{mssChousaDataRefDto.tabList}" m:var="tab" m:varindex="i">
				<div class="element_print"><p/>【　<span m:converter="#{characterEncodingConverter}" m:value="#{tab.tabName}" />　】</div>
		    	<table class="element_print body_table2" width="800px;">
					<tr>
						<th style="text-align:center;" width="435px">店舗</th>
						<th style="text-align:center;" width="*">分析名</th>
					</tr>
				</table>
				<div class="tab_change_area_#{i} #{(i == 0) ? 'visible_tab' : 'invisible_tab'}">
			        <table class="body_table2" style="width:800px; border-top-width : 0px;">
						<div m:inject="s:forEach" m:items="#{tab.listData}" m:var="e" m:varindex="s">
							<tr class="non_top_border">
								<td width="435px">
									<span m:rendered="#{e.miseName != null}">
										<span m:converter="#{characterEncodingConverter}" m:value="#{e.miseCd}"/>&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{e.miseName}"/>
									</span>
								</td>
								<td width="*">
									<a href="javascript:download(#{i}, #{s});" title="#{e.fileName}"><span m:converter="#{characterEncodingConverter}" m:value="#{e.dataName}"/></a>
								</td>
							</tr>
			        	</div>
			    	</table>
		        </div>
	        </span>
        </div>
	<input type="text" m:id="dummyEnter" style="display:none"/>
	</form>
    </span>

	</span>
  </body>
</html>
