<html xmlns:m="http://www.seasar.org/maya" m:action="#{mssTantotenRankingAction.viewinitialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j" />
<title>店舗別ランキング</title>
<span m:inject="f:param" m:name="layoutTitle" m:value="店舗別ランキング"/>
<span m:inject="s:insert" m:name="bodyTitleName">■店舗別ランキング</span>
<span m:inject="f:param" m:name="viewIdValue" m:value="BSM010V02"/>
<span m:inject="f:param" m:name="userTypeCd" m:value="#{mssTantotenRankingRefDto.usertypeCd}" m:passthrough="true"/>
<span m:inject="f:param" m:name="onLoadName" m:value="load()"/>
</head>
<body>
<span m:inject="s:insert" m:name="body" >
<STYLE type="text/css">
<!--
/* テーブルヘッダデフォルト設定 パターン２*/
/* テーブルヘッダのセンタリング用 */
table.body_table2 tr th{
  text-align            : center;
}
/* テーブル枠の設定 */
table.tab_table{
  border-style          : solid;
  border-width          : 2px;
  border-collapse       : collapse;
}
table.data_table{
  border-style          : solid;
  border-width          : 2px;
  border-collapse       : collapse;
}
/* テーブルヘッダデフォルト設定 パターン１*/
table.data_table tr.defaultTR{
  background-color      : #FFFFCC;
}
table.data_table tr th{
  border                : 1px solid;
  text-align            : center;
}
table.data_table tr td{
  border                : 1px solid;
  text-align            : right;
}
table.data_table tr td.centerWd{
  border                : 1px solid;
  text-align            : center;
}
table.data_table tr td.leftWd{
  border                : 1px solid;
  text-align            : left;
}
table.data_table tr th a{
  color            : blue;
}
/* 表：比率項目表示 */
.hiritu_red{
  background-color      : #C0FFC0;
  color                 : red;
}
.hiritu{
  background-color      : #C0FFC0;
}
/* 表：合計欄表示（タイプ１） */
.body_sum1, table tr.body_sum1 td{
  background-color      : #FFD2E9;
}
/* 表：合計欄表示（タイプ５） */
.body_sum5, table tr.body_sum5 td{
  background-color      : #FFC0A0;
}
//-->
</STYLE>
<script type="text/javascript">
<!--
var userTypeHONBU = "01";
var userTypeONER = "02";
var userTypeMISE = "03";

/**
 * 会社プルダウンリスト変更時処理
 *
 * 会社プルダウンの値毎に
 * 対象条件プルダウンの内容を変更し、
 * 対象条件プルダウンが変更されることにより表示対象オブジェクトも変更される。
 */
function changeCompanyCd(){
}
/**
 * 支部プルダウンリスト変更時処理
 *
 */
function changeSibuCd(){
	document.conditionForm.elements['conditionForm:searchType'][0].click();
}
/**
 * SVテキストフィールド変更時処理
 */
function changeSvCd(){
	document.conditionForm.elements['conditionForm:searchType'][0].click();
}
/**
 * オーナーテキストフィールド変更時処理
 */
function changeOnerCd(){
	document.conditionForm.elements['conditionForm:searchType'][1].click();
}
/**
 * オーナーテキストフィールド変更時処理
 */
function changeMiseCd(){
	document.conditionForm.elements['conditionForm:searchType'][2].click();
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function returnLoadingStatus(){
	if(isLoadingFlgOFF()) {
		setLoadingFlg();
		return true;
	}
	return false;
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function isLoadingFlgOFF(){
	return (document.conditionForm.elements['conditionForm:loadingFlg'].value != "ON");
}
/**
 * 実行ボタン押下時処理
 *
 */
function execSearch(){
	setJokenData();
	document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:execSearch';
	document.conditionForm.submit();
}
/**
 * SV検索ボタン押下時処理
 *
 */
function searchSv(){
	if(returnLoadingStatus()){
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:searchSv';
		document.conditionForm.submit();
	}
}
/**
 * オーナー検索ボタン押下時処理
 *
 */
function searchOner(){
	if(returnLoadingStatus()){
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:searchOner';
		document.conditionForm.submit();
	}
}
/**
 * 店検索ボタン押下時処理
 *
 */
function searchMise(){
	if(returnLoadingStatus()){
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:searchMise';
		document.conditionForm.submit();
	}
}


/**
 * ウィンドウロードフラグ設定処理
 *
 *
 */
function setLoadingFlg() {
	document.conditionForm.elements['conditionForm:loadingFlg'].value = "ON";
}
function setJokenData(){
	var companyCd = "";
	var svCd = "";
	var onerCd = "";
	var miseCd = "";
	if(isUserType(userTypeHONBU)){
		//本部用
		svCd = document.conditionForm.elements['conditionForm:honbuSvCd'].value;
		onerCd = document.conditionForm.elements['conditionForm:honbuOnerCd'].value;
		miseCd = document.conditionForm.elements['conditionForm:honbuMiseCd'].value;
		
	}else if(isUserType(userTypeONER)){
		//オーナー用
	}
	document.conditionForm.elements['conditionForm:svCd'].value   =svCd;
	document.conditionForm.elements['conditionForm:onerCd'].value =onerCd;
	document.conditionForm.elements['conditionForm:miseCd'].value =miseCd;
}
function isUserType(code){
	var userType = document.conditionForm.elements['conditionForm:usertypeCd'].value;
	return (code == userType);
}

/**
 * 画面表示完了時初期化処理
 */
function load(){
	loadScroll("TantotenRankingScroll" , 325);
	var elmNendo = document.conditionForm.elements['conditionForm:nendo'];
	var elmKai = document.conditionForm.elements['conditionForm:kai'];
	document.conditionForm.elements['conditionForm:loadingFlg'].value = "";
	if(elmNendo != null && elmKai != null) {
		document.conditionForm.elements['conditionForm:executeBt'].disabled = false;
	}
}
/**
 *
 */
function changeTaB(tabarea, titlearea, anchorarea, dataarea) {
  	bodyTabChange('div','tab_area_'+num,'tab_title_area_'+num,'tab_data_area_'+num, 'th');
  	bodyAnchorStyleChange('tab_anchor_area_'+num);
}
function bodyTabChange(checkTab,tabarea,titlearea, dataarea, tabTag) {
  var objs = document.conditionForm.getElementsByTagName(checkTab);
  var tabObjs = document.conditionForm.getElementsByTagName(tabTag);
  var dispArea

//Data area Change
  for (i = 0; i < objs.length; i++) {
    if (objs[i].className == titlearea) {
      if(objs[i].style.display == "inline"){
        dispArea = objs[i].className;
      }
      objs[i].style.display = "inline";
    }else if (objs[i].className == dataarea) {
      if(objs[i].style.display == "inline"){
        dispArea = objs[i].className;
      }
      objs[i].style.display = "inline";
      objs[i].style.width = "975px";
      objs[i].style.height = "250px";
      objs[i].style.overflow = "auto";
    }else if(objs[i].className.substring(0,15) == 'tab_title_area_'){
      objs[i].style.display = "none";
    }else if(objs[i].className.substring(0,14) == 'tab_data_area_'){
      objs[i].style.display = "none";
    }else{
    }
  }
//Tab area Change
  for (t = 0; t < tabObjs.length; t++) {
    if(tabObjs[t].className == 'body_active_cell' && tabarea != tabObjs[t].id){
      tabObjs[t].className = 'body_non_active_cell';
    }else if(tabObjs[t].className == 'body_non_active_cell' && tabObjs[t].id == tabarea){
      tabObjs[t].className = 'body_active_cell';
    }
  }
}
// body area tab anchor style change (color etc)
function bodyAnchorStyleChange(anchorarea){
  var objs = document.conditionForm.getElementsByTagName('a');
  for (t = 0; t < objs.length; t++) {
  	var targetObjId = objs[t].id;
  	var targetName = targetObjId.substring((targetObjId.lastIndexOf(":")+1));
    if(targetName == anchorarea){
      objs[t].className = 'body_selected_link';
    }else if(objs[t].className == "body_selected_link"){
      objs[t].className = 'body_non_selected_link';
    }
  }
}
/**
 * 戻るボタン押下時処理
 *
 */
function execBack(){
	document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:execBack';
	document.conditionForm.submit();
}
//-->
</script>

<form m:id="conditionForm" onKeyDown="return setDefaultSubmitButton('conditionForm','executeBt');">
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<input type="hidden" m:id="viewId" m:value="#{viewIdValue}"/>
	<input type="hidden" m:id="usertypeCd" m:value="#{userTypeCd}"/>
	<input type="hidden" m:id="svCd" m:value="#{mssTantotenRankingRefDto.svCd}"/>
	<input type="hidden" m:id="onerCd" m:value="#{mssTantotenRankingRefDto.onerCd}"/>
	<input type="hidden" m:id="miseCd" m:value="#{mssTantotenRankingRefDto.miseCd}"/>
	<input type="hidden" id="loadingFlg" value=""/>
	<div class="search_condition">
		<a id="searchSv" m:action="#{mssTantotenRankingAction.callSvForm}"/>
		<a id="searchOner" m:action="#{mssTantotenRankingAction.callOnerForm}"/>
		<a id="searchMise" m:action="#{mssTantotenRankingAction.callMiseForm}"/>
		<a id="execSearch" m:action="#{mssTantotenRankingAction.execute}"/>
		<span m:converter="#{characterEncodingConverter}" m:inject="s:selectOneRadio2" m:id="searchType" m:value="#{mssTantotenRankingRefDto.searchType}">
	<table class="hiddenBody" >
		<tr>
		<td>
		<table class="body_table" style="table-layout:fixed;">
			<tr>
			<th nowrap="nowrap" width="70px">会社</th>
			<td width="117px">
			        <div class="hideArea">
						<select class="condition_field" 
								m:id="companyCd"
								m:value="#{mssTantotenRankingRefDto.companyCd}"
								m:items="#{mssTantotenRankingRefDto.companyList}"
								m:itemValue="companyCd"
								m:itemLabel="companyName"
								m:onchange="changeCompanyCd()">
							<option value="00">モスフードサービス</option>
							<option value="01">トモス</option>
							<option value="02">四季菜</option>
						</select>
				    </div>
				</td>
			<div m:rendered="#{userTypeCd == '01'}">
				<th nowrap="nowrap" style="border-right-width:0px;width:20px;" valign="middle">
				  <input type="radio" name="searchType" m:value="SV" checked="checked"/>
				</tr>
				<th nowrap="nowrap" style="border-left-width:0px;border-right-width:0px;width:35px;" valign="middle">
				  &nbsp;ＳＶ
				</th>
			    <th nowrap="nowrap" style="border-left-width:0px;width:39px;" valign="middle">
				  <input type="button" onClick="searchSv();" value="検索" onDblClick="return false;" />
				</th>
				<td width="66px">
				  <input type="text" m:id="honbuSvCd" m:value="#{mssTantotenRankingRefDto.svCd}" maxlength="8" size="10" class="imenotuse" onFocus="changeSvCd();" m:converter="#{mssTantotenRankingRefCodeConverterSv}"/>
				</td>
				<th nowrap="nowrap" style="border-right-width:0px;width:20px;" valign="middle">
				  <input type="radio" name="searchType" m:value="ONER"/>
				</th>
			    <th nowrap="nowrap" style="border-left-width:0px;border-right-width:0px;width:72px;" valign="middle">
			      &nbsp;オーナー
			    </th>
			    <th nowrap="nowrap" style="border-left-width:0px;width:39px;" valign="middle">
				  <input type="button" value="検索" onClick="searchOner();" onDblClick="return false;"/>
				</th>
				<td width="66px">
					<input type="text" m:id="honbuOnerCd" m:value="#{mssTantotenRankingRefDto.onerCd}" maxlength="5" size="10" class="imenotuse" onFocus="changeOnerCd();"/>
				</td>
				<th nowrap="nowrap" style="border-right-width:0px;width:20px;" valign="middle">	
				  <input type="radio" name="searchType" m:value="MISE"/>
				</th>  
                <th nowrap="nowrap" style="border-left-width:0px;border-right-width:0px;width:45px;" valign="middle">
                  &nbsp;個店
                </th>
                <th nowrap="nowrap" style="border-left-width:0px;width:39px;" valign="middle">
                  <input id="miseSchBtArea" type="button" value="検索" onClick="searchMise();" onDblClick="return false;" /></th>
				</th>
			    <td width="66px">
					<input type="text" m:id="honbuMiseCd" m:value="#{mssTantotenRankingRefDto.miseCd}" maxlength="5" size="10" class="imenotuse" onFocus="changeMiseCd();"/>
				</td>
			</div>
			<div m:rendered="#{userTypeCd != '01'}">
				<td colspan="2" width="149px">&nbsp;</td>
			</div>
			</tr>
			<tr>
				<th nowrap="nowrap">実施年度</th>
				<td>
		        	<span m:rendered="#{mssTantotenRankingRefDto.nendoListSize > 0}">      	
						<div class="hideArea">
						<select class="condition_field" 
								m:id="nendo"
								m:value="#{mssTantotenRankingRefDto.nendo}"
								m:items="#{mssTantotenRankingRefDto.nendoList}"
								m:itemValue="nendo"
								m:itemLabel="nendoName"
								>
								<option value="2006">2006</option>
								<option value="2005">2005</option>
								<option value="2004">2004</option>
							</select>年度
						</div>
					</span>
				</td>
				<th nowrap="nowrap" colspan="#{userTypeCd == '01'?'3':''}">実施回数</th>
				<td colspan="#{userTypeCd == '01'?'9':''}">
		        	<span m:rendered="#{mssTantotenRankingRefDto.kaiListSize > 0}">      	
						<div class="hideArea">
						第<select class="condition_field" 
								m:id="kai"
								m:value="#{mssTantotenRankingRefDto.kai}"
								m:items="#{mssTantotenRankingRefDto.kaiList}"
								m:itemValue="kai"
								m:itemLabel="kaiName"
								>
								<option value="2006">2006</option>
								<option value="2005">2005</option>
								<option value="2004">2004</option>
							</select>回
						</div>
					</span>
				</td>
				</tr>
			</table>
			</td>
			<td align="right" valign="bottom">
				&nbsp;<input type="button" name="conditionForm:executeBt" class="operation_button" value="再検索" onClick="execSearch();" onDblClick="return false" disabled=" disabled"/>
			</td>
		</tr>
	</table>
	</span>
	</div>
	<a id="execBack" m:action="#{mssTantotenRankingAction.back}"/>
	<table cellspacing="0" cellpadding="0" >
		<tr style="height:5px;"><td/></tr>
		<tr>
		<td>
			<table class="body_table2">
				<tr>
					<th>会社</th>
					<td><span m:converter="#{characterEncodingConverter}" m:value="#{mssTantotenRankingRefDto.companyName}" /></td>
					<span m:rendered="#{'SV' == mssTantotenRankingRefDto.searchType}">
						<th width="100px">SV</th>
					</span>
					<span m:rendered="#{'SV' != mssTantotenRankingRefDto.searchType}">
						<th>オーナー</th>
					</span>
					<td><span m:converter="#{characterEncodingConverter}" m:value="#{mssTantotenRankingRefDto.taishoCd}" />&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{mssTantotenRankingRefDto.taishoName}" /></td>
					<th>実施年度</th>
					<td><span m:value="#{mssTantotenRankingRefDto.taishoNendo}" />年度&nbsp;<span m:value="#{mssTantotenRankingRefDto.taishoKai}" />回</td>
				</tr>
			</table>
		</td>
		</tr>
		<tr style="height:5px;"><td/></tr>
	</table>
	

	<table cellspacing="0" cellpadding="2" class="element_browser">
	  <tr>
	    <td class="tab_change_area_0 body_active_cell"
	    onClick="changeTabArea('0')" width="100px"
	    onMouseOver="this.style.cursor='pointer';">ランキング</td>
	    <td class="tab_change_area_1 body_non_active_cell"
	    onClick="changeTabArea('1')" width="100px" 
	    onMouseOver="this.style.cursor='pointer';">構成比</td>
	  </tr>
	</table>

	<div class="scroll_hidden">	
	<table  class="body_caption" width="98%" cellspacing="0" cellpadding="0">
	  <tr style="height:5px;"><td colspan="*"/></tr>
	</table>
	</div>	

	<div class="tab_change_area_0 visible_tab">
	<div class="element_print"><p/>【　ランキング　】</div>
	  <div class="scroll_hidden">
		<table class="body_table2" width="98%">
			<tr>
				<th width="80px" rowspan="2">ランキング</th>
				<th width="*" rowspan="2">店舗名</th>
				<th colspan="2">今回</th>
				<th colspan="3">前回</th>
			</tr>
			<tr>
				<th width="80px">全国順位</th>
				<th width="109px">総合ポイント</th>
				<th width="80px">ランキング</th>
				<th width="80px">全国順位</th>
				<th width="109px">総合ポイント</th>
			</tr>
		</table>
	  </div>
	  <div id="TantotenRankingScroll" class="scroll_standby">
			<table class="body_table2" style="border-top-width : 0px;" width="98%">
				<div m:inject="s:forEach" m:items="#{mssTantotenRankingRefDto.rankingList}" m:var="e" m:varindex="i">
			      <tr class="#{e.spcFlg != '1'?'defaultTR':'body_sum5'} non_top_border">
			        <td width="80px" m:rendered="#{e.spcFlg != '1'}" align="right"><span m:converter="#{characterEncodingConverter}" m:value="#{e.rank}"/>位</td>
			        <td width="*" m:rendered="#{e.spcFlg == '1'}">特殊店</td>
			        <td class="leftWd"><span m:converter="#{characterEncodingConverter}" m:value="#{e.miseCd}" />&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{e.miseNameKj}" /></td>
			        <td width="80px" align="right"><span m:value="#{e.zenRank}" m:converter="#{numConverter}"/><span m:value="#{e.spcFlg != '1'?'位':''}"/></td>
			        <td width="109px" align="right"><span m:value="#{e.hyoukaData}" m:converter="#{numConverter}" /></td>
			        <td width="80px" align="right"><span m:value="#{e.rankZennen}"/><span m:value="#{e.spcFlg != '1' && e.rankZennen != null && e.rankZennen != ''?'位':''}"/></td>
			        <td width="80px" align="right"><span m:value="#{e.zenRankZennen}"/><span m:value="#{e.spcFlg != '1' && e.zenRankZennen != null && e.zenRankZennen != ''?'位':''}"/></td>
			        <td width="109px" align="right"><span m:value="#{e.hyoukaDataZennen}" m:converter="#{numConverter}" /></td>
				  </tr>
		 		</div>
			</table>
	  </div>
	</div>
	
	<div class="tab_change_area_1 invisible_tab">
	<div class="element_print"><p/>【　構成比　】</div>
	  <div class="scroll_hidden">
		<table class="body_table2" width="98%">
			<tr>
				<th width="*">&nbsp;</th>
				<th width="160px">49点以下</th>
				<th width="160px">50点〜69点</th>
				<th width="160px">70点〜89点</th>
				<th width="160px">90点以上</th>
				<th width="160px">統計</th>
			</tr>
		</table>
	  </div>
	  <div class="scroll_standby">
		<table class="body_table2" width="98%" style="border-top-width : 0px;">
			<div m:inject="s:forEach" m:items="#{mssTantotenRankingRefDto.kouseiHiList}" m:var="kouseihi" m:varindex="i">
		      <tr class="defaultTR non_top_border">
		        <th width="*" rowspan="2" nowrap="nowrap"><span m:value="#{i == 0?'担当店':'全国平均'}"/></th>
			    <td width="160px" align="right"><span m:value="#{kouseihi.misecnt1}" m:converter="#{numConverter}" />店</td>
			    <td width="160px" align="right"><span m:value="#{kouseihi.misecnt2}" m:converter="#{numConverter}" />店</td>
			    <td width="160px" align="right"><span m:value="#{kouseihi.misecnt3}" m:converter="#{numConverter}" />店</td>
			    <td width="160px" align="right"><span m:value="#{kouseihi.misecnt4}" m:converter="#{numConverter}" />店</td>
			    <td width="160px" align="right"><span m:value="#{kouseihi.allMisecnt}" m:converter="#{numConverter}" />店</td>		    
		      </tr>
		      <tr width="*" class="defaultTR">
			    <td width="160px" align="right"><span m:value="#{kouseihi.kouseihi1}" m:converter="#{numConverter}" />％</td>
			    <td width="160px" align="right"><span m:value="#{kouseihi.kouseihi2}" m:converter="#{numConverter}" />％</td>
			    <td width="160px" align="right"><span m:value="#{kouseihi.kouseihi3}" m:converter="#{numConverter}" />％</td>
			    <td width="160px" align="right"><span m:value="#{kouseihi.kouseihi4}" m:converter="#{numConverter}" />％</td>
			    <td width="160px" align="right">100.00％</td>		    
		      </tr>
			</div>
		</table>
		<table width="98%">
			<td align="right">上段：実数／下段：構成比</td>
		</table>
	  </div>
	</div>
	<input type="text" m:id="dummyEnter" style="display:none"/>
</form>
</span>
</body>
</html>
