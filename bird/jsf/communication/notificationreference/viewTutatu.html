<html xmlns:m="http://www.seasar.org/maya"
      m:action="#{notificationReferenceAction.initialize}"
      m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j"/>
<meta http-equiv="Content-Style-Type" content="text/css"/>
<meta http-equiv="Content-Script-Type" content="text/javascript"/>
<title>お知らせ照会</title>
</head>
<body>
<span m:inject="f:param" m:name="layoutTitle" m:value="お知らせ照会"/>
<span m:inject="s:insert" m:name="bodyTitleName">■お知らせ照会</span>
<span m:inject="f:param" m:name="onLoadName" m:value="load()"/>
<span m:inject="f:param" m:name="viewIdValue" m:value="BCM002V01"/>
<div m:inject="s:insert" m:name="body">
<style type="text/css">
<!--
.table_width{
  width				: 98%;
}
.selectFile {
  font-size:11px;
}
-->
</style>
<form m:id="notificationreference" style="display:inline">
<a m:action="#{notificationReferenceAction.search}" m:id="searchLink"/>
<a m:action="#{notificationReferenceAction.download}" m:id="downloadLink"/>
<a m:action="#{notificationReferenceDownloadTenpuAction.download}" m:id="downloadTenpuLink"/>
<a m:action="#{notificationReferenceAction.changePage}" m:id="changePageLink"/>
<a m:action="#{notificationReferenceAction.changeTab}" m:id="changeTabLink">
    <span m:id="selectCateId" m:inject="f:param" m:name="selectCateId"/>
</a>
<a m:action="#{notificationReferenceAction.changePage}" m:id="changePage">
	<span m:inject="f:param" m:id="selectPageNumber" m:name="selectPageNumber"/>
</a>
<input type="hidden" name="pmossFlg" m:value="#{birdUserInfo.pmossles?'true':'false'}" m:passthrough="true"/>
<input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
<input type="hidden" m:id="downloadIndex" m:value="#{notificationReferenceDto.downloadIndex}"/>
<input type="hidden" m:id="downloadFileName" m:value="#{notificationReferenceDto.downloadFileName}"/>
<input type="hidden" m:id="selectedAttachFileIndex" m:value="#{notificationReferenceDto.selectedAttachFileIndex}" />
<table width="100%" cellspacing="0" cellpadding="0">
  <tr>
    <td>
	  <table cellspacing="0" cellpadding="0">
	    <tr>
		  <td>
		    <table class="body_table">
			  <tr>
			    <th>公開開始月</th>
			    <td>
			      <div class="hideArea">
			        <select m:value="#{notificationReferenceDto.inputPubDate}"
			                m:items="#{notificationReferenceDto.pubDateList}"
			           		m:id="inputPubDate"
			                m:itemValue="value"
			                m:itemLabel="label">
					  <option value="200708">2007/08</option>
					  <option value="200707">2007/07</option>
					  <option value="200706">2007/06</option>
			        </select> 〜
			        <select m:value="#{notificationReferenceDto.inputPubDateTo}"
			           		m:items="#{notificationReferenceDto.pubDateList}"
			           		m:id="inputPubDateTo"
			                m:itemValue="value"
			                m:itemLabel="label">
					  <option value="200708">2007/08</option>
					  <option value="200707">2007/07</option>
					  <option value="200706">2007/06</option>
			        </select>
			      </div>
			    </td>
			    <th>業態</th>
			    <td>
			      <div class="hideArea">
			        <select m:value="#{notificationReferenceDto.inputGyotaiKbn}"
			                m:items="#{notificationReferenceDto.gyotaiList}"
			                m:itemValue="gyotaiKbn"
			                m:itemLabel="gyotaiKbnName"
			                m:nullLabel=" ">
			          <option value="">全社</option>
			          <option value="">モスフードサービス</option>
			        </select>
			      </div>
			    </td>
			  </tr>
			  <tr m:rendered="#{birdUserInfo.pmossles==false}">
			    <th>全文検索</th>
			    <td>
			      <input class="width_180" type="text" size="33" m:id="inputSearchWord" m:value="#{notificationReferenceDto.inputSearchWord}"/>
			    </td>
			    <th>タイトル</th>
			    <td>
			      <input class="width_180" m:id="inputTitle" type="text" m:value="#{notificationReferenceDto.inputTitle}" size="30" maxlength="80"/>
			    </td>
			  </tr>
			</table>
		  </td>
	      <td valign="bottom">
		    <input type="button" value="検索" class="operation_button"
				   style="margin-left:5px;margin-bottom:2px;"
			       m:id="searchBtn" m:action="#{notificationReferenceAction.search}"
			       m:onclick="exec()"/>
		  </td>
		</tr>
	  </table>
    </td>
	<td align="right" valign="bottom">
	  <div m:id="pane_result_btn" m:rendered="#{!notificationReferenceDto.emptyCategoryList}">
	    <input type="button" value="最初へ" m:disabled="#{notificationReferenceDto.firstPage}"
	           m:onclick="return execPage(#{notificationReferenceDto.firstPageNumber});"/>
		<input type="button" value="前へ" m:disabled="#{!notificationReferenceDto.existPreviousPage}"
		       m:onclick="return execPage(#{notificationReferenceDto.previousPageNumber});"/>
		<input type="button" value="次へ" m:disabled="#{!notificationReferenceDto.existNextPage}"
		       m:onclick="return execPage(#{notificationReferenceDto.nextPageNumber});"/>
		<input type="button" value="最後へ" m:disabled="#{notificationReferenceDto.lastPage}"
		       m:onclick="return execPage(#{notificationReferenceDto.lastPageNumber});"/>
		  &nbsp;&nbsp;<span m:value="#{notificationReferenceDto.currentPageNumber}"/> / <span m:value="#{notificationReferenceDto.lastPageNumber}"/>&nbsp;ページ
	  </div>
    </td>
  </tr>
</table>
</form>
<form m:id="tutatuList" style="clear:both;margin-top:0px">
<div m:id="pane_result">
<div m:rendered="#{fullTextSearchTutatuDto.matchingDataCount == 0 && notificationReferenceDto.emptyTutatuList==false}">
	<!-- カテゴリ タブ -->
	<table cellpadding="0" cellspacing="0" style="margin-top:5px;">
		<tr m:inject="s:forEach" m:items="#{notificationReferenceDto.categoryList}" m:var="e" m:varindex="i">
			<th style="float:left; white-space:nowrap;"
			    class="body_#{e.cateId == notificationReferenceDto.cateId?'':'non_'}active_cell #{e.cateId == notificationReferenceDto.cateId?'':'element_browser'}"
			    onClick="#{e.cateId != notificationReferenceDto.cateId?'return tabChange(\'':''}#{e.cateId != notificationReferenceDto.cateId?e.cateId:''}#{e.cateId != notificationReferenceDto.cateId?'\');':''}"
			    onMouseOver="this.style.cursor='pointer';">&nbsp;&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{e.cateName}"/>&nbsp;&nbsp;
			</th>
		</tr>
	</table>
	<div class="scroll_padding_head">
	<div class="scroll_hidden margin_bottom_4">
	<table class="table_width" cellspacing="0" cellpadding="0"><tr class="body_caption" style="height:5px;"><td width="100%"/></tr></table>
	<table class="body_table2 table_width" style="border-top-width:0px;">
	  <tr class="header_row">
	  	<th width="110px">公開開始日</th>
	  	<th width="*">タイトル</th>
	  	<th width="300px">関連ファイル</th>
	  </tr>
	</table>
	</div>
	</div>
	<div class="scroll_padding_data">
	<div id="viewTutatuScroll0" class="scroll_standby font_size_15">
	<table class="body_table2 table_width" style="border-top-width:0px">
	    <div m:inject="s:forEach" m:items="#{notificationReferenceDto.tutatuList}" m:var="e" m:varindex="i">
		<tr class="#{i==0?'non_top_border':''}" style="#{e.listAttachFileSize != 0 ? 'line-height:24px;':''}">
			<td width="110px"><span m:value="#{e.pubDate}" m:converter="#{dateCnvtSlashYMDW}"/></td>
			<td width="*" class="visitelink">
			  <a href="#{request.contextPath}/jsf/communication/notificationreference/viewTutatu.html?notificationreference:_link_hidden_=notificationreference:downloadLink&notificationreference_/jsf/communication/notificationreference/viewTutatu.html_SUBMIT=1&notificationreference:viewId=#{viewIdValue}&notificationreference:initMenuId=#{menuAction.initMenuId}&notificationreference:initSubMenuId=#{menuAction.initSubMenuId}"
			     title="#{e.fileName}"><span m:id="downloadFileName"
			                                 m:inject="f:param"
			                                 m:name="downloadFileName"
			                                 m:value="#{e.fileName}"/><span m:value="#{e.title}" m:converter="#{characterEncodingConverter}"/></a></td>
			<td width="300px">
				<div m:rendered="#{e.listAttachFileSize != 0}">
				    <div class="hideArea">
					<select class="condition_field #{birdUserInfo.browserType =='safari'?'font_size_10':'selectFile'}"
							m:id="kanrenFile"
							m:items="#{e.listAttachFile}"
							m:itemValue="value"
							m:itemLabel="label"
							m:nullLabel="">
						<option value="">添付ファイル１</option>
						<option value="">添付ファイル２</option>
					</select><br/>
					<input type="button" value="ダウンロード" m:onclick="return downloadTenpu(#{i})"/>&nbsp;
					</div>
				</div>
			</td>
		</tr>
		</div>
	</table>
    </div>
    </div>
</div>
<!--全文検索-->
<div m:rendered="#{fullTextSearchTutatuDto.matchingDataCount>=1 && notificationReferenceDto.emptyTutatuList==false}">
	<div class="scroll_padding_head">
	<div class="scroll_hidden ">
	<table class="body_table2 table_width"style="margin-top:5px;">
        <tr class="header_row">
          <th width="110px">カテゴリー</th>
          <th width="112px">公開開始日</th>
          <th width="*">タイトル（関連ファイル）</th>
        </tr>
    </table>
    </div>
	</div>
	<div class="scroll_padding_data">
    <div id="viewTutatuScroll1" class="scroll_standby">
	<table class="body_table2 table_width" style="border-top-width:0px;table-layout:fixed;">
	    <div m:inject="s:forEach" m:items="#{notificationReferenceDto.tutatuList}" m:var="e" m:varindex="i">
		<tr class="#{i==0?'non_top_border':''}" style="#{e.listAttachFileSize != 0 ? 'line-height:24px;':''}">
			<td width="110px"><span m:converter="#{characterEncodingConverter}" m:value="#{e.cateName}"}/></td>
			<td width="112px"><span m:value="#{e.pubDate}" m:converter="#{dateCnvtSlashYMDW}"/></td>
			<td width="*" class="visitelink">
			  <a href="#{request.contextPath}/jsf/communication/notificationreference/viewTutatu.html?notificationreference:_link_hidden_=notificationreference:downloadLink&notificationreference_/jsf/communication/notificationreference/viewTutatu.html_SUBMIT=1&notificationreference:viewId=#{viewIdValue}&notificationreference:initMenuId=#{menuAction.initMenuId}&notificationreference:initSubMenuId=#{menuAction.initSubMenuId}" title="#{e.fileName}">
			      <span m:converter="#{characterEncodingConverter}" m:id="downloadFileName" m:inject="f:param" m:name="downloadFileName" m:value="#{e.fileName}"/>
				  <span m:converter="#{characterEncodingConverter}" m:value="#{e.title}"/></a>
				<div m:rendered="#{e.listAttachFileSize != 0}">
				    <div class="hideArea">
					<select class="condition_field"
					        m:id="kanrenFileUltra"
							m:items="#{e.listAttachFileFullTextSearch}"
							m:itemValue="value"
							m:itemLabel="label"
							m:nullLabel="">
						<option value="">添付ファイル１</option>
						<option value="">添付ファイル２</option>
					</select>
					<input type="button" value="ダウンロード" m:onclick="return downloadTenpuFullTextSearch(#{i})"/>
					</div>
				</div>
			</td>
		</tr>
		<tr>
		    <th width="110px">要約</th>
		    <td colspan="2" width="*"><span m:converter="#{characterEncodingConverter}" m:value="#{e.description}"}/></td>
		</tr>
		</div>
	</table>
	</div>
	</div>
</div>
</div>
<input type="text" m:id="dummyEnter" style="display:none"/>
</form>
<div m:id="pane_waitmsg" style="display:none">
<p/>
<span style="font-weight:bold;">検索しています。しばらくお待ち下さい・・・</span>
</div>

<script type="text/javascript">
<!--
var scrollMaxHeightTitle = 379;
var scrollMaxHeightFile = 405;
function load(){
    //P-mosslesの場合
	if(document.notificationreference.pmossFlg.value !=null
	   && document.notificationreference.pmossFlg.value == "true") {
	    scrollMaxHeightTitle = 440;
	}
    loadScroll("viewTutatuScroll0",scrollMaxHeightTitle);
    loadScroll("viewTutatuScroll1",scrollMaxHeightFile);
	focusElement("notificationreference");
}
function execVisite(filename) {
	var objsA = (document.getElementById("tutatuList:pane_result")).getElementsByTagName("a");
	if(objsA != null) {
		var i=-1;
		for(i=0;objsA.length>i;i++) {
			if(filename == objsA[i].title) {
				break;
			}
		}
		if(i>=0) {
			//お知らせファイルダウンロード実行
//			download(i);
			window.open();
		}
	}
}
function download(index) {
    if (document.getElementById("notificationreference:searchBtn").disabled) {
        return false;
    }
    document.getElementById("notificationreference:searchBtn").disabled = false;
	document.notificationreference.elements["notificationreference:downloadIndex"].value=index;
	document.notificationreference.elements['notificationreference:__link_clicked__'].value='notificationreference:downloadLink';
	document.notificationreference.submit();
}
function downloadTenpu(index) {
    if (document.getElementById("notificationreference:searchBtn").disabled) {
        return false;
    }
	document.notificationreference.elements["notificationreference:downloadIndex"].value=index;
	var elementName = targetElementName("tutatuList","kanrenFile", index);
	var sindex = document.tutatuList.elements[elementName].selectedIndex;
	var selectedFileIndex = document.tutatuList.elements[elementName].options[sindex].value;
	document.notificationreference.elements["notificationreference:selectedAttachFileIndex"].value=selectedFileIndex;
	document.notificationreference.elements['notificationreference:__link_clicked__'].value='notificationreference:downloadTenpuLink';
	document.notificationreference.submit();
	return true;
}
function downloadTenpuFullTextSearch(index) {
    if (document.getElementById("notificationreference:searchBtn").disabled) {
        return false;
    }
	document.notificationreference.elements["notificationreference:downloadIndex"].value=index;
	var elementName = targetElementName("tutatuList","kanrenFileUltra", index);
	var sindex = document.tutatuList.elements[elementName].selectedIndex;
	var selectedFileIndex = document.tutatuList.elements[elementName].options[sindex].value;
	document.notificationreference.elements["notificationreference:selectedAttachFileIndex"].value=selectedFileIndex;
	document.notificationreference.elements['notificationreference:__link_clicked__'].value='notificationreference:downloadTenpuLink';
	document.notificationreference.submit();
	return true;
}
function exec() {
    document.getElementById("notificationreference:searchBtn").disabled = true;
    document.getElementById("tutatuList:pane_result").style.display = "none";
    if(document.getElementById("notificationreference:pane_result_btn") != null) {
    	document.getElementById("notificationreference:pane_result_btn").style.display = "none";
    }
    document.getElementById("pane_waitmsg").style.display = "inline";
    document.notificationreference.elements['notificationreference:__link_clicked__'].value='notificationreference:searchLink';
    document.notificationreference.submit();
}
function execPage(selectPageNumber) {
    if (document.getElementById("notificationreference:searchBtn").disabled) {
        return;
    }
    document.notificationreference.elements["selectPageNumber"].value = selectPageNumber;
    document.notificationreference.elements['notificationreference:__link_clicked__'].value='notificationreference:changePage';
    document.notificationreference.submit();
}
function tabChange(cateId) {
    if (document.getElementById("notificationreference:searchBtn").disabled) {
        return false;
    }
    document.notificationreference.elements["selectCateId"].value = cateId;
    document.notificationreference.elements['notificationreference:__link_clicked__'].value='notificationreference:changeTabLink';
    document.notificationreference.submit();
    return true;
}
function downLoadLink(viewId,initMenuId,initSubMenuId,fileName) {
	document.notificationreference.elements['notificationreference:__link_clicked__'].value='notificationreference:downloadLink';
	document.notificationreference.elements['notificationreference:viewId'].value = viewId;
	document.notificationreference.elements['notificationreference:initMenuId'].value = initMenuId;
	document.notificationreference.elements['notificationreference:initSubMenuId'].value = initSubMenuId;
	document.notificationreference.elements['notificationreference:downloadFileName'].value = fileName;
	document.notificationreference.submit();
}
//-->
</script>
</div>
</body>
</html>
