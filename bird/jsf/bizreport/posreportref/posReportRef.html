<html xmlns:m="http://www.seasar.org/maya" m:action="#{PosReportRefAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j"/>
<title>POS速報</title>
</head>
<body>
<span m:inject="f:param" m:name="layoutTitle" m:value="POS速報"/>
<span m:inject="s:insert" m:name="bodyTitleName">■POS速報</span>
<span m:inject="f:param" m:name="onLoadName" m:value="bodyLoad();"/>
<span m:inject="f:param" m:name="viewIdValue" m:value="BBR006V01"/>
<span m:inject="f:param" m:name="isExistSearchData"
 m:value="#{posReportRefDto.listPosReportMiseInfo != null && posReportRefDto.posReportMiseInfoSize > 0}"/>
<span m:inject="s:insert" m:name="body">
<STYLE type="text/css">
<!--
.data_table_width {
    width:98%;
}
.miseName_width {
    width:*;
    font-weight:bold;
}
.shukei_width {
    width:40px;
}
.kinken_width {
    width:60px;
}
.kingaku_width {
    width:100px;
}
.to_width {
    width:90px;
}
.kyakusu_width {
    width:70px;
}
//-->
</STYLE>
	<form m:id="jokenForm">
	    <input type="hidden" m:id="viewId" m:value="#{viewIdValue}"/>
	    <input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	    <input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
		<input type="hidden" m:id="companyCd" m:value="#{posReportRefDto.companyCd}" />
		<input type="hidden" m:id="taishoJoken" m:value="#{posReportRefDto.taishoJoken}" />
		<input type="hidden" m:id="hyojiTaisho" m:value="#{posReportRefDto.hyojiTaisho}" />
		<input type="hidden" m:id="hyojiTaishoName" m:value="#{posReportRefDto.hyojiTaishoName}" />
		<input type="hidden" name="usertypeCd" m:value="#{birdUserInfo.mstUser.userTypeCd}" m:passthrough="true"/>
		<a m:id="search"  m:action="#{PosReportRefAction.search}"/>
		<input type="text" m:id="dummyEnter" style="display:none"/>
	</form>
	<table class="body_table2" style="margin-bottom:4px;" style="display:inline;">
		<tr><th>処理日付</th>
		<td><span m:value="#{posReportRefDto.latestDateDay}"/>&nbsp;</td>
		</tr></table>
	<form m:id="conditionForm" class="element_browser" style="display:inline;">
	   <!--条件項目テーブル(本部ユーザーのみ表示-->
	   <table m:rendered="#{'01' == birdUserInfo.mstUser.userTypeCd}"
	          class="hiddenBody element_browser" style="margin-bottom:4px;">
	   <tr><td>
	   <table class="body_table">
			<tr>
				<th>対象条件</th>
				<td>
					<div class="hideArea">
						<select class="condition_field"
							m:value="#{posReportRefDto.taishoJoken}"
							m:items="#{posReportRefDto.listTaishoJoken}"
							m:id="taishoJoken"
							m:itemValue="code"
							m:itemLabel="value"
							m:onchange="changeTaishoJoken(this);"/></div></td>
				<th>表示対象</th>
				<td>
					<div class="hideArea">
						<div m:inject="s:forEach"
	               m:items="#{posReportRefDto.listHyojiTaisho}"
	               m:var="e" m:varindex="i">
	            		<select m:rendered="#{e.listData != null}" class="hyojiTaisho_#{e.key}"
			                m:items="#{e.listData}"
			                m:id="hyojiTaishoPdwn"
			                m:value="#{posReportRefDto.hyojiTaisho}"
			                m:itemValue="hyojitaishoCd"
			                m:itemLabel="hyojitaishoName"
			                style="#{posReportRefDto.taishoJoken==e.key?'':'display:none;'}"/></div></div></td>
			</tr>
	    </table></td>
	   <td align="right"><input type="button" value="実行"
	          style="margin-left:3px;"
	          onClick="search();" onDblClick="return false;"/></td>
	   </tr></table>
	</form>
	<span m:rendered="#{'02' == birdUserInfo.mstUser.userTypeCd && isExistSearchData==false}">対象のデータが存在しません</span>

	<form m:id="posReportRefMise" target = "_blank" style="display:inline;">
	    <input type="hidden" m:id="viewId" m:value="#{viewIdValue}"/>
	    <input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	    <input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
		<input type="hidden" m:value="#{posReportRefDto.latestDate}" />
		<input type="hidden" m:value="#{posReportRefDto.companyCd}" />
	    <input type="hidden" m:id="miseCd" m:value="#{posReportRefDto.miseCd}" m:converter="#{codeConverter5}"/>
	    <input type="hidden" m:id="newWindowFlg" m:value=""/>
		<a id="misePosRefSerch" m:action="#{PosReportRefMiseAction.misePosRefSerch}"/>
		<span m:rendered="#{isExistSearchData}">
		<table class="body_table2"
		       style="margin-bottom:4px;">
			<tr><th>表示対象</th>
	     		<td><span m:rendered="#{'02' == birdUserInfo.mstUser.userTypeCd}">
	     				<span m:converter="#{characterEncodingConverter}" m:value="#{posReportRefDto.hyojiTaisho}"/>&nbsp;</span>
	     				<span m:converter="#{characterEncodingConverter}" m:value="#{posReportRefDto.hyojiTaishoName}"/>&nbsp;</td></tr></table>
			<div class="scroll_padding_head">
			<div class="scroll_hidden element_browser margin_bottom_hidden">
			<!--タブ表示テーブル(List[[タブ]]でタブ件数分for分処理で設定します。)-->
			<table cellspacing="0" cellpadding="0" class="data_table_width">
				<tr>
				<span m:inject="s:forEach" m:items="#{posReportRefDto.listTab}"
			         m:var="tab" m:varindex="tabIndex">
					<td width="150px" class="body_#{tabIndex>0?'non_':''}active_cell tab_change_area_#{tabIndex}">
						<a href ="javascript:changeTabArea(#{tabIndex});"
							m:passthrough="true"><span m:converter="#{characterEncodingConverter}" m:value="#{tab.label}"/></a></td></span>
				<td width="*">&nbsp;</td></tr>
				<!--タブ帯-->
				<tr class="body_caption" style="height:5px;"><td colspan="3"></td></tr>
			</table>
		    <table class="body_table2 data_table_width">
		     <tr class="header_row">
		      <th class="miseName_width">店名称</th>
		      <th class="shukei_width">集計</th>
		      <th class="kyakusu_width">総客数</th>
		      <th class="kingaku_width">総売上</th>
		      <th class="kingaku_width">Ｅ／I</th>
		      <th class="to_width">Ｔ／Ｏ</th>
		      <th class="kinken_width">ＴＥＬ</th>
		      <th class="kinken_width">Ｄ／T</th>
		      <th class="kinken_width">その他</th>
		     </tr>
		    </table>
		    </div>
		    </div>
		    <div class="scroll_padding_data">
		    <div class="scroll_standby" id="posreportScroll">
			<span m:inject="s:forEach" m:items="#{posReportRefDto.listTab}"
		         m:var="tab" m:varindex="tabIndex">
				<!--検索結果表示テーブル(List[[タブ]]でタブ件数分for分処理で設定します。)-->
			    <div class="#{tabIndex>0?'in':''}visible_tab tab_change_area_#{tabIndex}">
				<span class="element_print" m:value="【#{tabIndex==0?'売上':'件数'}タブ】"/>
			     <table class="body_table2 data_table_width" style="border-top:0px;">
			     <tr class="header_row element_print">
			      <th class="miseName_width">店名称</th>
			      <th class="shukei_width">集計</th>
			      <th class="kyakusu_width">総客数</th>
			      <th class="kingaku_width">総売上</th>
			      <th class="kingaku_width">Ｅ／I</th>
			      <th class="to_width">Ｔ／Ｏ</th>
			      <th class="kinken_width">ＴＥＬ</th>
			      <th class="kinken_width">Ｄ／T</th>
			      <th class="kinken_width">その他</th>
			     </tr>
			      <span m:inject="s:forEach"
			            m:items="#{posReportRefDto.listPosReportMiseInfo}" m:var="report" m:varindex="d">
			       <tr m:class="#{report.miseCd=='TOTAL'?'body_sum5':''} non_top_border font_size_13">
			        <td class="miseName_width"><span m:rendered="#{report.miseCd!='TOTAL'}">
				         <a href="javascript:void(0);" m:onclick="execMiseInfo('#{report.miseCd}');return false;"
				            title="#{report.miseCd}"><span m:converter="#{characterEncodingConverter}" m:value="#{report.miseCd}"/>&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{report.miseNameKj}"/></a></span>
			         <span m:rendered="#{report.miseCd=='TOTAL'}">
			         	<span m:converter="#{characterEncodingConverter}" m:value="#{report.miseNameKj}" /></span></td>
			        <td class="shukei_width"><span m:converter="#{characterEncodingConverter}" m:value="#{report.shuSysTime}"
			                                       m:converter="#{timeConverter}"/></td>
			        <td class="body_num kyakusu_width"><span m:value="#{report.allKen}" m:converter="#{numericConverter}"/></td>
			        <td class="body_num kingaku_width"><span m:value="#{report.allKin}" m:converter="#{numericConverter}"/></td>
			        <td class="body_num kingaku_width"><span m:value="#{tabIndex==0?report.eatKin:report.eatKen}" m:converter="#{numericConverter}"/></td>
			        <td class="body_num to_width"><span m:value="#{tabIndex==0?report.takeKin:report.takeKen}" m:converter="#{numericConverter}"/></td>
			        <td class="body_num kinken_width"><span m:value="#{tabIndex==0?report.telKin:report.telKen}" m:converter="#{numericConverter}"/></td>
			        <td class="body_num kinken_width"><span m:value="#{tabIndex==0?report.driveKin:report.driveKen}" m:converter="#{numericConverter}"/></td>
			        <td class="body_num kinken_width"><span m:value="#{tabIndex==0?report.otherKin:report.otherKen}" m:converter="#{numericConverter}"/></td>
			       </tr>
			      </span>
			     </table></div>
		    </span>
		    </div>
		    </div>
		</span>
	<input type="text" m:id="dummyEnter" style="display:none"/>
	</form>
<script type="text/javascript">
<!--
var userTypeHONBU = "01";
var userTypeONER = "02";
var userTypeMISE = "03";
var scrollMaxHeight = 350;
// 初期設定
/**
 * ユーザータイプ判別処理
 *
 */
function isUserType(code){
	var userType = document.jokenForm.usertypeCd.value;
	return (code == userType);
}
	    function bodyLoad() {
		    if(isUserType(userTypeHONBU)){
			}
			else {
				scrollMaxHeight = 365;
			}
			loadScroll("posreportScroll", scrollMaxHeight);
	    }
		function changeTaishoJoken(taishoJokenPldwn) {
		    var objForm = document.conditionForm;
		    var taishoJokenIndex = taishoJokenPldwn.selectedIndex;
		    var taishoJokenValue = taishoJokenPldwn.options[taishoJokenIndex].value;
			var dispHyojiTaishoPldwnElement = null;
		    for (i = 0; i < objForm.elements.length; i++) {
		    	var className = objForm.elements[i].name;
		        if (objForm.elements[i].name.indexOf('hyojiTaishoPdwn') > 0) {
		        	var hyojiTaishoPldwn = document.getElementById(objForm.elements[i].name);
		            hyojiTaishoPldwn.selectedIndex = 0;
		            hyojiTaishoPldwn.style.display = 'none';
		            if(hyojiTaishoPldwn.className.indexOf(taishoJokenValue) > 0) {
		            	dispHyojiTaishoPldwnElement = hyojiTaishoPldwn;
		            }
		        }
		    }
		    dispHyojiTaishoPldwnElement.style.display = 'inline';
		}
		/**
		 * 実行ボタン押下処理
		 */
		function search(){
			var objForm = document.conditionForm;
			var tIndex = objForm.elements["conditionForm:taishoJoken"].selectedIndex;
			var taishoJoken = objForm.elements["conditionForm:taishoJoken"].options[tIndex].value;

		    var hIndex = "";
		    var hyojiTaisho = "";
		    var hyojiTaishoName = "";
		    for (i = 0; i < objForm.elements.length; i++) {
		    	var className = objForm.elements[i].name;
		        if (objForm.elements[i].name.indexOf('hyojiTaishoPdwn') > 0) {
		        	var hyojiTaishoPldwn = document.getElementById(objForm.elements[i].name);
		            if(hyojiTaishoPldwn.style.display != 'none') {
		                 hIndex = hyojiTaishoPldwn.selectedIndex;
		                 hyojiTaisho = hyojiTaishoPldwn.options[hIndex].value;
		                 hyojiTaishoName = hyojiTaishoPldwn.options[hIndex].text;
		                 break;
		            }
		        }
		    }
			document.jokenForm.elements["jokenForm:taishoJoken"].value=taishoJoken;
			document.jokenForm.elements["jokenForm:hyojiTaisho"].value=hyojiTaisho;
			document.jokenForm.elements["jokenForm:hyojiTaishoName"].value=hyojiTaishoName;
			document.jokenForm.elements['jokenForm:__link_clicked__'].value='jokenForm:search';
			document.jokenForm.submit();
		}
		// 店リンク押下処理
		function execMiseInfo(miseCd){
			var formMiseList = document.posReportRefMise
			formMiseList.elements["posReportRefMise:miseCd"].value=miseCd;
			formMiseList.elements['posReportRefMise:__link_clicked__'].value='posReportRefMise:misePosRefSerch';
			formMiseList.submit();
		}
	-->
	</script>
</span>
</body>
</html>
