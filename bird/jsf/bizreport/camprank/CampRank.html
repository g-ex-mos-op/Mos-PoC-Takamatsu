<html xmlns:m="http://www.seasar.org/maya" m:action="#{camprankCampRankAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j"/>
<title>キャンペーンベスト１００</title>
</head>
<body>
<span m:inject="f:param" m:name="layoutTitle" m:value="キャンペーンベスト１００"/>
<span m:inject="s:insert" m:name="bodyTitleName">■キャンペーンベスト１００</span>
<span m:inject="f:param" m:name="viewIdValue" m:value="BBR013V01"/>
<span m:inject="f:param" m:name="onLoadName" m:value="onLoadFunction()"/>
<div m:inject="s:insert" m:name="body">
<style type="text/css">
<!--
.rsttable_w {
    width:98%;
}
.rsttable_w1 {
    width:5%;
}
.rsttable_w2 {
    width:15%;
}
.rsttable_w3 {
    width:29%;
}
.rsttable_w4 {
    width:8%;
}
.rsttable_w5 {
    width:9%;
}
.rsttable_w6 {
    width:10%;
}
.rsttable_w7 {
    width:9%;
}
.rsttable_w8 {
    width:9%;
}
.rsttable_w9 {
    width:6%;
}

@media print {
	.btnExecute {
	    display: none;
	}
}

-->
</style>

<script type="text/javascript">
<!--
function onLoadFunction() {
    document.forms['camprank'].elements['camprank:loadingFlg'].value = "";
    if (document.forms['camprank'].elements['camprank:condCampId'] != null) {
        switchCamp();
    }
    loadScroll("camprankScroll", 379);
}
function execFunction() {
    if (returnLoadingStatus()) {
	    var objForm = document.forms['camprank'];
	    objForm.elements['camprank:targetDtSelectedIndex'].value =
	        objForm.elements[objForm.elements['camprank:activeSelect'].value].selectedIndex;
	    if (objForm.elements['camprank:flgTargetWindowView'] != null
	            &&objForm.elements['camprank:flgTargetWindowView'].checked)
	    {
	        document.camprank.target = "_blank";
	        objForm.elements['camprank:flgTargetWindow'].value = objForm.elements['camprank:flgTargetWindowView'].checked;
	        document.forms['camprank'].elements['camprank:loadingFlg'].value = "";
	    }
	    else {
	        objForm.elements['camprank:flgTargetWindow'].value = false;
	        document.camprank.target = "_self";
	    }
	    dispWaitMsg();
		document.forms['camprank'].elements['camprank:__link_clicked__'].value='camprank:doExecute';
		document.forms['camprank'].submit();
	}
}
function dispWaitMsg() {
	if (document.camprank.target == "_self") {
	    document.getElementById("camprank:doExecuteBtn").disabled = true;
	    document.getElementById("camprank:pane_result").style.display = "none";
	    document.getElementById("camprank:pane_waitmsg").style.display = "inline";
	}
}
function switchCamp() {
    var objForm = document.forms['camprank'];
    var index = objForm.elements['camprank:condCampId'].selectedIndex;

    var objs = document.camprank.getElementsByTagName('select');
    for (i = 0; i < objs.length; i++) {
        if (objs[i].name.indexOf(':condTargetDt') > 0) {
            document.getElementById(objs[i].name).style.display = 'none';
        }
        if (objs[i].name.indexOf('_' + index + ':condTargetDt') > 0) {
            document.getElementById(objs[i].name).style.display = 'inline';
            objForm.elements['camprank:activeSelect'].value = objs[i].name;
        }
    }
}
function downloadCsv() {
    if(isLoadingFlgOFF()){
		document.camprank.target = "_self";
		document.forms['camprank'].elements['camprank:__link_clicked__'].value='camprank:doCsvDownload';
		document.forms['camprank'].submit();
		return;
	}
}
function tabChange(condMode) {
    if (returnLoadingStatus()) {
        dispWaitMsg();
	    document.forms['camprank'].elements['camprank:condMode'].value = condMode;
		document.camprank.target = "_self";
		document.forms['camprank'].elements['camprank:__link_clicked__'].value='camprank:tabChange';
		document.forms['camprank'].submit();
	}
}
function returnLoadingStatus(){
	if(isLoadingFlgOFF()) {
		setLoadingFlg();
		return true;
	}
	return false;
}
function isLoadingFlgOFF(){
	return (document.camprank.elements['camprank:loadingFlg'].value != "ON");
}
function setLoadingFlg() {
	document.camprank.elements['camprank:loadingFlg'].value = "ON";
}
-->
</script>

<form m:id="camprank" target="_self">
<input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
<input type="hidden" m:id="windowId" m:value="#{camprankCampRankCondDto.windowId}"/>
<input type="hidden" m:id="targetDtSelectedIndex" m:value="#{camprankCampRankCondDto.targetDtSelectedIndex}"/>
<input type="hidden" m:id="activeSelect"/>
<input type="hidden" id="loadingFlg" value=""/>
<input type="hidden" m:id="condMode" m:value="#{camprankCampRankCondDto.condMode}"/>
<input type="hidden" m:id="flgTargetWindow" m:value="#{camprankCampRankCondDto.flgTargetWindow}"/>
<a m:id="tabChange" m:action="#{camprankCampRankAction.doTabChange}"/>
<a m:id="doCsvDownload" m:action="#{camprankCampRankAction.doCsvDownload}"/>
<a m:id="doExecute" m:action="#{camprankCampRankAction.doExecute}"/>


<span m:rendered="#{camprankCampRankDto.listCampPulldownSize == 0}">
  <p/><span style="font-weight:bold;">現在表示期間中のキャンペーンは存在しません。</span>
</span>
<span m:rendered="#{camprankCampRankDto.listCampPulldownSize != 0}">
<table class="hiddenBody" style="margin-bottom:4px;">
	<tr><td>
<table class="body_table">
  <tr>
    <th>キャンペーン</th>
    <td>
        <div class="hideArea">
		<select class="condition_field"
				m:value="#{camprankCampRankCondDto.condCampId}"
				m:items="#{camprankCampRankDto.listCampPulldown}"
				m:id="condCampId"
				m:itemValue="code"
				m:itemLabel="name"
				m:onchange="switchCamp();"/>
		</div>
    </td>
    <th>順位</th>
    <td>
        <div class="hideArea">
		<select class="condition_field"
				m:value="#{camprankCampRankCondDto.condRank}"
				m:items="#{camprankCampRankDto.listRankPulldown}"
				m:id="condRank"
				m:itemValue="code"
				m:itemLabel="name"/>
		</div>
    </td>
    <th>対象日</th>
    <td>
        <div m:inject="s:forEach"
             m:items="#{camprankCampRankDto.listTargetDtPulldown}"
             m:var="e" m:varindex="i">
            <div class="hideArea">
			<select class="condition_field"
				m:items="#{e}"
				m:id="condTargetDt"
				m:itemValue="code"
				m:itemLabel="name"
				style="display:none;"/>
			</div>
        </div>
    </td>
  </tr>
</table>
		</td>
		<td style="padding-left:3px;">
<input type="button" m:id="doExecuteBtn"
       value="#{camprankCampRankCondDto.listResult != null ? '再検索' : '実行'}"
       onclick="execFunction();" class="btnExecute"/></td>
   </tr>
</table>

<div m:id="pane_waitmsg" style="display:none;font-weight:bold;">
	<p/>検索しています。しばらくお待ち下さい・・・</div>
<div m:id="pane_result">
<div m:rendered="#{camprankCampRankCondDto.listResult != null}">
<div class="scroll_padding_head">
<div class="scroll_hidden margin_bottom_hidden">
<table class="hiddenBody" style="width:98%;margin-bottom:4px;">
	<tr><td>
		<table class="body_table2 infotable_w">
		    <col style="width:100px;"/>
		    <col m:rendered="#{camprankCampRankCondDto.condMode == '1'}" style="width:100px;"/>
		    <col m:rendered="#{camprankCampRankCondDto.condMode == '2'}" style="width:200px;"/>
		    <col style="width:100px;"/>
		    <col style="width:70px;"/>
		    <tr class="header_row">
		        <th>対象期間</th>
		        <td class="#{camprankCampRankCondDto.condMode == '2'?'width_203_s':' '}">
		          <span m:rendered="#{camprankCampRankCondDto.condMode == '1'}">
		              <span m:value="#{camprankCampRankCondDto.condTargetDt}" m:converter="#{camprankDateConverter}"/>
		          </span>
		          <span m:rendered="#{camprankCampRankCondDto.condMode == '2'}">
		              <span m:value="#{camprankCampRankCondDto.campFrom}" m:converter="#{camprankDateConverter}"/>&nbsp;〜
		              <span m:value="#{camprankCampRankCondDto.condTargetDt}" m:converter="#{camprankDateConverter}"/>
		          </span>
		        </td>
		        <th>対象店舗数</th>
		        <td style="text-align:right;">
		          <span m:value="#{camprankCampRankCondDto.taishoTenpoCount}" m:converter="#{camprankDigit0Converter}"/>
		        </td>
		    </tr>
		</table>
	</td>
	<td align="right">
		<table class="hiddenBody">
			<tr><td>
			  <input type="button" value="ダウンロード" onclick="javascript:downloadCsv();"/></td>
			  <td><input type="checkbox" m:id="flgTargetWindowView" />別ウィンドウに表示</td>
			</tr>
		</table>
	</td>
	</tr>
	</table>

<table class="element_browser" width="98%" cellspacing="0" cellpadding="0">
	<tr>
		<td class="body_#{camprankCampRankCondDto.condMode == '1'?'':'non_'}active_cell" width="120px">
			<a href="#" onclick="javascript:tabChange('1');return false;">対象日</a>
		</td>
		<td class="body_#{camprankCampRankCondDto.condMode == '2'?'':'non_'}active_cell" width="120px">
			<a href="#" onclick="javascript:tabChange('2');return false;">期間合計</a>
		</td>
		<td width="*" align="right" valign="bottom" style="font-weight:bold;">&nbsp;
			<span m:rendered="#{'1'==camprankCampRankCondDto.condRank}">※「順位」は金額構成比の絶対値に基づき表示しています。</span></td>
    </tr>
	<tr class="body_caption" style="height:5px;"><td colspan="3"/></tr>
</table>
<div class="element_print">
	<table width="98%"><tr><td>【 <span m:value="#{camprankCampRankCondDto.condMode == '1'?'対象日':'期間合計'}"/>タブ 】</td>
	           <td align="right" style="font-weight:bold;"><span m:rendered="#{'1'==camprankCampRankCondDto.condRank}">※「順位」は金額構成比の絶対値に基づき表示しています。</span>
	           </td></tr></table></div>
<table class="body_table2 rsttable_w">
    <col class="rsttable_w1"/>
    <col class="rsttable_w2"/>
    <col class="rsttable_w3"/>
    <col class="rsttable_w4"/>
    <col class="rsttable_w5" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"/>
    <col class="rsttable_w6"/>
    <col class="rsttable_w7" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"/>
    <col class="rsttable_w8" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"/>
    <col class="rsttable_w9"/>
    <tr class="header_row">
        <th>順位</th>
        <th>支部名称</th>
        <th>店名称</th>
        <th>販売個数</th>
        <th m:rendered="#{!camprankCampRankDto.remoteLimitFlg}">販売金額</th>
        <th>金額構成比</th>
        <th m:rendered="#{!camprankCampRankDto.remoteLimitFlg}">売上</th>
        <th m:rendered="#{!camprankCampRankDto.remoteLimitFlg}">前年売上</th>
        <th>前年比</th>
    </tr>
</table>
</div>
</div>
<div class="scroll_padding_data">
<div class="scroll_standby" id="camprankScroll">
<table class="body_table2 rsttable_w" style="border-top-width : 0px;">
    <col class="rsttable_w1"/>
    <col class="rsttable_w2"/>
    <col class="rsttable_w3"/>
    <col class="rsttable_w4"/>
    <col class="rsttable_w5" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"/>
    <col class="rsttable_w6"/>
    <col class="rsttable_w7" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"/>
    <col class="rsttable_w8" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"/>
    <col class="rsttable_w9"/>
    <span m:inject="s:forEach" m:items="#{camprankCampRankCondDto.listResult}" m:var="e" m:varindex="i">
    <tr class="non_top_border">
        <td class="body_num"><span m:converter="#{characterEncodingConverter}" m:value="#{e.rank}"/></td>
        <td ><span m:converter="#{characterEncodingConverter}" m:value="#{e.sibuName}"/></td>
        <td ><span m:converter="#{characterEncodingConverter}" m:value="#{e.miseCd}"/>&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{e.miseNameKj}"/></td>
        <td class="body_num"><span m:value="#{e.hanbaiKosu}" m:converter="#{camprankDigit0Converter}"/></td>
        <td class="body_num" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"><span m:value="#{e.hanbaiKin}" m:converter="#{camprankDigit0Converter}"/></td>
        <td class="body_num"><span m:value="#{e.kingakuKoseiHi}" m:converter="#{camprankDigit2Converter}"/></td>
        <td class="body_num" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"><span m:value="#{e.uriage}" m:converter="#{camprankDigit0Converter}"/></td>
        <td class="body_num" m:rendered="#{!camprankCampRankDto.remoteLimitFlg}"><span m:value="#{e.zenUriage}" m:converter="#{camprankDigit0Converter}"/></td>
        <td m:class="#{e.zennenHiClass}" width="6%"><span m:value="#{e.zennenHi}" m:converter="#{camprankDigit2Converter}"/></td>
    </tr>
    </span>
</table>
</div>
</div>
</div>
</div>
</span>
	<input type="text" m:id="dummyText" m:style="display:none;"/>
</form>
</div>
</body>
</html>
