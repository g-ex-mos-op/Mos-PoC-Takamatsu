SELECT (CASE WHEN BD11.MENU_BUNRUI IS NULL  THEN 1
        ELSE 2 END) AS ROW_RANK
,      (CASE WHEN BD11.MENU_BUNRUI IS NULL  THEN 'TOTAL' 
             WHEN BD11.MENU_BUNRUI IS NOT NULL AND BD11.MENU_CD IS NULL THEN 'MBUNRUI' 
        ELSE '' END) AS ROW_TYPE
,      BD11.COMPANY_CD
,      BD11.MENU_BUNRUI
,      BD11.MBUNRUI_NAME_KJ
,      BD11.MENU_CD
,      (CASE WHEN BD11.MENU_BUNRUI IS NULL  THEN 'çáåv' 
			 WHEN BD11.MENU_BUNRUI IS NOT NULL AND BD11.MENU_CD IS NULL THEN CONCAT(RTRIM(BD11.MBUNRUI_NAME_KJ) ,'åv')
        ELSE RTRIM(BD11.MENU_NAME_KJ) END) AS MENU_NAME_KJ
,      BD11.KOSU_EAT
,      DECIMAL(CASE WHEN BD11.KOSU_EAT IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_EAT)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_EAT
,      BD11.KOSU_TAKE
,      DECIMAL(CASE WHEN BD11.KOSU_TAKE IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_TAKE)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_TAKE
,      BD11.KOSU_TEL
,      DECIMAL(CASE WHEN BD11.KOSU_TEL IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_TEL)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_TEL
,      BD11.KOSU_DRIVE
,      DECIMAL(CASE WHEN BD11.KOSU_DRIVE IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_DRIVE)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_DRIVE
,      BD11.KOSU_TAKUHAI
,      DECIMAL(CASE WHEN BD11.KOSU_TAKUHAI IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_TAKUHAI)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_TAKUHAI
,      BD11.KOSU_GAIHAN
,      DECIMAL(CASE WHEN BD11.KOSU_GAIHAN IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_GAIHAN)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_GAIHAN
,      BD11.KOSU_SYUBETSU_07
,      DECIMAL(CASE WHEN BD11.KOSU_SYUBETSU_07 IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_SYUBETSU_07)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_SYUBETSU_07
,      BD11.KOSU_SYUBETSU_08
,      DECIMAL(CASE WHEN BD11.KOSU_SYUBETSU_08 IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_SYUBETSU_08)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_SYUBETSU_08
,      BD11.KOSU_SYUBETSU_09
,      DECIMAL(CASE WHEN BD11.KOSU_SYUBETSU_09 IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_SYUBETSU_09)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_SYUBETSU_09
,      BD11.KOSU_SYUBETSU_10
,      DECIMAL(CASE WHEN BD11.KOSU_SYUBETSU_10 IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_SYUBETSU_10)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_SYUBETSU_10
,      BD11.KOSU_NET_TAKE
,      DECIMAL(CASE WHEN BD11.KOSU_NET_TAKE IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_NET_TAKE)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_NET_TAKE
,      BD11.KOSU_NET_TAKUHAI
,      DECIMAL(CASE WHEN BD11.KOSU_NET_TAKUHAI IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_NET_TAKUHAI)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_NET_TAKUHAI
,      BD11.KOSU_SYUBETSU_13
,      DECIMAL(CASE WHEN BD11.KOSU_SYUBETSU_13 IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_SYUBETSU_13)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_SYUBETSU_13
,      BD11.KOSU_SYUBETSU_14
,      DECIMAL(CASE WHEN BD11.KOSU_SYUBETSU_14 IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_SYUBETSU_14)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_SYUBETSU_14
,      BD11.KOSU_SYUBETSU_15
,      DECIMAL(CASE WHEN BD11.KOSU_SYUBETSU_15 IS NULL OR BD11.KOSU_ALL=0 THEN 0.00
                    ELSE (DOUBLE(BD11.KOSU_SYUBETSU_15)/DOUBLE(BD11.KOSU_ALL))*100+0.005
                    END,11,2)  AS KOSU_KOUSEI_HI_SYUBETSU_15
FROM (
        SELECT BD10orBD11.COMPANY_CD
        ,      PC10.MENU_BUNRUI 
        ,      PC11.MBUNRUI_NAME_KJ 
        ,      BD10orBD11.MENU_CD 
        ,      PC10.MENU_NAME_KJ
		,      SUM(BD10orBD11.KAZU_EAT) AS KOSU_EAT
		,      SUM(BD10orBD11.KAZU_TAKE) AS KOSU_TAKE
		,      SUM(BD10orBD11.KAZU_TEL) AS KOSU_TEL
		,      SUM(BD10orBD11.KAZU_DRIVE) AS KOSU_DRIVE
		,      SUM(BD10orBD11.KAZU_TAKUHAI) AS KOSU_TAKUHAI
		,      SUM(BD10orBD11.KAZU_GAIHAN) AS KOSU_GAIHAN
		,      SUM(BD10orBD11.KAZU_OTHER_1) AS KOSU_SYUBETSU_07
		,      SUM(BD10orBD11.KAZU_OTHER_2) AS KOSU_SYUBETSU_08
		,      SUM(BD10orBD11.KAZU_OTHER_3) AS KOSU_SYUBETSU_09
		,      SUM(BD10orBD11.KAZU_OTHER_4) AS KOSU_SYUBETSU_10
		,      SUM(BD10orBD11.KAZU_OTHER_5) AS KOSU_NET_TAKE
		,      SUM(BD10orBD11.KAZU_OTHER_6) AS KOSU_NET_TAKUHAI
		,      SUM(BD10orBD11.KAZU_OTHER_7) AS KOSU_SYUBETSU_13
		,      SUM(BD10orBD11.KAZU_OTHER_8) AS KOSU_SYUBETSU_14
		,      SUM(BD10orBD11.KAZU_OTHER_9) AS KOSU_SYUBETSU_15
		,      SUM(BD10orBD11.KAZU_EAT + BD10orBD11.KAZU_TAKE 
				   + BD10orBD11.KAZU_TEL + BD10orBD11.KAZU_DRIVE
				   + BD10orBD11.KAZU_TAKUHAI
		           + BD10orBD11.KAZU_GAIHAN
		           + BD10orBD11.KAZU_OTHER_1+BD10orBD11.KAZU_OTHER_2+BD10orBD11.KAZU_OTHER_3+BD10orBD11.KAZU_OTHER_4
		           + BD10orBD11.KAZU_OTHER_5+BD10orBD11.KAZU_OTHER_6+BD10orBD11.KAZU_OTHER_7+BD10orBD11.KAZU_OTHER_8
		           + BD10orBD11.KAZU_OTHER_9) AS KOSU_ALL
        FROM BD22NMSR BD10orBD11
        LEFT JOIN PC10SMNU PC10 ON (BD10orBD11.MENU_CD = PC10.MENU_CD)
        LEFT JOIN PC11MBUN PC11 ON (PC11.MENU_BUNRUI = PC10.MENU_BUNRUI)
        WHERE BD10orBD11.COMPANY_CD = /*companyCd*/'00'
        AND   BD10orBD11.MENU_YM = /*kikanSitei*/'20080515'
        /*IF taishoJoken.equals("SIBU") */  
        AND   BD10orBD11.SIBU_CD    = /*hyojiTaisho*/'031'
        /*END*/
        GROUP BY ROLLUP (
               (BD10orBD11.COMPANY_CD
               )
        ,      (BD10orBD11.COMPANY_CD, PC10.MENU_BUNRUI , PC11.MBUNRUI_NAME_KJ)
        ,      (BD10orBD11.COMPANY_CD, PC10.MENU_BUNRUI , PC11.MBUNRUI_NAME_KJ
              , BD10orBD11.MENU_CD, PC10.MENU_NAME_KJ)
        )
) BD11
WHERE COMPANY_CD IS NOT NULL
ORDER BY COMPANY_CD
,        ROW_RANK
,        MENU_BUNRUI
,        MENU_CD
