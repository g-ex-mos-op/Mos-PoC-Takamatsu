SELECT A.EIGYO_DT
,    MAX(A.COMPANY_CD) AS COMPANY_CD
,    MAX(A.MISE_CD) AS MISE_CD
,    MAX(A.UP_FLG) AS UP_FLG
,    MAX(A.UP_DT) AS UP_DT
,    MAX(A.BATUP_DT) AS BATUP_DT
,    MAX(A.UP_NO) AS UP_NO
,    SUM(A.U01_URIAGE1) AS URIAGE1
,    SUM(A.U02_URIAGE2) AS URIAGE2
,    SUM(A.U03_URIAGE3) AS URIAGE3
,    SUM(A.U04_URIAGE4) AS URIAGE4
,    SUM(A.U05_URIAGE5) AS URIAGE5
,    SUM(A.U06_TAX1) AS TAX1
,    SUM(A.U07_TAX2) AS TAX2
,    SUM(A.U08_TAX3) AS TAX3
,    SUM(A.U09_TAX4) AS TAX4
,    SUM(A.U10_TAX5) AS TAX5
,    MAX(A.FIRST_USER) AS FIRST_USER
,    MAX(A.FIRST_PGM)  AS FIRST_PGM
,    MAX(A.FIRST_TMSP) AS FIRST_TMSP
,    MAX(A.LAST_USER)  AS LAST_USER
,    MAX(A.LAST_PGM)   AS LAST_PGM
,    MAX(A.LAST_TMSP)  AS LAST_TMSP
FROM
(
SELECT
	COALESCE(BD66.EIGYO_DT,BD65.EIGYO_DT) AS EIGYO_DT,
	COALESCE(BD66.COMPANY_CD,BD65.COMPANY_CD) AS COMPANY_CD,
	COALESCE(BD66.MISE_CD,BD65.MISE_CD) AS MISE_CD,
	COALESCE(BD66.UP_FLG,'0') AS UP_FLG,
	COALESCE(BD66.UP_DT,'') AS UP_DT,
	COALESCE(BD66.BATUP_DT,'') AS BATUP_DT,
	COALESCE(BD66.UP_NO,'0000000000') AS UP_NO,
	COALESCE(BD66.U01_URIAGE1,BD65.URIAGE1) AS U01_URIAGE1,
	COALESCE(BD66.U02_URIAGE2,BD65.URIAGE2) AS U02_URIAGE2,
	COALESCE(BD66.U03_URIAGE3,BD65.URIAGE3) AS U03_URIAGE3,
	COALESCE(BD66.U04_URIAGE4,BD65.URIAGE4) AS U04_URIAGE4,
	COALESCE(BD66.U05_URIAGE5,BD65.URIAGE5) AS U05_URIAGE5,
	COALESCE(BD66.U06_TAX1,BD65.TAX1) AS U06_TAX1,
	COALESCE(BD66.U07_TAX2,BD65.TAX2) AS U07_TAX2,
	COALESCE(BD66.U08_TAX3,BD65.TAX3) AS U08_TAX3,
	COALESCE(BD66.U09_TAX4,BD65.TAX4) AS U09_TAX4,
	COALESCE(BD66.U10_TAX5,BD65.TAX5) AS U10_TAX5,
	COALESCE(BD66.FIRST_USER,'') AS FIRST_USER,
	COALESCE(BD66.FIRST_PGM,'') AS FIRST_PGM,
	COALESCE(BD66.FIRST_TMSP,BD65.FIRST_TMSP) AS FIRST_TMSP,
	COALESCE(BD66.LAST_USER,'') AS LAST_USER,
	COALESCE(BD66.LAST_PGM,'') AS LAST_PGM,
	COALESCE(BD66.LAST_TMSP,BD65.LAST_TMSP) AS LAST_TMSP
FROM
(
SELECT
    BD65.COMPANY_CD,
    BD65.MISE_CD,
    BD65.EIGYO_DT,
    DECIMAL(BD65.URIAGE1, 7, 0) AS URIAGE1,
    DECIMAL(BD65.URIAGE2, 7, 0) AS URIAGE2,
    DECIMAL(BD65.URIAGE3, 7, 0) AS URIAGE3,
    DECIMAL(BD65.URIAGE4, 7, 0) AS URIAGE4,
    DECIMAL(BD65.URIAGE5, 7, 0) AS URIAGE5,
    BD65.TAX1,
    BD65.TAX2,
    BD65.TAX3,
    BD65.TAX4,
    BD65.TAX5,
    BD65.FIRST_TMSP,
    BD65.LAST_TMSP
FROM
    BD65SADM BD65
WHERE
      BD65.COMPANY_CD = /*companyCd*/'00'
AND   BD65.MISE_CD = /*miseCd*/'04413'
AND   SUBSTR(BD65.EIGYO_DT, 1, 6) = /*targetYM*/'201807'
    ) BD65
    LEFT OUTER JOIN BD66ADUM BD66 ON
       BD65.COMPANY_CD = BD66.COMPANY_CD
AND    BD65.MISE_CD = BD66.MISE_CD
AND    BD65.EIGYO_DT = BD66.EIGYO_DT
) A
GROUP BY ROLLUP (A.EIGYO_DT)
ORDER BY A.EIGYO_DT
