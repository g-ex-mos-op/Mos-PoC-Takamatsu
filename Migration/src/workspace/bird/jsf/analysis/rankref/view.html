<html xmlns:m="http://www.seasar.org/maya" m:action="#{rankRefViewAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j" />
<title>売上ランク</title>
<span m:inject="f:param" m:name="layoutTitle" m:value="売上ランク"/>
<span m:inject="s:insert" m:name="bodyTitleName">■売上ランク</span>
<span m:inject="f:param" m:name="viewIdValue" m:value="#{rankRefReqDto.viewId}"/>
<span m:inject="f:param" m:name="userTypeCd" m:value="#{rankRefSesDto.userTypeCd}"/>
<span m:inject="f:param" m:name="onLoadName" m:value="load()"/>
<span m:inject = "f:param" m:name = "msg" m:value="結果が表示されるまでに時間がかかります。よろしいですか？"/>
</head>
<body>
<span m:inject="s:insert" m:name="body" >
<STYLE type="text/css">
<!--
/* テーブルヘッダデフォルト設定 パターン２*/
table.body_table2 tr td {
	text-align            : right;
}
table.body_table2 tr td.leftArea {
	text-align            : left;
}
/* 表：比率項目表示 */
table.body_table2 tr td.hiritu_red{
  background-color      : #C0FFC0;
  color                 : red;
}
table.body_table2 tr td.hiritu{
  background-color      : #C0FFC0;
}
.data_table_width {
    width:98%;
}
.width_Mise {
    width:*;
}
.width_Rank {
    width:30px;
}
.width_Kingaku {
    width:100px;
}
.width_Kyakusu {
    width:70px;
}
.width_Hiritu {
    width:60px;
}

//-->
</STYLE>
<script type="text/javascript">
<!--
var userTypeHONBU = "01";
var userTypeONER = "02";
var userTypeMISE = "03";
var scrollMaxHeight = 358;

function load(){
	if(document.conditionForm != null && document.conditionForm.elements['conditionForm:windowId'] != null) {
		document.conditionForm.elements['conditionForm:loadingFlg'].value = "";
		if(document.conditionForm.elements['downloadBt'] != null) {
			document.conditionForm.elements['downloadBt'].disabled = "";
		}
  	}
  	loadScroll("renkScroll", scrollMaxHeight);
  	focusElement('conditionForm');
}
/**
 * 対象期間プルダウンリスト変更時処理
 *
 * 対象期間プルダウンの値毎に
 * 期間指定プルダウンの内容を変更される。
 */
function changeTaishoKikan(changeElement){
    //選択した対象期間の値を取得します。
    var selectedCode = changeElement.options[changeElement.selectedIndex].value;
    //対象期間別期間指定プルダウン設定処理
    changeDisplay("select", "pdwn_taishoKikan_", selectedCode);
	//期間指定プルダウンリストエレメント取得処理
	var	elementPullDown = getTargetElement("select", "pdwn_taishoKikan_", selectedCode);
	if(elementPullDown != null) {
		elementPullDown.selectedIndex=0;
	}
}
/**
 * 検索条件値設定処理
 *
 */
function setJokenData(){
	var targetForm = document.conditionForm;
    //選択した対象期間の値を取得します。
    elementTarget = targetForm.elements['conditionForm:taishoKikan'];
    var taishoKikan = elementTarget.options[elementTarget.selectedIndex].value;
	//期間指定プルダウンリストエレメント取得処理
	var	elementPullDown = getTargetElement("select", "pdwn_taishoKikan_", taishoKikan);
	var kikanSitei = "";
	if(elementPullDown != null) {
		kikanSitei = elementPullDown.options[elementPullDown.selectedIndex].value;
	}
	targetForm.elements['conditionForm:kikanSitei'].value=kikanSitei;
}
/**
 * 検索ボタン押下時処理
 *
 */
function search(){
	if(returnLoadingStatus()){
		setJokenData();
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:search';
		if(document.conditionForm.elements['conditionForm:newWindowFlg'].value=='true') {
			//別ウィンドウフラグがチェックされている場合。
			document.conditionForm.target ="_blank";
			document.conditionForm.elements['conditionForm:loadingFlg'].value = "";
		}else{
			//自画面へリクエストする場合。
			document.conditionForm.target ="_self";
//			if(document.getElementById("pane_result") != null) {
//			  	document.getElementById("pane_result").style.display = "none";
//			}
//			document.getElementById("pane_waitmsg").style.display = "inline";
		}
		//ランク対象を”売上”に指定します。
		document.conditionForm.elements['conditionForm:rankTarget'].value="URIAGE";
		document.conditionForm.submit();
	}
}
/**
 * ランク対象タブ押下時処理
 */
function changeTab(aElement) {
	if(returnLoadingStatus()){
		//検索条件値設定処理
		setJokenData();
		//照会用ランク対象へパラメータrankTargetを設定します。
		document.conditionForm.elements['conditionForm:view_rankTarget'].value=aElement.name;
		//自画面へリクエストする場合。
		document.conditionForm.target ="_self";
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:changeTab';
		//サブミット実行
		document.conditionForm.submit();
	}
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function returnLoadingStatus(){
	if(isLoadingFlgOFF()) {
		setLoadingFlg();
		return true;
	}
	return false;
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function isLoadingFlgOFF(){
	return (document.conditionForm.elements['conditionForm:loadingFlg'].value != "ON");
}
/**
 * ウィンドウロードフラグ設定処理
 *
 *
 */
function setLoadingFlg() {
	document.conditionForm.elements['conditionForm:loadingFlg'].value = "ON";
}
/**
 * プルダウンリストエレメント取得処理
 */
function getTargetElement(targetTag, firstCalssNm, targetCode) {
	var objsDiv = document.conditionForm.getElementsByTagName(targetTag);
	for (i = 0; i < objsDiv.length; i++) {
		var classNm = objsDiv[i].className;
		if(classNm.indexOf(firstCalssNm) >= 0){
			if(classNm.indexOf(targetCode) >= 0) {
				return elementPullDown = objsDiv[i];
			}
		}
	}
	return null;
}
/*
 * 条件フォーム用表示ステータス変更処理
 */
function changeDisplay(targetTag, firstCalssNm, lastClassNm) {
	var objs = document.conditionForm.getElementsByTagName(targetTag);
	for (i = 0; i < objs.length; i++) {
		var classNm = objs[i].className;
		if(classNm.substring(0,firstCalssNm.length) == firstCalssNm){
			if(classNm.substring(firstCalssNm.length) == lastClassNm) {
				objs[i].style.display     = "inline";
			}else{
				objs[i].style.display   = "none";
			}
		}
	}
}
function downLoad() {
	if(isLoadingFlgOFF()){
		//検索条件値設定処理
		setJokenData();
		//自画面へリクエストする場合。
		document.conditionForm.target ="_self";
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:downloadCsv';
		//サブミット実行
		document.conditionForm.submit();
	}
}
//-->
</script>
<span m:rendered="#{rankRefSesDto.listCompany != null}">
	<form m:id="conditionForm" onKeyDown="return setDefaultSubmitButton('conditionForm','btnExecute');">
		<input type="hidden" id="viewId" m:value="#{rankRefReqDto.viewId}" />
		<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
		<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
		<input type="hidden" id="windowId" m:value="#{rankRefReqDto.windowId}"/>
		<input type="hidden" id="userTypeCd" m:value="#{rankRefReqDto.userTypeCd}" m:passthrough="true"/>
		<input type="hidden" id="loadingFlg" value=""/>
		<input type="hidden" id="companyCd" m:value="#{rankRefReqDto.companyCd}"/>
		<input type="hidden" id="zennenDataShubetu" m:value="#{rankRefReqDto.zennenDataShubetu}"/>
		<input type="hidden" id="rankTarget" m:value="#{rankRefReqDto.rankTarget}"/>
	    <input type="hidden" id="jyokenMsg" m:value="#{msg}" m:passthrough="true"/>
		<a id="search" m:action="#{rankRefViewAction.search}"/>
		<a id="downloadCsv" m:action="#{rankRefViewAction.downloadCsv}"/>
		<a id="changeTab" m:action="#{rankRefViewAction.changeTab}"/>
		<!--条件テーブル-->
		<table class="hiddenBody element_browser"
		       style="margin-bottom:4px;">
		<tr>
			<td>
			<table class="body_table">
			    <tr>
			      <th>店舗種別</th>
			      <td>
			          <div class="hideArea">
						<select class="condition_field"
								m:id="tenpoShubetu"
								m:value="#{rankRefReqDto.tenpoShubetu}"
								m:items="#{rankRefReqDto.listTenpoShubetu}"
								m:itemValue="code"
								m:itemLabel="name"
								>
							<option value="ALL">全店</option>
							<option value="1">前年対象店</option>
							<option value="2">予算対象店</option>
							<option value="3">新店</option>
						</select>
			          </div>
			        </td>
					<th>対象期間</th>
					<td>
					<div class="hideArea">
						<select class="condition_field"
								m:id="taishoKikan"
								m:value="#{rankRefReqDto.taishoKikan}"
								m:items="#{rankRefReqDto.listTaishoKikan}"
								m:itemValue="code"
								m:itemLabel="name"
								m:onchange="changeTaishoKikan(this)"
							>
							<option value="MONTH">月別</option>
							<option value="KIBETU">期別期報</option>
						</select>
					</div>
					</td>
					<th>期間指定</th>
					<td>
						<div class="hideArea">
							<span m:inject="s:forEach" m:items="#{rankRefReqDto.listKikanSitei}" m:var="listInfo" m:varindex="i">
								<select class="pdwn_taishoKikan_#{listInfo.key}"
									style="#{(listInfo.key==rankRefReqDto.taishoKikan) == true ? '' : 'display:none;'}"
									m:value="#{rankRefReqDto.kikanSitei}"
									m:items="#{listInfo.listData}"
									m:itemValue="code"
									m:itemLabel="name"
									>
									<option value="200805">2008/05</option>
									<option value="200804">2008/04</option>
									<option value="200803">2008/03</option>
									<option value="200802">2008/02</option>
									<option value="200801">2008/01</option>
								</select>
							</span>
							<select class="pdwn_taishoKikan_KIBETU"
									style="#{('KIBETU'==rankRefReqDto.taishoKikan) == true ? '' : 'display:none;'}"
									m:id="kibetuKbn"
									m:value="#{rankRefReqDto.kibetuKbn}"
									m:items="#{rankRefReqDto.listKibetuKbn}"
									m:itemValue="code"
									m:itemLabel="name"
									>
									<option value="200805">2008/05</option>
									<option value="200804">2008/04</option>
									<option value="200803">2008/03</option>
									<option value="200802">2008/02</option>
									<option value="200801">2008/01</option>
								</select>

						</div>
					</td>
					<th>ランク</th>
					<td>
					<div class="hideArea">
						<select class="condition_field"
								m:id="rankType"
								m:value="#{rankRefReqDto.rankType}"
								m:items="#{rankRefReqDto.listRank}"
								m:itemValue="code"
								m:itemLabel="name"
							>
							<option value="DESC">ベスト１００</option>
							<option value="ASC">ワースト１００</option>
						</select>
					</div>
					</td>
			    </tr>
			</table>
		</td>
		<td><input type="button" name="conditionForm:btnExecute"
		           m:value="#{rankRefReqDto.searched==true?'再検索':'実行'}"
		           class="operation_button" style="margin-left:3px;"
		           onClick="return search();" onDblClick="return false;"/>
		</td>
		</tr>
		</table>
		<input type="hidden" m:id="newWindowFlg" m:value="#{rankRefReqDto.newWindowFlg}"/>
		<input type="hidden" id="kikanSitei" m:value="#{rankRefReqDto.kikanSitei}"/>
		<input type="hidden" id="view_viewId" m:value="#{rankRefViewDto.viewId}" />
		<input type="hidden" id="view_windowId" m:value="#{rankRefViewDto.windowId}"/>
		<input type="hidden" id="view_companyCd" m:value="#{rankRefViewDto.companyCd}"/>
		<input type="hidden" id="view_tenpoShubetu" m:value="#{rankRefViewDto.tenpoShubetu}"/>
		<input type="hidden" id="view_zennenDataShubetu" m:value="#{rankRefViewDto.zennenDataShubetu}"/>
		<input type="hidden" id="view_taishoKikan" m:value="#{rankRefViewDto.taishoKikan}"/>
		<input type="hidden" id="view_kikanSitei" m:value="#{rankRefViewDto.kikanSitei}"/>
		<input type="hidden" id="view_kibetuKbn" m:value="#{rankRefViewDto.kibetuKbn}"/>
		<input type="hidden" id="view_rankType" m:value="#{rankRefViewDto.rankType}"/>
		<input type="hidden" id="view_rankTarget" m:value="#{rankRefViewDto.rankTarget}"/>
	<div m:id="pane_waitmsg" style="display:none">
	<p/><span style="font-weight:bold;" m:value="検索しています。しばらくお待ち下さい・・・"/>
	</div>
	<div m:rendered="#{rankRefViewDto.existSearchedData}">
	<div class="scroll_padding_head">
		<div class="scroll_hidden margin_bottom_hidden">
		<table class="hiddenBody data_table_width" style="margin-bottom:4px;">
		   	<tr>
				<td>
					<!--結果条件テーブル-->
					<table class="body_table2">
						<tr>
							<th nowrap="nowrap">店舗種別</th>
							<td nowrap="nowrap"><span m:converter="#{characterEncodingConverter}" m:value="#{rankRefViewDto.tenpoShubetuName}"/></td>
							<th nowrap="nowrap">対象期間</th>
							<td><span m:rendered="#{'MONTH'==rankRefViewDto.taishoKikan}" m:value="#{rankRefViewDto.kikanSitei}" m:converter="#{dateCnvtKjYM}"/>
								<span m:converter="#{characterEncodingConverter}" m:rendered="#{'KIBETU'==rankRefViewDto.taishoKikan}"><span m:converter="#{characterEncodingConverter}" m:value="#{rankRefViewDto.kikanSitei}"/>年度 <span m:converter="#{characterEncodingConverter}" m:value="#{rankRefViewDto.kibetuKbnName}"/></span>&nbsp;</td>
						</tr>
					</table>
					<span m:inject="s:forEach" m:items="#{rankRefViewDto.listRankTarget}" m:var="ui" m:varindex="i">
			    		<span m:rendered="#{ui.value==rankRefViewDto.rankTarget}"
			    		      class="element_print"
			    		      style="margin-top:4px;">
		    		        <span m:converter="#{characterEncodingConverter}" m:value="#{rankRefReqDto.rankTypeName}"/>【<span m:converter="#{characterEncodingConverter}" m:value="#{ui.label}"/>】</span>
		   			</span>
				</td>
				<td align="right" m:rendered="#{rankRefViewDto.existSearchedData}">
					<table class="hiddenBody element_browser">
					<tr>
						<td><input type="button" name="downloadBt" value="ダウンロード"
						           onClick="downLoad(); return false;" onDblClick="return false"/></td>
					    <td><input type="checkbox" m:value="#{rankRefViewDto.newWindowFlg}"
					               onClick="document.conditionForm.elements['conditionForm:newWindowFlg'].value=this.checked;"/>別ウィンドウに表示</td>
					</tr>
					</table>
				</td>
		    </tr>
		</table>
		<!--タブエリア-->
		<table class="element_browser" cellspacing="0" cellpadding="0">
			<tr m:inject="s:forEach" m:items="#{rankRefViewDto.listRankTarget}" m:var="ui" m:varindex="i">
	    		<th width="120px" class="body_#{ui.value==rankRefViewDto.rankTarget? '' : 'non_'}active_cell">
    		<a href="javaScript:void(0);" name="#{ui.value}"
    		   onClick="#{ui.value == rankRefViewDto.rankTarget? '':'changeTab(this);'}return false;"
    		   onDblClick="return false;" m:passthrough="true" ><span m:converter="#{characterEncodingConverter}" m:value="#{ui.label}"/></a>
	    		</th>
   			</tr>
    	</table>
		<div class="body_caption data_table_width element_browser" style="height:5px;"></div>
		<table class="body_table2 data_table_width">
			<tr class="header_row">
				<th class="width_Rank">順位</th>
				<th class="width_Mise">店舗</th>
				<th class="width_Kingaku">売上</th>
				<th class="width_Hiritu">達成率</th>
				<th class="width_Kingaku">前年実績<br/>(前年同月)</th>
				<th class="width_Hiritu">前年比<br/>(売上)</th>
				<th class="width_Kyakusu">客数</th>
				<th class="width_Hiritu">前年比<br/>(客数)</th>
				<th class="width_Kyakusu">客単価</th>
				<th class="width_Hiritu">前年比<br/><font  style="font-size:10pt;">(客単価)</font></th>
			</tr>
		</table>
		</div>
		</div>
		<div class="scroll_padding_data">
		<div class="scroll_standby" id="renkScroll">
		<table class="body_table2 data_table_width"
		       style="border-top-width:0px;">
		    <span m:inject="s:forEach"
		          m:items="#{rankRefViewDto.listSearchData}"
		          m:var="ui" m:varindex="e">
				<tr class="non_top_border">
					  <td class="width_Rank font_size_14"><span m:value="#{ui.rankNo}"/></td>
					  <td class="leftArea width_Mise font_size_14"><span m:converter="#{characterEncodingConverter}" m:value="#{ui.miseCd}"/>&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{ui.miseNameKj}"/></td>
			          <td class="width_Kingaku font_size_14"><span m:value="#{ui.uriage}" m:converter="#{bizreportNumericCnvt}"/></td>
					  <td class="width_Hiritu font_size_14 #{100>ui.yosanTasseiRitu? 'hiritu_red':'hiritu'}"><span m:value="#{ui.yosanTasseiRitu}"/></td>
					  <td class="width_Kingaku font_size_14"><span m:value="#{ui.uriageZen}" m:converter="#{bizreportNumericCnvt}" /></td>
					  <td class="width_Hiritu font_size_14 #{100>ui.uriageZennenHi? 'hiritu_red':'hiritu'}"><span m:value="#{ui.uriageZennenHi}"/></td>
					  <td class="width_Kyakusu font_size_14"><span m:value="#{ui.kyakusu}" m:converter="#{bizreportNumericCnvt}" /></td>
					  <td class="width_Hiritu font_size_14 #{100>ui.kyakusuZennenHi? 'hiritu_red':'hiritu'}"><span m:value="#{ui.kyakusuZennenHi}"/></td>
					  <td class="width_Kyakusu font_size_14"><span m:value="#{ui.kyakutanka}" m:converter="#{bizreportNumericCnvt}" /></td>
					  <td class="width_Hiritu font_size_14 #{100>ui.kyakutankaZennenHi? 'hiritu_red':'hiritu'}"><span m:value="#{ui.kyakutankaZennenHi}"/></td>
				</tr>
			</span>
		</table>
		</div>
		</div>
	</div>
		<input type="text" m:id="dummyEnter" style="display:none"/>
	</form>
</span>
</span>
</body>
</html>
