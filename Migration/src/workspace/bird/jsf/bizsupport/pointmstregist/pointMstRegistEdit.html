<html xmlns:m="http://www.seasar.org/maya" m:action="#{pointMstRegistEditAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j" />
<meta http-equiv="Content-Style-Type" content="text/css"/>
<meta http-equiv="Content-Script-Type" content="text/javascript"/>
<title>ポイントマスタメンテナンス（編集画面）</title>
</head>
<body>
<span m:inject="f:param" m:name="layoutTitle" m:value="ポイントマスタメンテナンス"></span>
<span m:inject="s:insert" m:name="bodyTitleName">■ポイントマスタメンテナンス（編集画面）</span>
<span m:inject="f:param" m:name="onLoadName" m:value=""></span>
<span m:inject="f:param" m:name="viewIdValue" m:value="BBS036V02"></span>
<div m:inject="s:insert" m:name="body">
<style type="text/css">
<!--
.scroll_area {
	width:	  605px;
	height:   362px;
	overflow: auto;
}
-->
</style>
<script type="text/javascript">
<!--
function deleteNendo(index) {
	document.pointMstRegistEdit.elements['pointMstRegistEdit:deleteNo'].value = index;
	document.pointMstRegistEdit.elements['pointMstRegistEdit:__link_clicked__'].value='pointMstRegistEdit:deleteNendo';
	document.pointMstRegistEdit.target ="_self";
	document.pointMstRegistEdit.submit();
}

//次の構成要素を取得
function getNextElement(field) {
  var form = field.form;
  for(var e = 0; e < form.elements.length; e++) {
      if (field == form.elements[e])
          break;
  }
  return form.elements[++e % form.elements.length];
}

/** 画面内タブ制御処理 **/
//ENTER KEY
function enterTAB(e, formName, nendoCnt, pointCnt){
	var event = e || event;
	var isie = (document.all) ? true : false;
	var key;
    var srcobj;
	if (isie) { // IE
        key = event.keyCode;
        srcobj=event.srcElement;
    }
    else { // IE以外
        key = event.which;
        srcobj=event.target;
    }

	if(key==13 && srcobj.type!='button' && srcobj.type!='submit' &&srcobj.type!='reset' && srcobj.type!='textarea' && srcobj.type!='') {
		//ボタン や テキストエリアなどは処理対象
		var sLastFocusID;
		var sFirstFocusID = 'pointMstRegistEdit:planName';

		var f = document.forms['pointMstRegistEdit'];
		var eventid = srcobj.id;

		var id1key;
		var id2key;
		var idxSplit;
		var idsplit = eventid.split('_');
		if(idsplit.length > 4) {
			id1key = idsplit[1];
			id2key = idsplit[3];
			idxSplit = idsplit[4].split(':');
			var idx = 0;
			var idy = 0;
			if(nendoCnt > 0) {
				idx = nendoCnt-1;
			}
			if(pointCnt > 0) {
				idy = pointCnt-1;
			}

			sLastFocusID  = 'pointMstRegistEdit:_' + id1key + '_' + idx + ':_'+ id2key+'_' + idy + ':kihonPoint';
		}

		if (sLastFocusID != null && sFirstFocusID != null && eventid == sLastFocusID) {
			if(isie)
				document.all(sFirstFocusID).focus();
			else
				f.elements[sFirstFocusID].focus();
			return false;
		}
        if(isie){ // IE
			try {
				window.event.keyCode = 0x09;
			}
			catch(e) {
				event.returnValue = false;
			}
		} else { // IE以外
            var el=getNextElement(srcobj);
            if (el.type!='hidden')
                ;   //nothing to do here.
            else
                while(el.type=='hidden')
                    el=getNextElement(el);
            if(!el)
                return false;
            else
                el.focus();
            return false;
        }
    }
	return true;
}

function regist(confirmMsg){
	if(confirm(confirmMsg)){
		document.pointMstRegistEdit.elements['pointMstRegistEdit:__link_clicked__'].value='pointMstRegistEdit:insert';
		document.pointMstRegistEdit.submit();
	}
}

//-->
</script>

<form m:id="pointMstRegistEdit" onkeydown="return enterTAB(event,'pointMstRegistEdit','#{pointDataDto.nendoCnt}','#{pointDataDto.pointCnt}');">
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
	<input type="hidden" m:id="editMode" m:value="#{pointDataDto.editMode}"/>
	<input type="submit" value="登録" onclick="regist('入力内容を登録します。よろしいですか？');return false;" onDblClick="return false"/>&nbsp;
	<input type="button" value="対象年度追加" m:action="#{pointMstRegistEditAction.addNendo}"/>&nbsp;
	<input type="button" value="戻る" m:action="#{pointMstRegistEditAction.back}"/>
	<input type="hidden" m:id="deleteNo" m:value="#{pointDataDto.deleteNo}"/>
	<a m:id="deleteNendo" m:action="#{pointMstRegistEditAction.deleteNendo}"></a>
	<a m:id="insert"  m:action="#{pointMstRegistEditAction.insert}"></a>
<table class="body_table" style="margin-top:6px;border-top-width:0px;border-right:0px" >
<tr>
		<th width="160px" style="border-top-width:2px;">中期経営計画</th>
		<td colspan="3" style="border-top-width:2px;">
			<input m:id="planName" class="width_350" m:maxlength="60" type="text" size="60" m:value="#{pointDataDto.seidoInfo.planName}"/>
		</td>
</tr>
<tr>
		<th>開始年度</th>
		<td style="text-align:right;">
			<span m:converter="#{characterEncodingConverter}" m:value="#{pointDataDto.seidoInfo.startNendo}"></span>
		</td>
		<th>終了年度</th>
		<td style="text-align:right;">
			<span m:converter="#{characterEncodingConverter}" m:value="#{pointDataDto.seidoInfo.endNendo}"></span>
		</td>
</tr>
<tr>
		<th>業績連動係数（社員）</th>
		<td>
			<input m:id="gRendoKeisu" class="imenotuse width_90" m:style="text-align:right;" m:maxlength="3" type="text" size="15" m:value="#{pointDataDto.seidoInfo.gRendoKeisu}" />&nbsp;
		</td>
		<th>業績連動係数（役員）</th>
		<td>
			<input m:id="gRendoKeisuYakuin" class="imenotuse width_90" m:style="text-align:right;" m:maxlength="3" type="text" size="15" m:value="#{pointDataDto.seidoInfo.gRendoKeisuYakuin}" />&nbsp;
		</td>
		<th style="border-top-width:2px;">業績ポイント付与年月日</th>
		<td style="border-top-width:2px;border-right-width:2px;">
			<input m:id="gPointDate" m:converter="#{dateConverterYMD}" class="imenotuse width_90" m:style="text-align:right;" m:maxlength="10" type="text" size="15" m:value="#{pointDataDto.seidoInfo.gPointDate}" />&nbsp;
		</td>
</tr>
<tr>
		<th>備考</th>
		<td colspan="7" style="border-right-width:2px;">
			<input type ="text"  m:converter="#{characterEncodingConverter}" m:value="#{pointDataDto.seidoInfo.bikou}" m:maxlength="100" size="111" />
		</td>
</tr>
</table>

<table class="body_table2" style="margin-top:10px;width:580px;border-bottom-width:0px;" >
	<tr>
		<th class="body_header4" colspan="5" style="text-align:left;">基本ポイント</th>
	</tr>
</table>
<div class="scroll_area">
<div m:inject="s:forEach" m:items="#{pointDataDto.nendoPointList}" m:var="nendo" m:varindex="i">
<table class="body_table2" style="border-top-width:1px;width:580px;margin-bottom:30px;" >
<tr>
		<th colspan="2" width="100px" style="padding:3px 0px;">年度</th>
		<td colspan="1"  style="border-right-width:0px;">&nbsp;
			<span m:rendered="#{nendo.addFlag == true}">
			<input m:id="nendo" class="imenotuse" m:maxlength="4" type="text" size="5" value="#{nendo.nendo}"/>
			</span>
			<span m:rendered="#{nendo.addFlag == false}" style="vertical-align: middle;" m:value="#{nendo.nendo}">
			</span>
			<span style="vertical-align: middle;">&nbsp;年度</span>
		</td>
		<td align ="right" style="border-left-width:0px;"><input type="button" value="年度削除" m:onclick="deleteNendo(#{i})" />&nbsp;</td>
</tr>
<tr>
		<th colspan="2" width="260px" style="padding:3px 0px;">会社</th>
		<th width="220px">等級</th>
		<th width="100px">付与ポイント</th>
</tr>
<div m:inject="s:forEach" m:items="#{nendo.pointList}" m:var="e" m:varindex="j">
<span m:rendered="#{e.splitFlag == true}">
<tr><td colspan="4" style="background-color:#ffffff;">&nbsp;</td></tr>
</span>
<tr>
		<td colspan="2"><span m:converter="#{characterEncodingConverter}" m:value="#{e.kbCompanyName}"></span></td>
		<td><span m:converter="#{characterEncodingConverter}" m:value="#{e.rankName}"></span></td>
		<td>
			<input m:id="kihonPoint" class="imeon" m:style="text-align:right;ime-mode:disabled" m:maxlength="3" type="text" size="6" m:value="#{e.kihonPoint}"/>&nbsp;P
		</td>
</tr>
</div>
</table>
</div>
</div>
</form>
</div>
</body>
</html>