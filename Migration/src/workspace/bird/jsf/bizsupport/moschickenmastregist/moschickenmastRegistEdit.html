<html xmlns:m="http://www.seasar.org/maya" m:action="#{mosChickenMstEditAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j" />
<title>予約販売管理マスタ登録</title>
<span m:inject="f:param" m:name="layoutTitle" m:value="予約販売管理マスタ登録(編集画面)"/>
<span m:inject="s:insert" m:name="bodyTitleName">■予約販売管理マスタ登録(編集画面)</span>
<span m:inject="f:param" m:name="viewIdValue" m:value="BBS015V02"/>
<span m:inject="f:param" m:name="onLoadName" m:value="load()"/>
</head>
<body>
<span m:inject="s:insert" m:name="body" >
<STYLE type="text/css">
<!--
/* 入力フィールドの右詰入力へ指定するためのスタイルシート */
.ratio_style {
  text-align       : right;
  background-color : #FFFFFF;
  color            : black;
}
table.body_table2 tr td.putInnerTable, table.body_table2 tr th.putInnerTable {
	padding:0px;
}
table.body_table2 tr td.putInnerTable table, table.body_table2 tr th.putInnerTable table {
	width        :100%;
	border-width :0px;
	margin       :-1px;
	border-spacing:0px;
}
table.body_table2 tr td.putInnerTable table tr td, table.body_table2 tr th.putInnerTable table tr th{
	border-width :0px;
}
//-->
</STYLE>
<script type="text/javascript">
<!--
var userTypeHONBU = "01";
var userTypeONER = "02";
var userTypeMISE = "03";

/**
 * ウィンドウロードステータス取得処理
 *
 */
function returnLoadingStatus(){
	if(isLoadingFlgOFF()) {
		setLoadingFlg();
		return true;
	}
	return false;
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function isLoadingFlgOFF(){
	return (document.conditionForm.elements['conditionForm:loadingFlg'].value != "ON");
}


/**
 * ウィンドウロードフラグ設定処理
 *
 *
 */
function setLoadingFlg() {
	document.conditionForm.elements['conditionForm:loadingFlg'].value = "ON";
}

/**
 * ユーザータイプ判断処理
 *
 */
function isUserType(code){
	var userType = document.conditionForm.elements['conditionForm:usertypeCd'].value;
	return (code == userType);
}
/**
 * 直前アクション判断処理
 *
 */
function isCompliteAction(code){
	var compliteActionName= "conditionForm:compliteActionType";
	var actionType = document.conditionForm.elements[compliteActionName].value;
	return (code == actionType);
}

/**
 * 画面表示完了時初期化処理
 */
function load(){
	document.conditionForm.elements['conditionForm:loadingFlg'].value = "";
	document.conditionForm.elements['conditionForm:executeBt'].disabled = false;
	if(isCompliteAction("init")){
	  	changeTaB('tab_area_0','tab_title_area_0','tab_anchor_area_0', 'tab_data_area_0');
	  	focusElement("conditionForm");
	}else{
	  	changeTaB('tab_area_1','tab_title_area_1','tab_anchor_area_1', 'tab_data_area_1');
		var elementName = document.focusElementForm.elements["FOCUS_ELEMENT"].value;
		if(elementName == "") {
	  		//メニューグループ最終行のインデックスを取得する。
			var targetMGroupIndex= document.conditionForm.elements['conditionForm:targetMGroupIndex'].value;
	  		//メニュー開始インデックスを取得する。
			var menuStartIndex= document.conditionForm.elements['conditionForm:menuStartIndex'].value;
		  	//メニューグループアクション
		  	if(isCompliteAction("addMenuGroup") && (targetMGroupIndex != null && targetMGroupIndex != '')){
				var focusParamName= targetElementName('conditionForm','menuGroupNm', targetMGroupIndex);
				//追加されたメニューグループ名称へフォーカスを当てる。
				document.conditionForm.elements[focusParamName].focus();
		  	}
		  	else if(isCompliteAction("deleteMenuGroup") && (targetMGroupIndex != null && targetMGroupIndex != '')){
				var focusParamName= targetElementName('conditionForm','menuGroupNm', 0);
				if(focusParamName != null && focusParamName != ''){
					//最初のメニューグループ名称へフォーカスを当てる。
					document.conditionForm.elements[focusParamName].focus();
				}
		  	}
		  	//メニューアクション
		  	else if(isCompliteAction("addMenu") && (menuStartIndex != null && menuStartIndex != '')){
				var focusParamName= targetElementName('conditionForm','strConvValue', menuStartIndex);
				if(focusParamName != null && focusParamName != ""){
					//追加されたメニューの換算値へフォーカスを当てる。
					document.conditionForm.elements[focusParamName].focus();
				}
		  	}
		  	else if(isCompliteAction("deleteMenu") && (targetMGroupIndex != null && targetMGroupIndex != '')){
				var focusParamName= targetElementName('conditionForm','menuGroupNm', targetMGroupIndex);
				if(focusParamName != null && focusParamName != ""){
					//処理対象メニューグループ名称へフォーカスを当てる。
					document.conditionForm.elements[focusParamName].focus();
				}
		  	}
		  	//食包材アクション
		  	else if(isCompliteAction("lumpChoise") && (menuStartIndex != null && menuStartIndex != '')){
				var focusParamName= targetElementName('conditionForm','strConvValue', menuStartIndex);
				if(focusParamName != null && focusParamName != ""){
					//追加されたメニューの換算値へフォーカスを当てる。
					document.conditionForm.elements[focusParamName].focus();
				}
		  	}
		  	//食包材アクション
		  	else if(isCompliteAction("choise") && (menuStartIndex != null && menuStartIndex != '')){
				var focusParamName= targetElementName('conditionForm','strConvValue', menuStartIndex);
				if(focusParamName != null && focusParamName != ""){
					//追加されたメニューの換算値へフォーカスを当てる。
					document.conditionForm.elements[focusParamName].focus();
				}
		  	}
		  	else if(isCompliteAction("deleteShokuhouzai") && (targetMGroupIndex != null && targetMGroupIndex != '')){
				var focusParamName= targetElementName('conditionForm','menuGroupNm', targetMGroupIndex);
				if(focusParamName != null && focusParamName != ""){
					//処理対象メニューグループ名称へフォーカスを当てる。
					document.conditionForm.elements[focusParamName].focus();
				}
		  	}
		  	else{
		  		focusElement("conditionForm");
		  	}
		}
	  	else{
	  		focusElement("conditionForm");
	  	}
	}
}
/**
 * タブフォーカス制御処理
 */
function changeTaB(tabarea, titlearea, anchorarea, dataarea) {
  	bodyTabChange('div',tabarea, titlearea, dataarea, 'th');
  	bodyAnchorStyleChange(anchorarea);
}
function bodyTabChange(checkTab,tabarea,titlearea, dataarea, tabTag) {
  var objs = document.conditionForm.getElementsByTagName(checkTab);
  var tabObjs = document.conditionForm.getElementsByTagName(tabTag);
  var dispArea

//Data area Change
  for (i = 0; i < objs.length; i++) {
    if (objs[i].className == titlearea) {
      if(objs[i].style.display == "inline"){
        dispArea = objs[i].className;
      }
      objs[i].style.display = "inline";
    }else if (objs[i].className == dataarea) {
      if(objs[i].style.display == "inline"){
        dispArea = objs[i].className;
      }
      objs[i].style.display = "inline";
      objs[i].style.width = "975px";
      objs[i].style.height = "250px";
      objs[i].style.overflow = "auto";
    }else if(objs[i].className.substring(0,15) == 'tab_title_area_'){
      objs[i].style.display = "none";
    }else if(objs[i].className.substring(0,14) == 'tab_data_area_'){
      objs[i].style.display = "none";
    }else{
    }
  }
//Tab area Change
  for (t = 0; t < tabObjs.length; t++) {
    if(tabObjs[t].className == 'body_active_cell' && tabarea != tabObjs[t].id){
      tabObjs[t].className = 'body_non_active_cell';
    }else if(tabObjs[t].className == 'body_non_active_cell' && tabObjs[t].id == tabarea){
      tabObjs[t].className = 'body_active_cell';
    }
  }
}
// body area tab anchor style change (color etc)
function bodyAnchorStyleChange(anchorarea){
  var objs = document.conditionForm.getElementsByTagName('a');
  for (t = 0; t < objs.length; t++) {
  	var targetObjId = objs[t].id;
  	var targetName = targetObjId.substring((targetObjId.lastIndexOf(":")+1));
    if(targetName == anchorarea){
      objs[t].className = 'body_selected_link';
    }else if(objs[t].className == "body_selected_link"){
      objs[t].className = 'body_non_selected_link';
    }
  }
}
/**
 * 戻るボタン押下時処理
 *
 */
function execBack(confirmMsg){
	//実行前に確認アラートを出力
	if(confirm(confirmMsg)){
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:execBack';
		document.conditionForm.submit();
	}
}
/**
 * メニューグループ追加ボタン押下時処理
 *
 */
function addMenuGroup(){
	document.conditionForm.elements['conditionForm:compliteActionType'].value = "addMenuGroup";
	document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:addMenuGroup';
	document.conditionForm.submit();
}
/**
 * メニューグループ削除リンク押下時処理
 *
 */
function deleteMenuGroup(topMsg, buttomMsg, index){
	var menuGroupNameParamName= targetElementName('conditionForm','menuGroupNm', index);
	var confirmMsg = topMsg+document.conditionForm.elements[menuGroupNameParamName].value+buttomMsg;
	//実行前に確認アラートを出力
	if(confirm(confirmMsg)){
		var menuGroupParamName= targetElementName('conditionForm','menuGroup', index);
		var targetMenuGroupCd = document.conditionForm.elements[menuGroupParamName].value;
		//パラメーター対象メニューグループコードへ削除対象メニューグループコードを設定する。
		document.conditionForm.elements['conditionForm:targetMenuGroupCd'].value = targetMenuGroupCd;
		document.conditionForm.elements['conditionForm:compliteActionType'].value = "deleteMenuGroup";
		//メニューグループ削除アクションを設定する。
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:deleteMenuGroup';
		document.conditionForm.submit();
	}
}
/**
 * メニュー追加ボタン押下時処理
 *
 */
function addMenu(targetMenuGroupCd){
	document.conditionForm.elements['conditionForm:compliteActionType'].value = "addMenu";
	document.conditionForm.elements['conditionForm:targetMenuGroupCd'].value = targetMenuGroupCd;
	document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:addMenu';
	document.conditionForm.submit();
}
/**
 * メニュー削除リンク押下時処理
 *
 */
function deleteMenu(confirmMsg, targetMenuGroupCd, targetMenuCd){
	//実行前に確認アラートを出力
	if(confirm(confirmMsg)){
		document.conditionForm.elements['conditionForm:compliteActionType'].value = "deleteMenu";
		document.conditionForm.elements['conditionForm:targetMenuGroupCd'].value = targetMenuGroupCd;
		document.conditionForm.elements['conditionForm:targetMenuCd'].value = targetMenuCd;
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:deleteMenu';
		document.conditionForm.submit();
	}
}
/**
 * 一括選択リンク押下時処理
 * 食包材選択画面へ遷移します。
 *
 */
function lumpChoise(targetMenuGroupCd){
	document.conditionForm.elements['conditionForm:compliteActionType'].value = "lumpChoise";
	document.conditionForm.elements['conditionForm:targetMenuGroupCd'].value = targetMenuGroupCd;
	document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:lumpChoise';
	document.conditionForm.submit();
}
/**
 * 編集リンク押下時処理
 * 食包材選択画面へ遷移します。
 */
function choise(targetMenuGroupCd, targetMenuCd){
	document.conditionForm.elements['conditionForm:compliteActionType'].value = "choise";
	document.conditionForm.elements['conditionForm:targetMenuGroupCd'].value = targetMenuGroupCd;
	document.conditionForm.elements['conditionForm:targetMenuCd'].value = targetMenuCd;
	document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:choise';
	document.conditionForm.submit();
}
/**
 * 食包材削除リンク押下時処理
 *
 */
function deleteShokuhouzai(confirmMsg, targetMenuGroupCd, targetMenuCd){
	//実行前に確認アラートを出力
	if(confirm(confirmMsg)){
		document.conditionForm.elements['conditionForm:compliteActionType'].value = "deleteShokuhouzai";
		document.conditionForm.elements['conditionForm:targetMenuGroupCd'].value = targetMenuGroupCd;
		document.conditionForm.elements['conditionForm:targetMenuCd'].value = targetMenuCd;
		document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:deleteShokuhouzai';
		document.conditionForm.submit();
	}
}
/**
 * 実行ボタン押下時処理
 *
 */
function exec(){
	document.conditionForm.elements['conditionForm:__link_clicked__'].value='conditionForm:execRegist';
	document.conditionForm.submit();
}

//-->
</script>

<form m:id="conditionForm" onKeyDown="return setDefaultSubmitButton('conditionForm','executeBt');">
    <input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<input type="hidden" m:id="targetCkanriNo" m:value="#{mosChickenMstRegistDto.targetCkanriNo}"/>
	<input type="hidden" m:id="modeType" m:value="#{mosChickenMstRegistDto.modeType}"/>
	<input type="hidden" m:id="targetMenuGroupCd" m:value="#{mosChickenMstRegistDto.targetMenuGroupCd}"/>
	<input type="hidden" m:id="targetMenuCd" m:value="#{mosChickenMstRegistDto.targetMenuCd}"/>
	<input type="hidden" m:id="compliteActionType" m:value="#{mosChickenMstRegistDto.compliteActionType}"/>
	<input type="hidden" id="loadingFlg" value=""/>
	<input type="hidden" m:id="targetMGroupIndex" m:value="#{mosChickenMstRegistDto.targetMGroupIndex}"/>
	<input type="hidden" m:id="menuStartIndex" m:value="#{mosChickenMstRegistDto.menuStartIndex}"/>
	<a id="deleteMenuGroup" m:action="#{mosChickenMstEditAction.deleteMenuGroup}"/>
	<a id="deleteMenu" m:action="#{mosChickenMstEditAction.deleteMenu}"/>
	<a id="deleteShokuhouzai" m:action="#{mosChickenMstEditAction.deleteShokuhouzai}"/>
	<a id="addMenuGroup" m:action="#{mosChickenMstEditAction.addMenuGroup}"/>
	<a id="addMenu" m:action="#{mosChickenMstEditAction.addMenu}"/>
	<a id="lumpChoise" m:action="#{mosChickenMstEditAction.lumpChoise}"/>
	<a id="choise" m:action="#{mosChickenMstEditAction.choise}"/>
	<a id="execBack" m:action="#{mosChickenMstEditAction.back}"/>
	<a id="execRegist" m:action="#{mosChickenMstEditAction.confirm}"/>
	<input style="margin-bottom:4px;" type="button" value="戻る" onClick="execBack('編集中の内容がある場合は破棄されます。よろしいですか？');" onDblClick="return false"/>
	<input style="margin-bottom:4px;" type="button" value="確認" onClick="exec();" onDblClick="return false" name="conditionForm:executeBt"/>
	<div m:inject="s:forEach" m:items="#{mosChickenMstRegistDto.listKanriKikan}"
	     m:var="kikan" m:varindex="i">
	<table class="body_table" width="400px">
		<tr>
			<th width="80px">タイトル</th>
			<td><input type="text" class="width_262" m:id="title" m:value="#{kikan.title}"
			           maxlength="20" size="50"/></td>
		</tr>
	</table>
	</div>
	<table cellspacing="0" style="margin-top:4px;">
	  <tr>
	    <td class="body_#{'init'==mosChickenMstRegistDto.compliteActionType?'':'non_'}active_cell tab_change_area_0" width="130px">
     		<a href="javaScript:changeTabArea('0')">対象期間</a>
	    </td>
	    <td class="body_#{'init'==mosChickenMstRegistDto.compliteActionType?'non_':''}active_cell tab_change_area_1" width="130px">
	    	<a href="javaScript:changeTabArea('1')">対象メニュー</a>
	    </td>
	  </tr>
	</table>
	<div class="tab_change_area_0 #{'init'==mosChickenMstRegistDto.compliteActionType?'':'in'}visible_tab">
	<!--対象期間-->
		<table  cellspacing="0" cellpadding="0" style="width:500px;">
		<tr class="body_caption" style="line-height:5px;"><td>&nbsp;</td></tr>
		</table>
		<table class="body_table2" width="500px">
			<tr class="header_row">
				<th width="200px">設定項目</th>
				<th>開始日</th>
				<th>終了日</th>
			</tr>
			<span m:inject="s:forEach" m:items="#{mosChickenMstRegistDto.listKanriKikan}" m:var="kikan" m:varindex="i">
				<tr>
					<th width="200px">対象期間</th>
					<td align="center"><input type="text" class="width_110" m:id="targetFrom" m:value="#{kikan.targetFrom}" maxlength="10" style="ime-mode:disabled" m:converter="#{dateConverter}"/></td>
					<td align="center"><input type="text" class="width_110" m:id="targetTo" m:value="#{kikan.targetTo}" maxlength="10" style="ime-mode:disabled" m:converter="#{dateConverter}"/></td>
				</tr>
				<tr>
					<th width="200px" nowrap=" nowrap">デフォルト表示期間</th>
					<td align="center"><input type="text" class="width_110" m:id="defaultFrom" m:value="#{kikan.defaultFrom}" maxlength="10" style="ime-mode:disabled" m:converter="#{dateConverter}"/></td>
					<td align="center"><input type="text" class="width_110" m:id="defaultTo" m:value="#{kikan.defaultTo}" maxlength="10" style="ime-mode:disabled" m:converter="#{dateConverter}"/></td>
				</tr>
			</span>
		</table>
	</div>
	<div class="tab_change_area_1 #{'init'==mosChickenMstRegistDto.compliteActionType?'in':''}visible_tab">
	<!--対象メニュー-->
		<table  cellspacing="0" cellpadding="0" style="width:955px;">
			<tr class="body_caption" style="line-height:5px;"><td>&nbsp;</td></tr></table>
		<table class="hiddenBody" style="width:955px;margin:4px 0px;">
			<tr>
				<td valign="bottom">
					<input type="button" value="商品グループ追加" onClick="addMenuGroup();" onDblClick="return false" name="addMenuGroupBt"/>
				</td>
			</tr>
		</table>
		<span m:rendered="#{mosChickenMstRegistDto.listKanriMenuGroup != null}">
		<div style="width:955px; height:370px" class="scroll_area">
		<div m:inject="s:forEach" m:items="#{mosChickenMstRegistDto.listKanriMenuGroup}"
		     m:var="menuGroup" m:varindex="g">
			<table class="body_table2" style="width:936px; margin-top:4px;">
		      <tr class="defaultTR">
		      	<th width="150px">
		      	商品グループ<input type="hidden" m:id="menuGroup" m:value="#{menuGroup.menuGroup}"/></th>
			    <td><input type="text" m:id="menuGroupNm" m:value="#{menuGroup.menuGroupNm}" size="50" maxlength="10"/>
			   	<a href="javaScript:deleteMenuGroup('商品グループ「','」全体を削除します。よろしいですか？',#{g})"
			   	   onDblClick="return false">[ 削除 ]</a></td>
		      </tr>
			</table>
			<table class="body_table2" style="width:936px;margin:4px 0px;">
	      		<tr class="header_row">
	      			<th width="*">対象メニュー</th>
	      			<th width="340px">対応食包材&nbsp;<a href="javaScript:lumpChoise('#{menuGroup.menuGroup}')" onDblClick="return false">[ 一括編集 ]</a></th>
	      			<th width="90px">換算値</th>
	      			<th width="120px">集計グループ</th>
	      		</tr>
				<div m:inject="s:forEach" m:items="#{mosChickenMstRegistDto.listKanriMenu}" m:var="menu" m:varindex="i">
				<!--対象メニュー-->
	      		<tr m:rendered="#{menu.menuGroup == menuGroup.menuGroup}">
				    <td class="putInnerTable">
				    	<table width="100%">
				    		<tr>
					    	<td><span m:converter="#{characterEncodingConverter}" m:value="#{menu.menuCd}"/>&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{menu.menuNameKj}"/></td>
					    	<td align="right"><a href="javascript:deleteMenu('メニュー「#{menu.menuNameKj}」を削除します。よろしいですか？','#{menuGroup.menuGroup}','#{menu.menuCd}')" onDblClick="return false">[ 削除 ]</a></td>
				    		</tr>
				    	</table>
				    </td>
				    <td class="putInnerTable">
				    	<table width="100%">
				    		<tr>
					    	<td><span m:converter="#{characterEncodingConverter}" m:value="#{menu.shokuCd}"/>&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{menu.shokuNameKna}"/></td>
					    	<td width="60px" align="right">
					    		<a id="shokulink" href="javaScript:void(0);" onClick ="choise('#{menuGroup.menuGroup}', '#{menu.menuCd}')" onDblClick="return false">[ 編集 ]</a>
					    	</td>
					    	<td width="60px" align="right">
					    		<span m:rendered="#{menu.shokuCd != null && menu.shokuCd != ''}">
					    		<a href="javascript:deleteShokuhouzai('食包材「#{menu.shokuNameKna}」を削除します。よろしいですか？','#{menuGroup.menuGroup}','#{menu.menuCd}')" onDblClick="return false">[ 削除 ]</a>
					    		</span>
					    	</td>
					    	</tr>
				    	</table>
				    </td>
				    <td align="center"><input type="text" m:class="ratio_style width_62" m:id="strConvValue" m:value="#{menu.strConvValue}" maxlength="3" size="10"  style="ime-mode:disabled"/></td>
				    <td align="center">
				    	<div class="hideArea">
						<select class="condition_field"
								m:id="sumGroup"
								m:value="#{menu.sumGroup}"
								>
								<option value="A">A</option>
								<option value="B">B</option>
								<option value="C">C</option>
								<option value="D">D</option>
								<option value="E">E</option>
							</select>
						</div>
					</td>
			    </tr>
			    </div>
			</table>
			<input type="button" name="btMenuAdd" value="メニュー追加"
			       onClick="addMenu('#{menuGroup.menuGroup}');" onDblClick="return false"/>
<p/>
		</div>
		</div>
		</span>
	</div>
</form>
</span>
</body>
</html>
