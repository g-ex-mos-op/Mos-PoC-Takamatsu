<html xmlns:m="http://www.seasar.org/maya"
      m:action="#{publicTargetSearchAction.initialize}"
      m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j" />
<title></title>
</head>
<body>
<span m:inject="f:param" m:name="layoutTitle" m:value="公開対象選択"/>
<span m:inject="s:insert" m:name="bodyTitleName">■公開対象選択</span>
<span m:inject="f:param" m:name="onLoadName" m:value="onLoad();"/>
<span m:inject="f:param" m:name="viewIdValue" m:value="BCO002V01"/>
<span m:inject="s:insert" m:name="body">

<SCRIPT LANGUAGE="javascript">
<!--
function checkAllCompany(formobj) {
    for (i = 0; i < formobj.elements.length; i++) {
        if (formobj.elements[i].type == "checkbox" && formobj.elements[i].title == "company") {
	            formobj.elements[i].checked = true;
        	}
    }
    loadGyotai();
}
function checkClearAllCompany(formobj) {
    for (i = 0; i < formobj.elements.length; i++) {
        if (formobj.elements[i].type == "checkbox" && formobj.elements[i].title == "company") {
            formobj.elements[i].checked = false;
        }
    }
      loadGyotai();
}
function checkAllShozoku(formobj) {
    for (i = 0; i < formobj.elements.length; i++) {
        if (formobj.elements[i].type == "checkbox" && formobj.elements[i].title == "shozoku") {
	            formobj.elements[i].checked = true;
        	}
    }
}

function checkClearAllShozoku(formobj) {
    for (i = 0; i < formobj.elements.length; i++) {
        if (formobj.elements[i].type == "checkbox" && formobj.elements[i].title == "shozoku") {
            formobj.elements[i].checked = false;
        }
    }
}


function checkAllGyotai(formobj) {
    for (i = 0; i < formobj.elements.length; i++) {
        if (formobj.elements[i].type == "checkbox" && formobj.elements[i].title == "gyotai") {
	            formobj.elements[i].checked = true;
        	}
    }
}

function checkClearAllGyotai(formobj) {
    for (i = 0; i < formobj.elements.length; i++) {
        if (formobj.elements[i].type == "checkbox" && formobj.elements[i].title == "gyotai") {
            formobj.elements[i].checked = false;
        }
    }
}

function loadGyotai(){
    // 第一パラメータ：公開対象会社選択Index
    var selectedIndex = -1;
    if (arguments.length > 0) {
        selectedIndex = arguments[0];
    }
    document.forms['publicTargetSearch'].elements['publicTargetSearch:selectedCompanyIndex'].value = selectedIndex;
	document.forms['publicTargetSearch'].elements['publicTargetSearch:__link_clicked__'].value='publicTargetSearch:loadGyotai';
//	document.forms['publicTargetSearch'].elements['publicTargetSearch:loadGyotai'].click();
	document.forms['publicTargetSearch'].submit();
	return false;
}

function onChangeMode() {
	document.forms['publicTargetSearch'].elements['publicTargetSearch:__link_clicked__'].value='publicTargetSearch:loadMode';
	document.forms['publicTargetSearch'].submit();
	return false;
}


	/**
	 * 初期化処理
	 *
	 */
	function onLoad() {
		var formobj = document.publicTargetSearch;
	}

	/**
	 * 画面Load時業態選択時連動対象業態区分設定処理
	 *
	 * @formobj 対象フォーム
	 */
	function initRendoGyotaiKbn(formobj) {
		//1.[[グループ別業態選択時連動対象情報]]のグループ数を取得する。
		var rendoGroupCnt = formobj.rendoGroupGyotaiKbnCnt.value;
		//2.グループが存在する場合は下記の処理を行う。
		if(rendoGroupCnt>0) {
			//対象業態区分
			var selectedFlgElement = "";
			//連動業態区分判断フラグ
	        var isRendoGyotaiKbnFlg = false;
	        //連動対象rendoGroupエレメントの名称
	        var rendoGroupEleName = "";
	        //連動対象rendoGroupエレメントオブジェクト
	        var listRendoGroup = null;
			//2-1.グループ毎に下記の処理を行います。
			for(var g=0; g<rendoGroupCnt; g++) {

			    //2-1-1.文字列”rendoGyotaiGroup”と[[グループ別業態選択時連動対象情報]]のインデックスから対象rendoGroupエレメントの名称を生成します。
				rendoGroupEleName = "rendoGyotaiGroup"+g;
				//2-1-2.処理2-1-1の対象rendoGroupエレメントの名称から対象rendoGroupエレメントオブジェクトを取得する。
				listRendoGroup = formobj.elements[rendoGroupEleName];
				//input系エレメントを取得する。
				var elemInputTags = formobj.tags("input");
				var gyotaiIndex = 0;
				for (var i = 0; i < elemInputTags.length; i++) {

		        	if (elemInputTags[i].type == "checkbox" && elemInputTags[i].title == "gyotai") {

		        		var targetGyotaiKbn = formobj.gyotaiKbn[gyotaiIndex].value;
		        		selectedFlgElement = elemInputTags[i];
	        			if(elemInputTags[i].checked) {

							//2-1-3.対象rendoGroupエレメントオブジェクトが存在する場合、下記の処理を行います。
							isRendoGyotaiKbnFlg = isRensoGyotaiKbn(formobj, targetGyotaiKbn, listRendoGroup);
				    		if(isRendoGyotaiKbnFlg) {

						    	//1-3.引数.対象業態区分の連動業態区分判断フラグがtrueの場合下記の処理を行う。
								rendoGyotaiSentakuFlg(formobj, targetGyotaiKbn, listRendoGroup, selectedFlgElement);

				    		}
		        		}
		        		gyotaiIndex++;
		        	}

				}// end of for (i = 0; i < elemInputTags.length; i++)

			}// end of for(i=0; i<rendoGroupCnt; i++)

		}// end of if(rendoGroupCnt>0)
	}
	/**
	 * 業態選択時連動対象業態区分設定処理
	 *
	 * @targetGyotaiKbn 対象業態区分
	 * @formobj 対象フォーム
	 * @index 対象業態区分インデックス
	 */
	function executeRendoGyotaiKbn(selectedFlgElement, formobj, index) {
		//1.[[グループ別業態選択時連動対象情報]]のグループ数を取得する。
		var rendoGroupCnt = formobj.rendoGroupGyotaiKbnCnt.value;
		var targetGyotaiKbn = formobj.elements["gyotaiKbn"][index].value;
		//2.グループが存在する場合は下記の処理を行う。
		if(rendoGroupCnt>0) {

			//連動業態区分判断フラグ
	        var isRendoGyotaiKbnFlg = false;
	        //連動対象rendoGroupエレメントの名称
	        var rendoGroupEleName = "";
	        //連動対象rendoGroupエレメントオブジェクト
	        var listRendoGroup = null;
			//2-1.グループ毎に下記の処理を行います。
			for(var i=0; i<rendoGroupCnt; i++) {

			    //2-1-1.文字列”rendoGyotaiGroup”と[[グループ別業態選択時連動対象情報]]のインデックスから対象rendoGroupエレメントの名称を生成します。
				rendoGroupEleName = "rendoGyotaiGroup"+i;
				//2-1-2.処理2-1-1の対象rendoGroupエレメントの名称から対象rendoGroupエレメントオブジェクトを取得する。
				listRendoGroup = formobj.elements[rendoGroupEleName];
				//2-1-3.対象rendoGroupエレメントオブジェクトが存在する場合、下記の処理を行います。
				isRendoGyotaiKbnFlg = isRensoGyotaiKbn(formobj, targetGyotaiKbn, listRendoGroup);
	    		if(isRendoGyotaiKbnFlg) {
	    			break;
	    		}

			}// end of for(i=0; i<rendoGroupCnt; i++)

	    	//1-3.引数.対象業態区分の連動業態区分判断フラグがtrueの場合下記の処理を行う。
	        if(isRendoGyotaiKbnFlg) {
				rendoGyotaiSentakuFlg(formobj, targetGyotaiKbn, listRendoGroup, selectedFlgElement);
			}
		}
	}
	/**
	 * 指定業態区分が連動業態区分に指定されているか判断する処理
	 *
	 * @formobj 対象フォーム
	 * @targetGyotaiKbn 指定業態区分
	 * @listRendoGroup 指定連動業態区分保持リスト
	 *
	 */
	function isRensoGyotaiKbn(formobj, targetGyotaiKbn, listRendoGroup) {
		//連動業態区分判断フラグ
        var isRendoGyotaiKbnFlg = false;
		//2-1-3.対象rendoGroupエレメントオブジェクトが存在する場合、下記の処理を行います。
		if (listRendoGroup != null && listRendoGroup.length > 0) {

			//3-1.対象rendoGroupエレメントオブジェクトの件数分、下記の処理を行います。
			for(var g=0; g<listRendoGroup.length; g++) {

				//Ⅰ.変数.連動対象業態区分へ対象rendoGroupエレメントオブジェクトから現行インデックスの値を代入する。
				var gGyotaiKbn = listRendoGroup[g].value;
				//Ⅱ.引数.対象業態区分が連動対象のものか判断します。
				if(targetGyotaiKbn == gGyotaiKbn) {

					//Ⅱ-1．選択対象業態区分は連動業態区分なのでtrueを代入する。
					isRendoGyotaiKbnFlg = true;
					//Ⅱ-2．処理②のfor文処理を中断する。
					break;
				}
			}

		}
		return isRendoGyotaiKbnFlg;
	}
	/**
	 * 指定業態区分の連動される全ての業態区分の選択エレメントの値を
	 * 指定業態区分の指定選択エレメントの値と同じに設定する処理
	 *
	 * @formobj 対象フォーム
	 * @targetGyotaiKbn 指定業態区分
	 * @listRendoGroup 指定連動業態区分保持リスト
	 * @selectedFlgElement 指定選択エレメント
	 */
	function rendoGyotaiSentakuFlg(formobj, targetGyotaiKbn, listRendoGroup, selectedFlgElement) {
		//input系エレメントを取得する。
		var elemInputTags = formobj.tags("input");
		var gyotaiIndex = 0;
		for (var i = 0; i < elemInputTags.length; i++) {

        	if (elemInputTags[i].type == "checkbox" && elemInputTags[i].title == "gyotai") {
        		var elemGyotaiKbn = formobj.gyotaiKbn[gyotaiIndex].value;
        		if(isRensoGyotaiKbn(formobj, elemGyotaiKbn, listRendoGroup)) {

        			if(elemInputTags[i].checked != selectedFlgElement.checked) {
        				elemInputTags[i].checked= selectedFlgElement.checked;
        			}
        		}
        		gyotaiIndex++;
        	}

		}// end of for (i = 0; i < elemInputTags.length; i++)
	}

//-->
</SCRIPT>
<form m:id="publicTargetSearch">
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<input type="hidden" m:id="selectedCompanyIndex" m:value="#{publicTargetSearchConditionDto.selectedCompanyIndex}"/>
	<input type="hidden" name="rendoGroupGyotaiKbnCnt" value="#{publicTargetRendoGroupGyotaiKbnCnt}" m:passthrough="true"/>
				<a id="loadMode" m:action="#{publicTargetSearchAction.kirikae}"/>
	<span m:inject="s:forEach" m:items="#{publicTargetListRendoGroupGyotaiKbn}" m:var="listRendoGyotaiGroup" m:varIndex="i">
		<span m:inject="s:forEach" m:items="#{listRendoGyotaiGroup}" m:var="gGyotaiKbn" m:varIndex="g">
			<input type="hidden" name="rendoGyotaiGroup#{i}" value="#{gGyotaiKbn}" m:passthrough="true"/>
		</span>
	</span>
	<table cellpadding="0" cellspacing="0" width="100%">
		<tr>
			<td width="40%">
				<table cellpadding="0" cellspacing="0" width="95%">
					<tr>
					<td>
						<div style="margin-top:0px;margin-bottom:5px">
						<input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
						<input type="submit" value="決定" m:action="#{publicTargetSearchAction.select}" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>
						<input type="button" value="戻る" m:action="#{publicTargetSearchAction.cancel}" />
						<input type="button" value="クリア" m:action="#{publicTargetSearchAction.clear}" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>
						</div>
					</td>
					<td align="right" valign="bottom">
						<input type="button" value="すべてON"  onclick="checkAllCompany(this.form);" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>&nbsp;
						<input type="button" value="すべてOFF" onclick="checkClearAllCompany(this.form);" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>
					</td>
					</tr>
				</table>
			</td>
			<td width="5px" rowspan="2"/>
			<td width="25%" valign="bottom">
				<table cellpadding="0" cellspacing="0" width="90%">
					<tr>
						<td align="right">
				<input type="button" value="すべてON"  onclick="checkAllShozoku(this.form);" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>&nbsp;
				<input type="button" value="すべてOFF" onclick="checkClearAllShozoku(this.form);" m:disabled="#{publicTargetSearchDto.referenceFlg}"/></td>
					</tr>
				</table>
			</td>
			<td width="5px" rowspan="2"/>
			<td width="35%" valign="bottom">
				<table cellpadding="0" cellspacing="0" width="330px">
					<tr>
					<td>
						<div class="hideArea">
						<select class="condition_field" id="mode" m:disabled="#{publicTargetSearchDto.referenceFlg}"
						        m:value="#{publicTargetSearchConditionDto.selectMode}"
						        m:items="#{publicTargetSearchConditionDto.listKirikae}"
						        m:itemValue="value"
						        m:itemLabel="label"
						        m:onchange="onChangeMode()">
						</select>
						</div>
					</td>
					<td m:rendered="#{publicTargetSearchConditionDto.selectMode == '1'}" align="right" valign="bottom">
						<input type="button" value="すべてON"  onclick="checkAllGyotai(this.form);" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>&nbsp;
						<input type="button" value="すべてOFF" onclick="checkClearAllGyotai(this.form);" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>
					</td>
					</tr>
				</table>
			</td>
		</tr>
		<tr>
			<td valign="top">
				<a id="loadGyotai" m:action="#{publicTargetSearchAction.selectCompany}" />
				<table class="body_table2" width="95%">
				  <caption class="body_caption">公開対象会社</caption>
				  <tr class="header_row">
				    <th width="13%">選択</th>
				    <th width="87%">会社名</th>
				  </tr>
				</table>
				<div style="width:100%; height:415px;"class="scroll_area">
					<table class="body_table" width="95%" style="border-top-width:0px">
					    <span m:inject="s:forEach" m:items="#{publicTargetSearchConditionDto.listCtlUserCompany}" m:var="e" m:varIndex="i">
					      <tr>
					        <td width="13%" align="center" style="#{i==0?'border-top-width:0px':''}">
					       			<input type="checkbox" m:id="sentakuFlg" m:value="#{e.sentakuFlg}" title="company" onclick="loadGyotai(#{i})" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>
					        </td>
					        <td width="87%" style="#{i==0?'border-top-width:0px':''}">
					          <span m:converter="#{characterEncodingConverter}" m:value="#{e.companyName}"/>
					        </td>
					      </tr>
					    </span>
					</table>
				</div>
			</td>
			<!--公開対象者の所属-->
			<td valign="top">
				<table class="body_table2" width="90%">
				  <caption class="body_caption">公開対象者の所属</caption>
				  <tr class="header_row">
				    <th width="25%">選択</th>
				    <th width="75%">所属</th>
				  </tr>
				</table>
				<div style="overflow:auto; width:100%; height:415px;" class="scroll_area">
					<table class="body_table" width="90%" style="border-top-width:0px">
					    <span m:inject="s:forEach" m:items="#{publicTargetSearchConditionDto.listCodShozoku}" m:var="e" m:varindex="i">
					      <tr>
					        <td width="25%" align="center" style="#{i==0?'border-top-width:0px':''}">
					       		<input type="checkbox" m:value="#{e.sentakuFlg}" title="shozoku" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>
					        </td>
					        <td width="75%" style="#{i==0?'border-top-width:0px':''}">
					          <span m:converter="#{characterEncodingConverter}" m:value="#{e.shozokuName}"/>
					        </td>
					      </tr>
					    </span>
					</table>
				</div>
			</td>
			<!--公開対象業態 -->
			<td m:rendered="#{publicTargetSearchConditionDto.selectMode == '1'}" colspan="2" valign="top">
				<table class="body_table2" width="330px">
				  <caption class="body_caption" >公開対象業態</caption>
				  <tr class="header_row">
				    <th width="50px">選択</th>
				    <th width="*">業態</th>
				    <th width="40px"> </th>
				    <th width="40px">個別</th>
				  </tr>
				</table>
				<div style="width:350px; height:410px;" class="scroll_area">
					<table class="body_table2"  width="330px"  style="border-top-width:0px">
					    <span m:inject="s:forEach" m:items="#{publicTargetSearchConditionDto.listMstGyotiUneiCompany}" m:var="e" m:varindex="i">
					      <tr class="non_top_border">
					        <td align="center" width="50px">
					       		<input type="checkbox" m:value="#{e.sentakuFlg}" title="gyotai" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>
			       				<input type="hidden" name="gyotaiKbn" value="#{e.gyotaiKbn}" m:passthrough="true"/>
					        </td>
					        <td width="*">
					          <span m:converter="#{characterEncodingConverter}" m:value="#{e.gyotaiName}"/>
					        </td>
					        <td width="40px" align="center">
								<a m:action="#{publicTargetSearchAction.kogetuSet}">個別
								    <span m:inject="f:param" m:name="selectedGyotaiCompanyCd" m:value="#{e.companyCd}"/>
									<span m:converter="#{characterEncodingConverter}" m:inject="f:param" m:name="selectedGyotiKbn" m:value="#{e.gyotaiKbn}"/>
									<span m:converter="#{characterEncodingConverter}" m:inject="f:param" m:name="selectedIndex" m:value="#{i}"/>
								</a>
					        </td>
					        <td width="40px" align="center">
					          <span m:value="#{e.kogetuFlg}"/></td>
					      </tr>
					    </span>
					</table>
				</div>
			</td>

			<!--支部選択 -->
			<td m:rendered="#{publicTargetSearchConditionDto.selectMode == '2'}" colspan="2" valign="top">
				<table cellspacing="0" style="width:330px;margin-top:1px;">
					<caption class="body_caption" >公開対象業態</caption>
				  	<span m:inject="s:forEach" m:items="#{publicTargetSearchConditionDto.companyScreenList}" m:var="rowCompanys" m:varIndex="r">
					<tr>
						<div m:inject="s:forEach" m:items="#{rowCompanys}" m:var="bm05" m:varIndex="i">
				  		<td width="50%" class="body_#{(0==r && 0==i)?'':'non_'}active_cell tab_change_area_#{r==0?i:(r+1+i)}"
				  		    onClick="changeTabArea(#{r==0?i:(r+1+i)});"
				  		    onMouseOver="this.style.cursor='pointer';">
				  		   <span m:converter="#{characterEncodingConverter}" m:inject="h:outputText" m:value="#{bm05.companyName}"/></td>
				  		</div>
				  	</tr>
				  	</span>
	   				<tr style="height:5px;"><td class="body_caption" colspan="3"/></tr>
				</table>
				<table class="body_table2 element_browser"
				       style="width:330px; margin-top:0px;border-bottom-width:0px;">
				  <tr class="header_row">
				    <th width="50px">選択</th>
				    <th width="*">支部取込コード</th>
				  </tr>
				</table>

				<!--会社別支部取込一覧-->

			    <span m:inject="s:forEach" m:items="#{publicTargetSearchConditionDto.listCompanysSibu}" m:var="companys" m:varindex="c">
					<div class="tab_change_area_#{c} #{c==0?'':'in'}visible_tab">
						<div class="element_print">
						<table class="body_table2"
						       style="width:330px; margin-top:0px;border-bottom-width:0px;">
						  <tr class="header_row">
						    <th width="50px">選択</th>
						    <th width="*">支部取込コード</th>
						  </tr>
						</table>
						</div>
						<div class="scroll_area" style="width:350px; height:347px;">
							<table class="body_table" width="330px" style="border-top-width:0px">
							    <span m:inject="s:forEach" m:items="#{companys}" m:var="e" m:varindex="i">
							      <tr>
							        <td width="50px" align="center">
							       		<input type="checkbox" m:value="#{e.sentakuFlg}" m:disabled="#{publicTargetSearchDto.referenceFlg}"/>
							        </td>
							        <td width="*"><span m:converter="#{characterEncodingConverter}" m:inject="h:outputText" m:value="#{e.sibuName}"/></td>
							      </tr>
							    </span>
							</table>
						</div>
					</div>
				</span>

			</td>
		</tr>
	</table>
	<input type="text" m:id="dummyEnter" style="display:none"/>
</form>

</span>
</body>
</html>
