<html xmlns:m="http://www.seasar.org/maya" m:action="#{mlCompletionregistEditAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j" />
<title>マスターライセンス研修修了登録</title>
</head>
<body>
<span m:inject="f:param" m:name="layoutTitle" m:value="マスターライセンス研修修了登録"/>
<span m:inject="f:param" m:name="onLoadName" m:value="load()"/>
<span m:inject="s:insert" m:name="bodyTitleName">■マスターライセンス研修修了登録</span>
<span m:inject="f:param" m:name="viewIdValue" m:value="BSM006V02"/>
<span m:inject="s:insert" m:name="body">
<style type="text/css">
<!--
/* テーブルデフォルト設定 パターン２*/
/* テーブル幅 */
table.body_table2{
  width   : 98.05%;
}
table.ikkatu {
  font-size				: medium;
  color					: white;
  background-color		: navy;
  width					: 100%;
  border                : 0px;
  border-width          : 0px;
  border-collapse       : collapse;
}
table.ikkatu tr td{
  border                : 0px solid;
  background-color		: navy;
}
.col_checkbox {
	width:20px;
}
.col_oner {
	width:*;
}
.col_mise {
	width:200px;
}
.col_name {
	width:150px;
}
.col_corse {
	width:145px;
}
.col_joukyo {
	width:218px;
}
.col_nengetu {
	width:65px;
}

-->
</style>

<script type="text/javascript">
<!--
function load(){
	loadScroll("mlcompletionScroll", 280);
	focusElement('editForm');
}
/**
 * 一括設定処理
 *
 *　『一括設定』ボタン押下時に設定されている値を
 *  登録対象の全件に対して設定を行う
 *
 *
 */
function paramSetUp() {
	var regListCnt = document.editForm.DATA_CNT.value;
	var setUpCourseCdIndex = 0;
	if(document.editForm.SETUP_COURSECD != null) {
		//出張研修の場合のみコースコード取得
		setUpCourseCdIndex = document.editForm.SETUP_COURSECD.selectedIndex;
	}
	//設定状況取得
	var setUpStatusIndex = 0;
	if (document.editForm.SETUP_STATUS != null) {
		for(s=0; s<3; s++) {
			if(document.editForm.SETUP_STATUS[s].checked) {
				setUpStatusIndex = s;
				break;
			}
		}//end of for
	}

	//設定年月取得
	var setUpYm = document.editForm.SETUP_YM.value;
	if(formatDate(setUpYm) == "") {
		alert(document.editForm.setUpYmAlert.value);
		document.editForm.SETUP_YM.focus();
	}

	for (i=0; i<regListCnt; i++) {
		var targetCdName="";
		var targetNameName = "";
		if (document.editForm.SETUP_COURSECD != null) {
			//更新研修の場合のみ
			//コース一括設定
			targetCdName=targetElementName("editForm", "compleCourseCd", i);
			document.editForm.elements[targetCdName].selectedIndex = setUpCourseCdIndex;
			targetNameName=targetElementName("editForm", "compleCourseName", i);
			document.editForm.elements[targetNameName].value = document.editForm.elements[targetCdName].options[setUpCourseCdIndex].text;
		}

		if (document.editForm.SETUP_STATUS != null) {
			//ベーシック・更新研修の場合のみ
			//状況一括設定
			var targetStatusName =targetElementName("editForm", "courseStatus", i);
			document.editForm.elements[targetStatusName][setUpStatusIndex].click();
		}

		if(setUpYm.replace(/ /g, "") != "") {
			//年月一括設定
			var targetDtName =targetElementName("editForm", "compleCourseDt", i);
			document.editForm.elements[targetDtName].value=formatDate(setUpYm);
		}
	}//end of for
}
//日付フォーマット(YYYY/MM）処理
//許可するフォーマットは、以下の10種類
// YYYYMM		,	YYYY/MM
function formatDate(date){
	var fDate="";

	//「/」なし入力
	if( date.indexOf("/") == -1 ){
		//「YYYYMM」以外はエラー
		if( !(date.length == 6) ){
			return "";
		}

		//YYMMDD入力
		else if( date.length == 6 ){
			fDate = date.substring(0,4) + "/" + date.substring(4, 6) ;
		}
	}
	//「/」あり入力
	else{
		var tmpDate = date.split("/");
		if( tmpDate.length != 2 ){
			return "";
		}

		//年
		if( !(tmpDate[0].length == 4) ){
			return "";
		}
		//「YYYY」入力
		if( tmpDate[0].length == 4 ){
			//処理なし
		}

		//月
		if( !(tmpDate[1].length == 1 || tmpDate[1].length == 2) ){
			return "";
		}
		//「M」入力
		if( tmpDate[1].length == 1 ){
			tmpDate[1] = "0" + tmpDate[1];
		}
		//「MM」入力
		else if( tmpDate[1].length == 2 ){
			//処理なし
		}
		fDate = tmpDate[0] + "/" + tmpDate[1];
	}
	return fDate;
}

/**
 * 確認ボタン押下ファンクション
 *
 * 1.登録対象フラグ値 チェック状態別値設定処理を行う。
 * 2.アクションロジックへ実行処理を起動する。
 *
 */
function doActionExecute() {

	//2.アクションロジックへ実行処理を起動する。
	var f=document.forms['editForm'];
	f.target='';
	f.elements['editForm:__link_clicked__'].value='editForm:doExecute1';
	f.submit();
	return false;
}
//-->
</script>
<form m:id="editForm">
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<a id="doExecute1" m:action="#{mlCompletionregistEditAction.execute}"/>
	<input type="hidden" m:id="viewId" m:value="#{viewIdValue}"/>
	<input type="hidden" name="setUpYmAlert" m:value="#{mlCompletionregistDto.ymAlert}" m:passthrough="true"/>
	<input type="hidden" name="DATA_CNT" m:value="#{mlCompletionregistDto.registDataListSize}"  m:passthrough="true"/>

	<div class="search_condition">
<!-- 検索条件 -->
		<input type="button" value="戻る" class="operation_button" m:action="#{mlCompletionregistEditAction.back}"/>&nbsp;&nbsp;
		<input type="button" value="確認" class="operation_button" onClick="doActionExecute();" />
	<table class="hiddenBody" style="margin-top:4px">
		<tr>
			<td>
				<table class="body_table" width="400">
					<caption class="body_title" style="padding:2px 0px;">選択対象</caption>
					<tr>
						<th>研修名</th>
						<td><span m:converter="#{characterEncodingConverter}" m:value="#{mlCompletionregistDto.entryNameKj}" /></td>
					</tr>
					<tr>
						<th>タイトル</th>
						<td><span m:converter="#{characterEncodingConverter}" m:value="#{mlCompletionregistDto.entryTitle}" /></td>
					</tr>
				    <tr>
				        <th>会社</th>
						<td><span m:converter="#{characterEncodingConverter}" m:value="#{mlCompletionregistDto.companyName}" /></td>
				    </tr>
				    <tr>
				        <th>支部</th>
						<td><span m:converter="#{characterEncodingConverter}" m:value="#{mlCompletionregistDto.sibuName}" /></td>
				    </tr>
				    <tr>
				        <th width="100px">オプション</th>
						<td><span m:converter="#{characterEncodingConverter}" m:value="#{mlCompletionregistDto.optionNote}" /></td>
				    </tr>
				</table>
			</td>
			<span m:rendered="#{mlCompletionregistDto.optionFLg}">
			<td valign="top">&nbsp;&nbsp;
			</td>
			<td valign="top">
				<table class="body_table">
					<caption class="body_title">
						<div style="float:left;padding:2px 0px;">一括設定</div>
						<div style="float:right">
						<input type="button" value="一括設定" m:action="#{mlCompletionregistEditAction.paramSetUp}"/>
						</div>
					</caption>
	<!--
					<span m:rendered="#{mlCompletionregistDto.renewalEntry}">
				    <tr>
				        <th>コース名</th>
				        <td>
							<!--div class="hideArea">
							<select name="SETUP_COURSECD" m:passthrough="true">
								<span m:inject="s:forEach" m:items="#{mlCompletionregistDto.courseList}" m:var="e">
								<option m:value="#{e.courseCd}" m:passthrough="true"><span m:converter="#{characterEncodingConverter}" m:value="#{e.courseName}" /></option>
								</span>
							</select>
							</div-->
	<!--
					        <div class="hideArea">
					          <select m:id="SETUP_COURSECD"
					                  m:value="#{mlCompletionregistDto.courseListIndex}"
					                  m:items="#{mlCompletionregistDto.courseList}"
					                  m:itemValue="courseCd"
					                  m:itemLabel="courseName">
					              <option value="">選択</option>
					              <option value="">MOS</option>
					          </select>
					        </div>
						</td>
				    </tr>
					</span>
	-->
					<span m:rendered="#{mlCompletionregistDto.basicEntry}">
				    <tr>
				        <th>状況</th>
				        <td>
							<!--input type="radio" name="SETUP_STATUS" value="0" m:passthrough="true"/>&nbsp;未修了&nbsp;&nbsp;&nbsp;
							<input type="radio" name="SETUP_STATUS" value="1" m:passthrough="true" checked = "checked"/>&nbsp;修了&nbsp;&nbsp;&nbsp;
							<input type="radio" name="SETUP_STATUS" value="2" m:passthrough="true"/>&nbsp;予定-->
						  <span m:converter="#{characterEncodingConverter}" m:inject="s:selectOneRadio2" m:value="#{mlCompletionregistDto.paramCourseStatus}">
							<input type="radio" name="paramCourseStatus" value="0" />&nbsp;未修了&nbsp;&nbsp;&nbsp;
							<input type="radio" name="paramCourseStatus" value="1"  checked = "checked"/>&nbsp;修了&nbsp;&nbsp;&nbsp;
							<input type="radio" name="paramCourseStatus" value="2" />&nbsp;予定
						  </span>
						</td>
				    </tr>
					</span>
				    <tr>
				        <th width="100px">年月</th>
				        <td>
							<!--input type="text" m:id="SETUP_YM" name="SETUP_YM" m:value="#{mlCompletionregistDto.setUpYm}" size="10" maxlength="7"  style="ime-mode:disabled" m:passthrough="true" /-->
							<input type="text" m:id="setUpYm" m:value="#{mlCompletionregistDto.setUpYm}" size="10" maxlength="7" style="ime-mode:disabled" m:converter="#{dateConverterYM}" />
						</td>
				    </tr>
				</table>
			</td>
			</span>
		</tr>
	</table>
<div class="scroll_padding_head">
<div class="scroll_hidden margin_bottom_hidden">
<!-- ★★★★対象研修者一覧ヘッダー部　START★★★★ -->
<table class="body_table2" style="margin-top:5px">
	<caption class="body_title body_title_width" style="padding:2px 0px;">研修者一覧</caption>
  <tr class="header_row">
    <th class="col_checkbox"></th>
    <th class="col_oner">オーナー名</th>
    <th class="col_mise">店舗名</th>
    <th class="col_name">氏名</th>
    <th class="col_corse">コース名</th>
    <th class="col_joukyo">修了状況</th>
    <th class="col_nengetu">年月</th>
  </tr>
</table>
</div>
</div>
<!-- ★★★★対象研修者一覧ヘッダー部　END★★★★ -->
<!-- ★★★★対象研修者一覧ボディー部　END★★★★ -->
<div class="scroll_padding_data">
<div class="scroll_standby" id="mlcompletionScroll">
<table class="body_table2" style="border-top-width : 0px;">
	<div m:inject="s:forEach" m:items="#{mlCompletionregistDto.registDataList}" m:var="e" m:varindex="i">
      <tr style="line-height:21px; #{e.entryFlg == '0'? 'color:blue':''}" class="non_top_border">
        <td class="col_checkbox">
          	<input type="checkbox" m:value="#{e.changeRegFlg}"/>
        </td>
        <td class="col_oner">
          <span m:converter="#{characterEncodingConverter}" m:value="#{e.onerNameKj}"/>
        </td>
        <td class="col_mise">
          <span m:converter="#{characterEncodingConverter}" m:value="#{e.miseNameKj}" />
        </td>
        <td class="col_name">
          <span m:converter="#{characterEncodingConverter}" m:value="#{e.staffLNameKj}" />&nbsp;<span m:converter="#{characterEncodingConverter}" m:value="#{e.staffFNameKj}" />
        </td>
        <td class="col_corse">
		   	<span m:converter="#{characterEncodingConverter}" m:value="#{e.compleCourseName}" />
			<span m:rendered="#{mlCompletionregistDto.renewalEntry}">
				<input type="hidden" m:id="compleCourseName" m:value="#{e.compleCourseName}" />
			</span>
        </td>
        <td class="col_joukyo">
			<span m:converter="#{characterEncodingConverter}" m:inject="s:selectOneRadio2" m:id="courseStatus" m:value="#{e.courseStatus}">
				<input type="radio" value="0"/>&nbsp;未修了&nbsp;
				<input type="radio" value="1"/>&nbsp;修了&nbsp;
				<input type="radio" value="2" checked="checked"/>&nbsp;予定
			</span>
		</td>
        <td class="col_nengetu">
			<input type="text" class="width_50" m:id="compleCourseDt" name="compleCourseDt" m:value="#{e.compleCourseDt}" size="8" maxlength="7" m:converter="#{dateConverterYM}" style="ime-mode:disabled"/>
		</td>
      </tr>
      </div>
	</table>
</div>
</div>

</div>
<input type="text" m:id="dummyEnter" style="display:none"/>
</form>
</span>

</body>
</html>
