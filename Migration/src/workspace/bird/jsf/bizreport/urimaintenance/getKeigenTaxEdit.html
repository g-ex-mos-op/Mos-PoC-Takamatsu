<html xmlns:m="http://www.seasar.org/maya" m:action="#{uriMaintenanceGetKeigenTaxEditAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j"/>
<title>売上修正(軽減税率編集画面)</title>
</head>
<body>
<span m:inject="f:param" m:name="layoutTitle" m:value="売上修正(軽減税率編集画面)"/>
<span m:inject="s:insert" m:name="bodyTitleName">■売上修正(軽減税率編集画面)</span>
<span m:inject="f:param" m:name="onLoadName" m:value="load();"/>
<span m:inject="f:param" m:name="viewIdValue" m:value="BBR008V06"/>
<span m:converter="#{characterEncodingConverter}" m:inject="f:param" m:name="scrollwidth" m:value="#{1072}"/>
<span m:inject="f:param" m:name="dayRowCnt" m:value="#{(uriMaintenanceDto.resultData.listDataCnt-1)<=11?uriMaintenanceDto.resultData.listDataCnt-1:(uriMaintenanceDto.syukeiKbnResultData.tabCnt>10?12:13)}"/>
<div m:inject="s:insert" m:name="body">
<style type="text/css">
<!--
.list_tab_area {
    width               : 100%;
    margin-top:4px;
    display:block;
}

table.body_table2 tr td{
  text-align            : right;
  border-top-width:0px;
}
table.list_width {
	width:1068px;
}
table.list_data {
	border-top-width:0px;
	border-bottom-width:0px;
}
table.list_data tr{
  line-height:22px;
}
table.list_data tr td{
  padding-bottom: 0px;
}
.input_area{
  text-align: right;
}
table.list_data tr td{
  padding-bottom: 0px;
  padding-top: 0px;
}

.col_eigyoDt {
	width:67px;
}
.col_ken {
	width:73px;
}
.col_kin {
	width:95px;
}
table.body_table2 tr td.col_total {
	background-color      : #FFC0A0;
}
.col_head {
	width:65px;
	text-align:right;
}
.col_data {
	width:60px;
	text-align:right;
}
.col_view0 {
	width:80px;
	text-align:right;
}
.col_view1 {
	width:75px;
	text-align:right;
}
.col_view2 {
	width:77px;
	text-align:right;
}
.scroll_head {
	overflow : hidden;
	height     : 350px;
	width      : 1395px;
	position: absolute;
}
.scroll_body {
	position: absolute;
	overflow : auto;
	top: 218px;
    left: 6px;
    right: 0;
    bottom: 0;
	height     : 350px;
	width      : 1395px;
}
-->
</style>
<script type="text/javascript">
<!--
function load() {
	focusElement("kaigenTaxform");
	resetLoadingFlg();
}
function setLoadingFlg() {
	document.kaigenTaxform.elements['kaigenTaxform:loadingFlg'].value = "ON";
}
function resetLoadingFlg() {
	document.kaigenTaxform.elements['kaigenTaxform:loadingFlg'].value = "";
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function returnLoadingStatus(){
	if(isLoadingFlgOFF()) {
		setLoadingFlg();
		return true;
	}
	return false;
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function isLoadingFlgOFF(){
	return (document.kaigenTaxform.elements['kaigenTaxform:loadingFlg'].value != "ON");
}
function execAction(targetAction) {
 if(returnLoadingStatus()) {
	document.kaigenTaxform.elements['kaigenTaxform:__link_clicked__'].value='kaigenTaxform:'+targetAction;
	document.kaigenTaxform.submit();
  }
  return false;
}

/**
 * タブ切替時処理
 */
function changeTab(targetTabNo) {
	document.kaigenTaxform.elements['kaigenTaxform:targetTabNo'].value=targetTabNo;
	return execAction("changeTab");
}
/** 画面内タブ制御処理 **/
function enterTAB(e, formName, sLastFocusID, sFirstFocusID){

	var event = e || event;
	var isMsie = (document.all) ? true : false;
	var key;
    var srcobj;
	if (isMsie) { // IE
        key = event.keyCode;
        srcobj=event.srcElement;
    }
    else { // IE以外
        key = event.which;
        srcobj=event.target;
    }

	if(key == 13
			&& srcobj.type != 'button'
			&& srcobj.type != 'submit'
			&& srcobj.type != 'reset'
			&& srcobj.type!='textarea'
			&& srcobj.type!='') {

		var f = document.forms[formName];

		var listSizeId = formName + ":listSize";
        var size = f.elements[listSizeId].value;
        var idx = size - 1;
        eventid = srcobj.id;
        idsplit = eventid.split('_');
        idkey = idsplit[1];

		sFirstFocusID = formName + ':_' + idkey + '_0:' + sFirstFocusID;
		sLastFocusID  = formName + ':_' + idkey + '_' + idx + ':' + sLastFocusID;

		if (sLastFocusID != null
				&& sFirstFocusID != null
				&& eventid == sLastFocusID) {
			if(isMsie)
				document.all(sFirstFocusID).focus();
			else
				f.elements[sFirstFocusID].focus();
			return false;
		}

        if(isMsie){ // IE
			try {
				window.event.keyCode = 0x09;
			}
			catch(e) {
				event.returnValue = false;
			}
		} else { // IE以外
            var el=getNextElement(srcobj);
            if (el.type!='hidden')
                ;   //nothing to do here.
            else
                while(el.type == 'hidden')
                    el = getNextElement(el);
            if( !el )
                return false;
            else
                el.focus();
            return false;
        }
	}

	return true;
}

//次の構成要素を取得
function getNextElement(field) {
    var form = field.form;
    for(var e = 0; e < form.elements.length; e++) {
        if (field == form.elements[e])
            break;
    }
    return form.elements[++e % form.elements.length];
}

//戻る
function returnEdit() {
  if(returnLoadingStatus()) {
	  var msg = document.backform.elements['backform:backmsg'].value;
	  if(document.kaigenTaxform.elements['kaigenTaxform:listSize'].value == -1 || confirm(msg)) {
		document.backform.elements['backform:__link_clicked__'].value='backform:returnEdit';
		document.backform.submit();
	  } else {
	  	resetLoadingFlg();
	  }
  }
}

window.onload=function(){
	focusElement("kaigenTaxform");
	resetLoadingFlg();
    function $(id){return document.getElementById(id) }
    var hDiv=$('hDiv'),dDiv=$('dDiv'),tb0=$('tb0'),tb1=$('tb1');
  //hDivとdDivが一緒に転がります
  if(dDiv!=null){
	  dDiv.onscroll=function(){
		  hDiv.style.left  = dDiv.scrollLeft*-1 +'px'
	  }
  }
  //エラーが発生時、dDiv.topをリセットする
  var a =document.getElementById("errMsg");
  if(a!=null && a!=""){
	  if(a.innerText!=null && a.innerText!="" && a.innerText=="該当データがありません。"){
			 document.getElementById("decideButton").style.display="none";
			 document.getElementById("allDiv").style.display="none";

	  }
  }
}
-->
</script>
<form m:id="kaigenTaxform" style="display:inline;">
	<input type="hidden" m:id="windowId" m:value="#{uriMaintenanceDto.windowId}"/>
	<input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<input type="hidden" m:id="listSize" m:value="#{(uriMaintenanceDto.resultData.listDataCnt-1)}" m:passthrough="true"/>
	<input type="hidden" m:value="#{uriMaintenanceDto.viewSessionKey}"/>
	<input type="hidden" m:id="skTabNo" m:value="#{uriMaintenanceDto.skTabNo}"/>
	<input type="hidden" m:id="targetTabNo" m:value="#{uriMaintenanceGetKeigenTaxEditAction.targetTabNo}"/>
	<input type="hidden" name="maxScrollHeight"
	       m:value="#{uriMaintenanceDto.viewIndex=='0'?'298':'252'}" m:passthrough="true"/>
	<input type="hidden" id="loadingFlg" value=""/>
	<span  class="element_browser">
		<input type="button" value="戻る" onclick="returnEdit();"/>
		<input id ="decideButton" type="button" value="決定" onclick="execAction('decide');" onDblClick="return false;"/>
	</span>
	<input type="hidden" m:id="syukeiKbn" m:value="#{uriMaintenanceDto.syukeiKbn}"/>
	<a m:id="calculate" m:action="#{uriMaintenanceGetKeigenTaxEditAction.calculate}"></a>
	<a m:id="decide" m:action="#{uriMaintenanceGetKeigenTaxEditAction.decide}"></a>
	<a m:id="changeTab" m:action="#{uriMaintenanceGetKeigenTaxEditAction.changeTab}"></a>
	<table class="body_table2" style="margin-top:4px;margin-bottom:2px;">
	    <tr>
	      <th>会社</th>
	      <td><span m:converter="#{characterEncodingConverter}" m:value="#{uriMaintenanceDto.condCompanyNm}"></span>&nbsp;</td>
	      <th>店コード</th>
	      <td><span m:value="#{uriMaintenanceDto.condMiseCd}"
	      	      m:converter="#{uriMainteCodeConverterMise}"></span>&nbsp;
	      	  <span m:converter="#{characterEncodingConverter}" m:value="#{uriMaintenanceDto.condMiseNm}"></span>&nbsp;</td>
	      <th>対象年月</th>
	      <td><span m:converter="#{characterEncodingConverter}" m:value="#{uriMaintenanceDto.condTargetYm}"
	                m:converter="#{uriMainteDateConverterYM}"></span>&nbsp;</td>
	    </tr>
	</table>
	<!--結果表示エリア-->
	<!-- <div m:rendered="#{uriMaintenanceDto.resultData != null && uriMaintenanceDto.resultData.exist}"> -->
	<!-- タブ部 -->
		<table cellspacing="0" cellpadding="0" class="list_width element_browser">
		<tr><td>
			    <ul class="list_tab_area">
			        <li class="body_active_cell"
			          style="width:85px;">
			          <a href="javaScript:void(0);" onClick="return changeTab('01');" onDblClick="return false;">その1</a>
			        </li>
			    </ul>
			</td>
			<td width="*" align="right" valign="bottom">
				<input type="button" value="再計算" onClick="return execAction('calculate');" onDblClick="return false;"/>
			</td>
		</tr>
		</table>
		<!-- タブ帯部 -->
		<table class="body_caption list_width element_browser" style="clear:both;" cellspacing="0" cellpadding="0">
		  <tr style="height:5px;"><td></td></tr>
		</table>
	<!--結果表示エリア:ヘッダー部-->
		<span class="element_print" m:value="【#{uriMaintenanceDto.resultData.keyName}タブ】"></span>
		<table class="body_table2">
					<tr class="header_row">
						<th class="col_eigyoDt" rowspan="2">営業日</th><!--営業日-->
						<th colspan="6">売上</th><!--売上<-->
						<th colspan="6">消費税</th><!--消費税-->
					</tr>
					<tr class="header_row">
						<th class="col_view0">通常税率対象</th>
						<th class="col_view0">軽減税率対象</th>
						<th class="col_view0">予備3</th>
						<th class="col_view0">予備4</th>
						<th class="col_view0">予備5</th>
						<th class="col_view0">合計</th>
						<th class="col_view0">通常税率対象</th>
						<th class="col_view0">軽減税率対象</th>
						<th class="col_view0">予備3</th>
						<th class="col_view0">予備4</th>
						<th class="col_view0">予備5</th>
						<th class="col_view0">合計</th>
					</tr>
				</table>
		<!--結果表示エリア:データー部-->
		<div class="scroll_area" id ="dDiv"  style="width:#{scrollwidth}px;height:#{dayRowCnt*23}px;">
			<table class="body_table2 list_data" id ="tb1">
				<div m:inject="s:forEach" m:items="#{uriMaintenanceDto.listGetKeigenTaxData}" m:var="meisai" m:varindex="d">
					<!--売上金-->
			        <span>
						<tr m:rendered="#{meisai.eigyoDt != null}" >
							<td class="col_eigyoDt" style="text-align:left"><span m:value="#{meisai.eigyoDt}" m:converter="#{uriMainteDateConverterDE}"></span></td><!--営業日-->
							<td class="col_view0"><input m:id="uriage1" class="col_view1" type="text" size="10" maxlength="13" m:value="#{meisai.uriage1}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--売上_通常税率対象-->
							<td class="col_view0"><input m:id="uriage2" class="col_view1" type="text" size="10" maxlength="13" m:value="#{meisai.uriage2}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--売上_軽減税率対象-->
							<td class="col_view0"><input m:id="uriage3" class="col_view1" type="text" size="10" maxlength="13" m:value="#{meisai.uriage3}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--売上_予備3-->
							<td class="col_view0"><input m:id="uriage4" class="col_view1" type="text" size="10" maxlength="13" m:value="#{meisai.uriage4}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--売上_予備4-->
							<td class="col_view0"><input m:id="uriage5" class="col_view1" type="text" size="10" maxlength="13" m:value="#{meisai.uriage5}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--売上_予備5-->
							<td class="col_view0 col_total"><span  m:value="#{meisai.uriage1 + meisai.uriage2 + meisai.uriage3 + meisai.uriage4+ meisai.uriage5}" m:converter="#{numConverter}"></span></td><!--合計(売上)-->
							<td class="col_view0"><input m:id="tax1" class="col_view1" type="text" size="10" maxlength="7" m:value="#{meisai.tax1}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--消費税_通常税率対象-->
							<td class="col_view0"><input m:id="tax2" class="col_view1" type="text" size="10" maxlength="7" m:value="#{meisai.tax2}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--消費税_軽減税率対象-->
							<td class="col_view0"><input m:id="tax3" class="col_view1" type="text" size="10" maxlength="7" m:value="#{meisai.tax3}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--消費税_予備3-->
							<td class="col_view0"><input m:id="tax4" class="col_view1" type="text" size="10" maxlength="7" m:value="#{meisai.tax4}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--消費税_予備4-->
							<td class="col_view0"><input m:id="tax5" class="col_view1" type="text" size="10" maxlength="7" m:value="#{meisai.tax5}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--消費税_予備5-->
							<td class="col_view0 col_total"><span  m:value="#{meisai.tax1 + meisai.tax2 + meisai.tax3 + meisai.tax4 + meisai.tax5}" m:converter="#{numConverter}"></span></td><!--合計(消費税)-->
						</tr>
				    </span>
				</div>
			</table>
		</div>
		<!-- 結果表示エリア:合計行 -->
		<table class="body_table2" style="margin-top:0px;text-align:right; margin-bottom:3px">
	        <tr class="body_sum5 non_top_border">
				<td class="col_eigyoDt" style="text-align:left">合計</td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumUriage1}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumUriage2}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumUriage3}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumUriage4}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumUriage5}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.totalUriage}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumTax1}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumTax2}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumTax3}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumTax4}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.sumTax5}" m:converter="#{numConverter}"></span></td>
				<td class="col_view0"><span m:value="#{uriMaintenanceDto.uiMeisaiKeigenTaxInfo.totalTax}" m:converter="#{numConverter}"></span></td>
		    </tr>
		</table>

	<!--結果表示エリア:スクロール終了-->
	<!-- </div>  -->
</form>
<form m:id="backform" style="display:inline;">
	<input type="hidden" m:id="windowId" m:value="#{uriMaintenanceDto.windowId}"/>
	<input type="hidden" m:id="backmsg" m:value="#{uriMaintenanceDto.msgKKbnBackAlert}"/>
	<input type="hidden" m:id="skTabNo" m:value="#{uriMaintenanceDto.skTabNo}"/>
	<input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<input type="hidden" m:id="syukeiKbn" m:value="#{uriMaintenanceDto.syukeiKbn}"/>
	<input type="hidden" m:value="#{uriMaintenanceDto.viewSessionKey}"/>
	<a m:id="returnEdit" m:action="#{uriMaintenanceGetKeigenTaxEditAction.returnEdit}"></a>
</form>
</div>
</body>
</html>
