<html xmlns:m="http://www.seasar.org/maya" m:action="#{uriMaintenanceKaikeiKbnEditAction.initialize}" m:extends="/jsf/layout/layoutNoNavi.html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-31j"/>
<title>売上修正(会計区分編集画面)</title>
</head>
<body>
<span m:inject="f:param" m:name="layoutTitle" m:value="売上修正(会計区分編集画面)"/>
<span m:inject="s:insert" m:name="bodyTitleName">■売上修正(会計区分編集画面)</span>
<span m:inject="f:param" m:name="onLoadName" m:value="load();"/>
<span m:inject="f:param" m:name="viewIdValue" m:value="BBR008V04"/>
<span m:converter="#{characterEncodingConverter}" m:inject="f:param" m:name="scrollwidth" m:value="#{((174)*uriMaintenanceDto.resultData.listHeaderCnt)+247+12+17}"/>
<span m:inject="f:param" m:name="dayRowCnt" m:value="#{(uriMaintenanceDto.resultData.listDataCnt-1)<=11?uriMaintenanceDto.resultData.listDataCnt-1:(uriMaintenanceDto.syukeiKbnResultData.tabCnt>10?12:13)}"/>
<div m:inject="s:insert" m:name="body">
<style type="text/css">
<!--
.list_tab_area {
    width               : 100%;
    margin-top:4px;
    display:block;
}

table.body_table2 tr td{
  text-align            : right;
  border-top-width:0px;
}
table.list_width {
	width:955px;
}
table.list_data {
	border-top-width:0px;
	border-bottom-width:0px;
}
table.list_data tr{
  line-height:22px;
}
table.list_data tr td{
  padding-bottom: 0px;
}
.input_area{
  text-align: right;
}
table.list_data tr td{
  padding-bottom: 0px;
  padding-top: 0px;
}

.col_eigyoDt {
	width:67px;
}
.col_ken {
	width:73px;
}
.col_kin {
	width:95px;
}
table.body_table2 tr td.col_total {
	background-color      : #FFC0A0;
}
.col_totalken {
	width:80px;
}
.col_totalkin {
	width:100px;
}
-->
</style>
<script type="text/javascript">
<!--
function load() {
	focusElement("kaikeiform");
	resetLoadingFlg();
}
function setLoadingFlg() {
	document.kaikeiform.elements['kaikeiform:loadingFlg'].value = "ON";
}
function resetLoadingFlg() {
	document.kaikeiform.elements['kaikeiform:loadingFlg'].value = "";
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function returnLoadingStatus(){
	if(isLoadingFlgOFF()) {
		setLoadingFlg();
		return true;
	}
	return false;
}
/**
 * ウィンドウロードステータス取得処理
 *
 */
function isLoadingFlgOFF(){
	return (document.kaikeiform.elements['kaikeiform:loadingFlg'].value != "ON");
}
function execAction(targetAction) {
 if(returnLoadingStatus()) {
	document.kaikeiform.elements['kaikeiform:__link_clicked__'].value='kaikeiform:'+targetAction;
	document.kaikeiform.submit();
  }
  return false;
}

/**
 * タブ切替時処理
 */
function changeTab(targetTabNo) {
	document.kaikeiform.elements['kaikeiform:targetTabNo'].value=targetTabNo;
	return execAction("changeTab");
}
/** 画面内タブ制御処理 **/
function enterTAB(e, formName, sLastFocusID, sFirstFocusID){

	var event = e || event;
	var isMsie = (document.all) ? true : false;
	var key;
    var srcobj;
	if (isMsie) { // IE
        key = event.keyCode;
        srcobj=event.srcElement;
    }
    else { // IE以外
        key = event.which;
        srcobj=event.target;
    }

	if(key == 13
			&& srcobj.type != 'button'
			&& srcobj.type != 'submit'
			&& srcobj.type != 'reset'
			&& srcobj.type!='textarea'
			&& srcobj.type!='') {

		var f = document.forms[formName];

		var listSizeId = formName + ":listSize";
        var size = f.elements[listSizeId].value;
        var idx = size - 1;
        eventid = srcobj.id;
        idsplit = eventid.split('_');
        idkey = idsplit[1];

		sFirstFocusID = formName + ':_' + idkey + '_0:' + sFirstFocusID;
		sLastFocusID  = formName + ':_' + idkey + '_' + idx + ':' + sLastFocusID;

		if (sLastFocusID != null
				&& sFirstFocusID != null
				&& eventid == sLastFocusID) {
			if(isMsie)
				document.all(sFirstFocusID).focus();
			else
				f.elements[sFirstFocusID].focus();
			return false;
		}

        if(isMsie){ // IE
			try {
				window.event.keyCode = 0x09;
			}
			catch(e) {
				event.returnValue = false;
			}
		} else { // IE以外
            var el=getNextElement(srcobj);
            if (el.type!='hidden')
                ;   //nothing to do here.
            else
                while(el.type == 'hidden')
                    el = getNextElement(el);
            if( !el )
                return false;
            else
                el.focus();
            return false;
        }
	}

	return true;
}

//次の構成要素を取得
function getNextElement(field) {
    var form = field.form;
    for(var e = 0; e < form.elements.length; e++) {
        if (field == form.elements[e])
            break;
    }
    return form.elements[++e % form.elements.length];
}

//戻る
function returnEdit() {
  if(returnLoadingStatus()) {
	  var msg = document.backform.elements['backform:backmsg'].value;
	  if(document.kaikeiform.elements['kaikeiform:listSize'].value == -1 || confirm(msg)) {
		document.backform.elements['backform:__link_clicked__'].value='backform:returnEdit';
		document.backform.submit();
	  } else {
	  	resetLoadingFlg();
	  }
  }
}
-->
</script>
<form m:id="kaikeiform" style="display:inline;">
	<input type="hidden" m:id="windowId" m:value="#{uriMaintenanceDto.windowId}"/>
	<input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<input type="hidden" m:id="listSize" m:value="#{(uriMaintenanceDto.resultData.listDataCnt-1)}" m:passthrough="true"/>
	<input type="hidden" m:value="#{uriMaintenanceDto.viewSessionKey}"/>
	<input type="hidden" m:id="skTabNo" m:value="#{uriMaintenanceDto.skTabNo}"/>
	<input type="hidden" m:id="targetTabNo" m:value="#{uriMaintenanceKaikeiKbnEditAction.targetTabNo}"/>
	<input type="hidden" name="maxScrollHeight"
	       m:value="#{uriMaintenanceDto.viewIndex=='0'?'298':'252'}" m:passthrough="true"/>
	<input type="hidden" id="loadingFlg" value=""/>
	<span  class="element_browser">
	<input type="button" value="戻る" onclick="returnEdit();"/>
	<span m:rendered="#{uriMaintenanceDto.syukeiKbnResultData != null && uriMaintenanceDto.syukeiKbnResultData.exist}">
	<input type="button" value="決定" onclick="execAction('decide');" onDblClick="return false;"/></span>
	</span>
	<input type="hidden" m:id="syukeiKbn" m:value="#{uriMaintenanceDto.syukeiKbn}"/>
	<a m:id="calculate" m:action="#{uriMaintenanceKaikeiKbnEditAction.calculate}"/>
	<a m:id="decide" m:action="#{uriMaintenanceKaikeiKbnEditAction.decide}"/>
	<a m:id="changeTab" m:action="#{uriMaintenanceKaikeiKbnEditAction.changeTab}"/>
	<table class="body_table2" style="margin-top:4px;margin-bottom:2px;">
	    <tr>
	      <th>会社</th>
	      <td><span m:converter="#{characterEncodingConverter}" m:value="#{uriMaintenanceDto.condCompanyNm}"/>&nbsp;</td>
	      <th>店コード</th>
	      <td><span m:value="#{uriMaintenanceDto.condMiseCd}"
	      	      m:converter="#{uriMainteCodeConverterMise}"/>&nbsp;
	      	  <span m:converter="#{characterEncodingConverter}" m:value="#{uriMaintenanceDto.condMiseNm}"/>&nbsp;</td>
	      <th>対象年月</th>
	      <td><span m:converter="#{characterEncodingConverter}" m:value="#{uriMaintenanceDto.condTargetYm}"
	                m:converter="#{uriMainteDateConverterYM}"/>&nbsp;</td>
	      <th>集計区分名称</th>
	      <td><span m:converter="#{characterEncodingConverter}" m:value="#{uriMaintenanceDto.syukeiKbnName}"/>&nbsp;</td>
	    </tr>
	</table>
	<!--結果表示エリア-->
	<div m:rendered="#{uriMaintenanceDto.syukeiKbnResultData != null && uriMaintenanceDto.syukeiKbnResultData.exist}">
	<!-- タブ部 -->
	<table cellspacing="0" cellpadding="0" class="list_width element_browser">
		<tr><td>
		    <ul class="list_tab_area">
		      <div m:inject="s:forEach" m:items="#{uriMaintenanceDto.syukeiKbnResultData.listTabResult}" m:var="tab" m:varindex="i">
		        <li class="body_#{tab.key == uriMaintenanceDto.skTabNo?'':'non_'}active_cell"
		          style="width:85px;">
		              <a href="javaScript:void(0);" onClick="return changeTab('#{tab.key}');" onDblClick="return false;">
		                <span m:converter="#{characterEncodingConverter}" m:value="#{tab.keyName}"/></a>
		        </li>
		      </div>
		    </ul>
		</td>
		<td width="*" align="right" valign="bottom">
			<input type="button" value="再計算" onClick="return execAction('calculate');" onDblClick="return false;"/>
		</td>
	</tr>
	</table>
	<!-- タブ帯部 -->
	<table class="body_caption list_width element_browser" style="clear:both;" cellspacing="0" cellpadding="0">
	  <tr style="height:5px;"><td></td></tr>
	</table>

	<!--結果表示エリア:ヘッダー部-->
	<span class="element_print" m:value="【#{uriMaintenanceDto.resultData.keyName}タブ】" />
	<table class="body_table2">
		<tr class="header_row">
			<th class="col_eigyoDt" rowspan="2">営業日</th><!--営業日-->
			<div m:inject="s:forEach" m:items="#{uriMaintenanceDto.resultData.listHeader}" m:var="title" m:varindex="h">
			<th colspan="2"><span m:converter="#{characterEncodingConverter}" m:value="#{title.keyName}"/></th><!--会計区分名称-->
			</div>
			<th colspan="2">合計</th><!--取消金額-->
		</tr>
		<tr class="header_row">
			<div m:inject="s:forEach" m:items="#{uriMaintenanceDto.resultData.listHeader}" m:var="title" m:varindex="h">
			<th class="col_ken">件数</th>
			<th class="col_kin">金額</th>
			</div>
			<th class="col_totalken">件数</th>
			<th class="col_totalkin">金額</th>
		</tr>
	</table>
	<!--結果表示エリア:データー部-->
	<div class="scroll_area" style="width:#{scrollwidth}px;height:#{dayRowCnt*23}px;" onKeyDown="return enterTAB(event, 'kaikeiform', 'reviseKin#{uriMaintenanceDto.resultData.listHeaderCnt}', 'reviseKen1')">
		<table class="body_table2 list_data">
			<div m:inject="s:forEach" m:items="#{uriMaintenanceDto.resultData.listData}" m:var="meisai" m:varindex="d">
				<!--売上金-->
		        <span>
					<tr m:rendered="#{meisai.eigyoDt != null}" class="defaultTR non_top_border">
						<td class="col_eigyoDt" style="text-align:left"><span m:value="#{meisai.eigyoDt}" m:converter="#{uriMainteDateConverterDE}" /></td><!--営業日-->
						<td class="col_ken"><input m:id="reviseKen1" type="text" class="input_area width_62"  size="10" maxlength="4" m:value="#{meisai.strReviseKen1}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--件数-->
						<td class="col_kin"><input m:id="reviseKin1" type="text" class="input_area width_62" size="10" maxlength="7" m:value="#{meisai.strReviseKin1}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--金額-->
						<td m:rendered="#{meisai.existsMeisai2}" class="col_ken"><input m:id="reviseKen2" type="text" class="input_area width_62"  size="10" maxlength="4" m:value="#{meisai.strReviseKen2}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--件数-->
						<td m:rendered="#{meisai.existsMeisai2}" class="col_kin"><input m:id="reviseKin2" type="text" class="input_area width_62" size="10" maxlength="7" m:value="#{meisai.strReviseKin2}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--金額-->
						<td m:rendered="#{meisai.existsMeisai3}" class="col_ken"><input m:id="reviseKen3" type="text" class="input_area width_62"  size="10" maxlength="4" m:value="#{meisai.strReviseKen3}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--件数-->
						<td m:rendered="#{meisai.existsMeisai3}" class="col_kin"><input m:id="reviseKin3" type="text" class="input_area width_62" size="10" maxlength="7" m:value="#{meisai.strReviseKin3}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--金額-->
						<td m:rendered="#{meisai.existsMeisai4}" class="col_ken"><input m:id="reviseKen4" type="text" class="input_area width_62"  size="10" maxlength="4" m:value="#{meisai.strReviseKen4}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--件数-->
						<td m:rendered="#{meisai.existsMeisai4}" class="col_kin"><input m:id="reviseKin4" type="text" class="input_area width_62" size="10" maxlength="7" m:value="#{meisai.strReviseKin4}" m:converter="#{numConverter}" style="ime-mode:disabled"/></td><!--金額-->
						<td class="col_total col_totalken"><span m:value="#{meisai.reviseKenTotal}" m:converter="#{numConverter}" /></td><!--合計件数-->
						<td class="col_total col_totalkin"><span m:value="#{meisai.reviseKinTotal}" m:converter="#{numConverter}" /></td><!--合計金額-->
					</tr>
			    </span>
			</div>
		</table>
	</div>
	<!--結果表示エリア:スクロール終了-->
	<!-- 結果表示エリア:合計行 -->
	<table class="body_table2" style="margin-top:0px;text-align:right; margin-bottom:3px;">
        <tr class="body_sum5 non_top_border">
			<td class="col_eigyoDt" style="text-align:left">合計</td>
			<td class="col_ken"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKen1}" m:converter="#{numConverter}"/></td>
			<td class="col_kin"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKin1}" m:converter="#{numConverter}" /></td>
			<td m:rendered="#{uriMaintenanceDto.resultData.reviseTotal.existsMeisai2}" class="col_ken"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKen2}" m:converter="#{numConverter}" /></td>
			<td m:rendered="#{uriMaintenanceDto.resultData.reviseTotal.existsMeisai2}" class="col_kin"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKin2}" m:converter="#{numConverter}" /></td>
			<td m:rendered="#{uriMaintenanceDto.resultData.reviseTotal.existsMeisai3}" class="col_ken"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKen3}" m:converter="#{numConverter}" /></td>
			<td m:rendered="#{uriMaintenanceDto.resultData.reviseTotal.existsMeisai3}" class="col_kin"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKin3}" m:converter="#{numConverter}" /></td>
			<td m:rendered="#{uriMaintenanceDto.resultData.reviseTotal.existsMeisai4}" class="col_ken"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKen4}" m:converter="#{numConverter}" /></td>
			<td m:rendered="#{uriMaintenanceDto.resultData.reviseTotal.existsMeisai4}" class="col_kin"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKin4}" m:converter="#{numConverter}" /></td>
			<td class="col_totalken"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKenTotal}" m:converter="#{numConverter}" /></td>
			<td class="col_totalkin"><span m:value="#{uriMaintenanceDto.resultData.reviseTotal.reviseKinTotal}" m:converter="#{numConverter}" /></td>
	    </tr>
	</table>
	<span style="font-weight:bold">
		・現金金額 ＝ 売上高−Σ(値引区分１〜９の金額)＋消費税計−Σ(集計区分２〜１１の金額)＋Σ(チケット販売１〜１５の金額)<br/>
		・現金過不足 ＝ 実現金在高−現金金額</span>
	<input type="text" m:id="dummyEnter" style="display:none"/>
	</div>
</form>
<form m:id="backform" style="display:inline;">
	<input type="hidden" m:id="windowId" m:value="#{uriMaintenanceDto.windowId}"/>
	<input type="hidden" m:id="backmsg" m:value="#{uriMaintenanceDto.msgKKbnBackAlert}"/>
	<input type="hidden" m:id="skTabNo" m:value="#{uriMaintenanceDto.skTabNo}"/>
	<input type="hidden" m:id="viewId" m:value="#{viewIdValue}" />
	<input type="hidden" m:id="initMenuId" m:value="#{menuAction.initMenuId}"/>
	<input type="hidden" m:id="initSubMenuId" m:value="#{menuAction.initSubMenuId}"/>
	<input type="hidden" m:id="syukeiKbn" m:value="#{uriMaintenanceDto.syukeiKbn}"/>
	<input type="hidden" m:value="#{uriMaintenanceDto.viewSessionKey}"/>
	<a m:id="returnEdit" m:action="#{uriMaintenanceKaikeiKbnEditAction.returnEdit}"/>
</form>
</div>
</body>
</html>
