# DN-030104-036.01 業務ロジック設計書(オーダー提供時間集計ダウンロード)

## 概要

本文書は業務ロジック設計書であり、オーダー提供時間集計ダウンロード機能に関する業務ロジックの設計内容を記載しています。本文書には5個のシートが含まれています。

## 文書情報

| 項目 | 内容 |
|------|------|
| 管理番号 | DN-030104-036.01 |
| 分類 | 業務ロジック設計書 |
| 作成者 |  |
| 作成日 |  |
| 更新者 | 作成者：ASPAC 衣川<br>作成日：2009/10/15 |
| 更新日 | 作成者：ASPAC 衣川<br>作成日：2009/10/15 |

---

## 業務ロジック一覧

|  | ロジックNO | 業務ロジック名 | 機能概要 | ルールクラス | ステータス | 更新日 | 担当 |
|------|------|------|------|------|------|------|------|
|  | BBS034L01 | 初期化 | 初期化を行います。 | jp.co.isid.mos.bird.bizsupport.contractstatement.logic.impl.ConditionLogicImpl | NotSupported |  | NotSupported |
|  | BBS034L02 | 検索と結果取得 | 検索と結果取得を行います。 | jp.co.isid.mos.bird.bizsupport.contractstatement.logic.impl.GetKeisanshoListLogicImpl | NotSupported |  | NotSupported |
|  | BBS030L02 | PDFダウンロード | PDFダウンロード | jp.co.isid.mos.bird.bizsupport..tenantpay.logic.impl.SearchLogicImpl | NotSupported |  | NotSupported |
|  | BBS034L04 | PDFアップロード | PDFアップロード | jp.co.isid.mos.bird.bizsupport..tenantpay.logic.impl.UploadLogicImpl | NotSupported |  | NotSupported |
|  | BBS034L05 | 登録内容チェック | 登録内容チェック。編集画面から確認画面へ遷移するときに実行します。 | jp.co.isid.mos.bird.bizsupport..tenantpay.logic.impl.CheckInputDataLogicImpl | NotSupported |  | NotSupported |
|  | BBS034L06 | 登録 | 登録 | jp.co.isid.mos.bird.bizsupport..tenantpay.logic.impl.RegistLogicImpl | RquiresNew |  | RquiresNew |

---

## 検索

| 検索文字列 |  | ロジックNO | 業務ロジック名 | 機能概要 | ルールクラス | ステータス | 更新日 | 担当 |
|------|------|------|------|------|------|------|------|------|
| 店コード |  | BBS034L01 | 初期化 | 初期化を行います。 | jp.co.isid.mos.bird.bizsupport.contractstatement.logic.impl.ConditionLogicImpl | NotSupported |  | NotSupported |
|  |  | BBS034L02 | 検索と結果取得 | 検索と結果取得を行います。 | jp.co.isid.mos.bird.bizsupport.contractstatement.logic.impl.GetKeisanshoListLogicImpl | NotSupported |  | NotSupported |
|  |  | BBS034L05 | 登録内容チェック | 登録内容チェック。編集画面から確認画面へ遷移するときに実行します。 | jp.co.isid.mos.bird.bizsupport..tenantpay.logic.impl.CheckInputDataLogicImpl | NotSupported |  | NotSupported |

---

## テンプレート

| [BIRD]ロジック設計書 |  |  | 管理番号：DN-030104-036.01<br>分類　　　：ロジック設計書 |  |  | 更新者：<br>更新日： |  | 作成者：ASPAC 衣川<br>作成日：2009/10/15 |  |  |
|------|------|------|------|------|------|------|------|------|------|------|
| （ロジック名） |  |  |  |  |  |  |  |  |  |  |
| 機能概要 |  |  |  |  |  |  |  |  |  |  |
| ロジッククラス |  |  |  |  |  |  |  |  |  |  |
| ロジックNO |  | ステータス | レビュー待ち |  |  |  |  |  | ステータスリスト |  |
|  |  |  |  |  |  |  |  |  | 暫定版 |  |
| インタフェース定義 |  |  |  |  |  |  |  |  | レビュー待ち |  |
| パラメータ |  |  |  |  |  |  |  |  | 確定版 |  |
| 項目名 | データタイプ | 内容 |  |  |  | 必須 | 初期値 |  |  |  |


### リターン

| リターン |  |  |  |  |  |  |
|------|------|------|------|------|------|------|
| 項目名 | データタイプ | 内容 |  |  |  | 初期値 |


### データI/O定義

| データI/O定義 |  |  |
|------|------|------|
| 使用Dao名 |  | Daoクラス名 |


### コントラクト定義

| コントラクト定義 |  |  |  |  |  |  |
|------|------|------|------|------|------|------|
| 事前条件 |  |  |  |  |  | メッセージID（引数） |


### 事後条件

| 事後条件 |  |  |  |  |  | メッセージID（引数） |
|------|------|------|------|------|------|------|


### ロジック定義

| ロジック定義 |
|------|
| 処理内容 |


### ロジック定義

| ロジック定義 |
|------|
| 処理内容 |

---

## 【BBS035L01】初期化

| [BIRD]ロジック設計書 |  |  | 管理番号：DN-030104-036.01<br>分類　　　：ロジック設計書 |  |  | 更新者：ASPAC　衣川<br>更新日：2009/10/15 |  | 作成者：ASPAC 衣川<br>作成日：2009/10/15 |  |  |
|------|------|------|------|------|------|------|------|------|------|------|
| 初期化 |  |  |  |  |  |  |  |  |  |  |
| 機能概要 | 初期化を行います。 |  |  |  |  | TX属性 | NotSupported |  |  |  |
| ロジッククラス | jp.co.isid.mos.bird.bizsupport.odertimerequired.logic.impl.ConditionLogicImpl |  |  |  |  |  |  |  |  |  |
| ロジックNO | BBS035L01 | ステータス | レビュー待ち |  |  |  |  |  | ステータスリスト |  |
|  |  |  |  |  |  |  |  |  | 暫定版 |  |
| インタフェース定義 |  |  |  |  |  |  |  |  | レビュー待ち |  |
| パラメータ |  |  |  |  |  |  |  |  | 確定版 |  |
| 項目名 | データタイプ | 内容 |  |  |  | 必須 | 初期値 |  |  |  |
| 自画面RequestDto | DTO | RequestDto リクエストパラメータ保持 | RequestDto リクエストパラメータ保持 | RequestDto リクエストパラメータ保持 | RequestDto リクエストパラメータ保持 | ○ |  |  |  |  |


### リターン

| リターン |  |  |  |  |  |  |
|------|------|------|------|------|------|------|
| 項目名 | データタイプ | 内容 |  |  |  | 初期値 |
|  | void |  |  |  |  |  |


### データI/O定義

| データI/O定義 |  |  |
|------|------|------|
| 使用Dao名 |  | Daoクラス名 |
| LOGIC【表示対象取得】 | Map | jp.co.isid.mos.bird.common.logic.GetHyojiTaishoLogic |


### コントラクト定義

| コントラクト定義 |  |  |  |  |  |  |  |
|------|------|------|------|------|------|------|------|
| 事前条件 |  |  |  |  |  | メッセージID（引数） |  |
| パラメータDTO【自画面リクエスト】必須チェック |  |  |  |  |  | E0506 | 自画面RequestDto |


### 事後条件

| 事後条件 |  |  |  |  |  | メッセージID（引数） |
|------|------|------|------|------|------|------|


### ロジック定義

| ロジック定義 |
|------|
| 処理内容 |
| １．事前条件処理 |

| ２．クラス変数[BIRD日付情報]からアプリ日付を取得します。 |
|------|

| ３．共通【static定数クラス】.年月日リスト作成を実行し、アプリ日付から過去60日分のList[[期間]]を取得する。 |
|------|

| ４．過去60日分のList[[期間]]をパラメータ.DTO【自画面Request】.List[[期間]]へ設定する。 |
|------|

| ５．クラス変数[BIRDユーザ情報]からユーザタイプを取得します。 |
|------|

| ６．処理５のユーザタイプがオーナーか店舗の場合は、店舗情報を取得します。 |  |  |  |  |
|------|------|------|------|------|
| 1.共通LOGIC【表示対象取得】のパラメータ用Map[パラメータ]を生成します。 |  |  |  |  |
|  | パラメーターキー：アプリ日付 = |  |  | 処理２のアプリ日付 |
|  | パラメーター名：会社コード＝ |  |  | パラメータ.DTO【自画面Request】.会社コード |
|  | パラメーターキー：対象条件 |  |  | TaishoJoken.CODE_MISE　（共通コード) |

| 2.共通LOGIC【表示対象取得】を実行し、Map[対象情報]を取得します。 |
|------|

| 3.処理2のMap[対象情報]からList[[表示対象]]を取得します。 |
|------|

| 4.処理3のList[[表示対象]]のデータが1件以上存在する場合は下記の処理を行います。 |
|------|
| 4-1.DTO【自画面Request】へList[[表示対象]]を格納する。 |
| 4-2．ログインユーザが店舗の場合は下記の処理を行います。 |
| TUser-1.処理3のList[[表示対象]]のインデックス0番目のEntity[表示対象]を取得します。 |
| TUser-2.Entity[表示対象].店コードをパラメータ.DTO【自画面Request】.店コードへ設定します。 |
| TUser-3.Entity[表示対象].店名称をパラメータ.DTO【自画面Request】.店名称へ設定します。 |

| ７．処理終了 |
|------|

---

## 【BBS035L02】CSVダウンロード

| [BIRD]ロジック設計書 |  |  | 管理番号：DN-030104-036.01<br>分類　　　：ロジック設計書 |  |  | 更新者：ASPAC　衣川<br>更新日：2009/10/20 |  | 作成者：ASPAC 衣川<br>作成日：2009/10/15 |  |  |
|------|------|------|------|------|------|------|------|------|------|------|
| CSVダウンロード |  |  |  |  |  |  |  |  |  |  |
| 機能概要 | CSVダウンロード |  |  |  |  | TX属性 | NotSupported |  |  |  |
| ロジッククラス | jp.co.isid.mos.bird.bizsupport..odertimerequired.logic.impl.CsvOutputLogicImpl |  |  |  |  |  |  |  |  |  |
| ロジックNO | BBS035L02 | ステータス | レビュー待ち |  |  |  |  |  | ステータスリスト |  |
|  |  |  |  |  |  |  |  |  | 暫定版 |  |
| インタフェース定義 |  |  |  |  |  |  |  |  | レビュー待ち |  |
| パラメータ |  |  |  |  |  |  |  |  | 確定版 |  |
| 項目名 | データタイプ | 内容 |  |  |  | 必須 | 初期値 |  |  |  |
| ダウンロード用DTO | DownloadDto | jp.co.isid.mos.bird.bizsupport.odertimerequired.dto.DownloadDto |  |  |  |  |  |  |  |  |


### リターン

| リターン |  |  |  |  |  |  |
|------|------|------|------|------|------|------|
| 項目名 | データタイプ | 内容 |  |  |  | 初期値 |
| CSV出力用リスト | List | CSV出力用のデータ保持リスト |  |  |  |  |


### データI/O定義

| データI/O定義 |  |  |
|------|------|------|
| 使用Dao名 |  | Daoクラス名 |
| オーダー提供時間 | SELECT | jp.co.isid.mos.bird.bizsupport.ordertimerequired.dao.UIOrderTimeRequiredDao |


### コントラクト定義

| コントラクト定義 |  |  |  |  |  |  |
|------|------|------|------|------|------|------|
| 事前条件 |  |  |  |  |  | メッセージID（引数） |
| なし |  |  |  |  |  |  |


### 事後条件

| 事後条件 |  |  |  |  |  | メッセージID（引数） |
|------|------|------|------|------|------|------|

| ファイル名取得 |  |  |  | getFileName(CsvOutputDto csvOutputDto) |
|------|------|------|------|------|
| 処理内容 |  |  |  |  |
| ”ORDER_”+パラメータ.DTO【自画面Request】.店コード+”.csv” |  |  |  |  |

| CSV出力処理 |  |  |  | getOutputData(CsvOutputDto csvOutputDto) |
|------|------|------|------|------|
| 処理内容 |  |  |  |  |
| １．パラメータ．【ダウンロード用DTO】をDTO【自画面Request】へキャストします。 |  |  |  |  |

| ２．DAO【検索結果取得】検索を実行し、検索結果List[[検索結果]]を取得します。 |  |
|------|------|
| パラメータ | パラメータ.DTO【自画面Request】.会社コード |
|  | パラメータ.DTO【自画面Request】.店コード |
|  | パラメータ.DTO【自画面Request】.対象期間 |
|  | パラメータ.DTO【自画面Request】.期間From |
|  | パラメータ.DTO【自画面Request】.期間To |

| ３．処理２のList[[CSV出力用リスト]]に該当データが存在しない場合は、NoResultExceptionを発生させる。 |
|------|

| ４．処理２のList[[検索結果]]のインデックス0番目のEntity[[検索結果]]を取得します。 |
|------|

| ５．処理４のEntity[[検索結果]].店名称をDTO【自画面Request】.店名称へ設定します。 |
|------|

| ６．List[[CSV出力用リスト]]を生成します。 |
|------|

| ７．条件項目ヘッダ作成します。 |  |  |
|------|------|------|
| １． ヘッダ部1行目のList[[ヘッダ部1行目]]を作成します。 |  |  |
| ２．List[[ヘッダ部１行目]]へ下記の値を設定します。 |  |  |
| インデックス0番目： | 文字列　”表示対象：” |  |
| インデックス1番目： | パラメータ.DTO【自画面Request】.店コード + |  |
|  |  | △ + パラメータ.DTO【自画面Request】.店名称 |
| インデックス2番目： | ””（ブランク） |  |

| ３．List[[ヘッダ部1行目]]をList[[CSV出力用リスト]]へ格納します。 |
|------|

| ４． ヘッダ部2行目のList[[ヘッダ部2行目]]を作成します。 |
|------|

| ５．List[[ヘッダ部2行目]]へ下記の値を設定します。 |  |  |
|------|------|------|
| インデックス0番目： | 文字列　”対象期間：” |  |
| インデックス1番目： | 単日の場合：「yyyy/MM/dd」 パラメータ.DTO【自画面Request】.期間From　を設定します。 |  |
|  | 期間指定の場合： パラメータ.DTO【自画面Request】.期間From |  |
|  |  | +"～"+ パラメータ.DTO【自画面Request】.期間To を設定します。 |
|  | ※年月日は全て「yyyy/MM/dd」の表示形式で設定します。 |  |
| インデックス2番目： | ””（ブランク） |  |

| ６．List[[ヘッダ部2行目]]をList[[CSV出力用リスト]]へ格納します。 |
|------|

| ７．空白行２行分をList[[CSV出力用リスト]]へ格納します。 |
|------|

| ８．明細部ヘッダー作成します。 |
|------|
| １．List[[データ項目ヘッダー部]]をインスタンス化します。 |

| ２．下記の項目名称をList[[データ項目ヘッダー部]]へ格納します。 |  |
|------|------|
| インデックス0番目： | 営業日 |
| インデックス1番目： | 時間帯区分 |
| インデックス2番目： | 提供時間区分 |
| インデックス3番目： | 売上種別1客数 |
| インデックス4番目： | 売上種別1売上個数 |
| インデックス5番目： | 売上種別2客数 |
| インデックス6番目： | 売上種別2売上個数 |
| インデックス7番目： | 売上種別3客数 |
| インデックス8番目： | 売上種別3売上個数 |
| インデックス9番目： | 売上種別4客数 |
| インデックス10番目： | 売上種別4売上個数 |
| インデックス11番目： | 売上種別5から15客数 |
| インデックス12番目： | 売上種別5～15売上個数 |

| ３．List[[データ項目ヘッダー部]]をList[[CSV出力用リスト]]へ格納します。 |
|------|

| ９．明細部データ作成します。 |  |  |
|------|------|------|
| １．List[[検索結果]]の件数分、下記の処理を行います。 |  |  |
| for-1.List[[検索結果]]から現行インデックスのEntity[検索結果]を取得します。 |  |  |
| for-2.1行分のデータを格納するList[[出力情報]]を生成します。 |  |  |
| for-3.処理2で生成したList[[出力情報]]へ下記の値を格納します。 |  |  |
|  | インデックス0番目： | Entity[検索結果].営業日 |
|  | インデックス1番目： | Entity[検索結果].時間帯区分 |
|  | インデックス2番目： | Entity[検索結果].提供時間区分 |
|  | インデックス3番目： | Entity[検索結果].売上種別1客数 |
|  | インデックス4番目： | Entity[検索結果].売上種別1売上個数 |
|  | インデックス5番目： | Entity[検索結果].売上種別2客数 |
|  | インデックス6番目： | Entity[検索結果].売上種別2売上個数 |
|  | インデックス7番目： | Entity[検索結果].売上種別3客数 |
|  | インデックス8番目： | Entity[検索結果].売上種別3売上個数 |
|  | インデックス9番目： | Entity[検索結果].売上種別4客数 |
|  | インデックス10番目： | Entity[検索結果].売上種別4売上個数 |
|  | インデックス11番目： | Entity[検索結果].売上種別5から15客数 |
|  | インデックス12番目： | Entity[検索結果].売上種別5～15売上個数 |

| for-4.1行分のList[[出力情報]]をList[[CSV出力用リスト]]へ格納します。 |
|------|


### 10．List[[CSV出力用リスト]]をリターンします。

| 10．List[[CSV出力用リスト]]をリターンします。 |
|------|


---

## 読み取りが難しかった項目

- .xls形式のため、画像・図形の抽出ができませんでした。元のExcelファイルを参照してください。

- 結合セルのレイアウトが完全に再現できなかった箇所がある可能性があります。

- 複雑なレイアウトの表は、元のExcelファイルと照合して確認してください。


## 不明点・不明瞭な点

- 空欄になっている項目については、意図的な省略か記載漏れか確認が必要です。

- 用語や略語の意味が不明確な箇所は、関連ドキュメントを参照してください。
