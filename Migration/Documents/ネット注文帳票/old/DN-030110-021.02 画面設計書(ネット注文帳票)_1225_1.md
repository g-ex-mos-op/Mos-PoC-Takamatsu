# DN-030110-021.02 画面設計書(ネット注文帳票)

## 概要

本文書は、ネット注文帳票機能の画面設計書です。ネット注文支部別TOP15帳票のダウンロード機能を提供し、本部ユーザ向けに設計されています。

主な内容：
- 機能概要：ネット注文帳票のダウンロード機能の目的と概要
- 画面レイアウト：画面の視覚的なデザインと構成
- 要求仕様：機能要件と仕様の詳細
- 画面構成：View、Action、Logic、DAOの構成
- アクション：画面操作に対する処理内容
- コンポーネント一覧：画面を構成するUI部品の一覧

## 文書情報

| 項目 | 内容 |
|------|------|
| 管理番号 | DN-030110-021.02 |
| 分類 | 画面設計書 |
| 作成者 | AO 王増文 |
| 作成日 | 2018/06/05 |
| 更新者 | ISID竹内 |
| 更新日 | 2018/8/28 |

## 更新履歴

| 作成・更新日 | 更新内容 | 作成・更新者 | レビュー/承認者 | レビュー/承認日 |
|--------------|----------|--------------|-----------------|-----------------|
| 2018-06-05 | 新規作成 | 王増文 | 竹内裕二 | 2018-06-28 |
| 2018-08-28 | STEP2対応として条件指定、EXCEL/PDFのオンライン作成処理を追加 | 竹内裕二 | 竹内裕二 | 2018-08-28 |
| 2018-09-10 | アクション処理内容を追加 | 王増文 | 竹内裕二 | 2018-09-10 |

---

## 機能概要

### 基本情報

| 項目 | 内容 |
|------|------|
| 画面名 | ネット注文帳票 |
| フィーチャ | 業績管理 |

### 機能の目的

ネット注文支部別TOP15帳票をダウンロードする。

### 想定ユーザ

本部ユーザ様

### 機能の概要

ネット注文支部別TOP15帳票をダウンロードする。

固定条件前月分出力条件に応じたネット注文支部別TOP15帳票をテキストEXCEL/PDF形式でダウンロードする。

### 図: 機能概要図

![機能概要図](./DN-030110-021.02 画面設計書(ネット注文帳票)_assets/images/image1.png)

---

## 画面レイアウト

### 基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | BBR019 |
| 画面名 | ネット注文帳票 |
| ビューID | BBR019V01 |
| ビュー名 | ネット注文帳票 |
| JSF名 | netorderReportForm |
| CSS名 | body.css |

### 画面レイアウト図

#### 対象期間＝「対象年月」の場合

![画面レイアウト（対象年月）](./DN-030110-021.02 画面設計書(ネット注文帳票)_assets/images/image2.png)

#### 対象期間＝「期間指定」の場合

![画面レイアウト（期間指定）](./DN-030110-021.02 画面設計書(ネット注文帳票)_assets/images/image3.png)

#### ダウンロード中の場合

![画面レイアウト（ダウンロード中）](./DN-030110-021.02 画面設計書(ネット注文帳票)_assets/images/image4.png)

#### ダウンロード完了の場合

![画面レイアウト（ダウンロード完了）](./DN-030110-021.02 画面設計書(ネット注文帳票)_assets/images/image5.png)

### 画面項目説明


---

## 要求仕様

### 基本情報

| 項目 | 内容 |
|------|------|
| 画面名 | ネット注文帳票 |
| フィーチャ | 業績管理 |

### 要求仕様一覧

| NO | カテゴリ | 要求番号 | 仕様番号 | 優先 | 分類 | 内容 | 追加変更日 | 備考 |
|------|------|------|------|------|------|------|------|------|
|  |  | ＦRQ0101 |  | A | 要求 | 条件指定（対象期間の「対象年月」「期間指定」）をして出力したい |  |  |
|  |  | ＦRQ0110 |  |  | 理由 | 月次での資料作成やキャンペーン時期などのスポット期間での状況把握が必要なため |  |  |
|  |  | ＦRQ0110 |  |  | 説明 | 他画面の「対象年月」「期間指定」の仕様を踏襲 |  |  |
|  |  | ＦRQ0110 | SP010101 | A | 仕様 | 対象期間のプルダウンで「対象年月」「期間指定」を選択させる<br>選択肢に応じて「期間指定」の内容を年月のリストボックスまたは「対象期間（FROM)」「対象期間（TO）」のリストボックスに動的に切り替えて表示する。 |  |  |
|  |  | ＦRQ0102 |  | A | 要求 | パフォーマンス上の問題もあるため期間指定は最長1年間（366日間)としたい |  |  |
|  |  | ＦRQ0102 |  |  | 理由 | SQLでの処理が重くなってしまうため |  |  |
|  |  | ＦRQ0102 |  |  | 説明 | 期間指定で選択できる最古の期間は他画面を踏襲する。 |  |  |
|  |  | ＦRQ0102 | SP010102 | A | 仕様 | ①期間指定選択し、EXCELファイル、PDFファイルリンククリック時、最長1年間（366日間）までかチェックを行い、NGの場合は出力画面に戻し、画面上部にメッセージを表示する。<br>「期間指定は最長1年間までとしてください。」<br>②期間指定選択し、EXCELファイル、PDFファイルリンククリック時、FROM<=TOのチェックを行い、NGの場合は出力画面に戻し、画面上部にメッセージを表示する。<br>「期間指定はFROM <= TOでなければなりません。」 |  |  |
|  |  | ＦRQ0103 |  | A | 要求 | ・EXCELファイル出力とPDFファイル出力を選択して出力したい。<br>・多重実行を避けることができるのでサーバダウンするまでの高負荷は避けられるため、出力時排他処理を実施する。 |  |  |
|  |  | ＦRQ0103 |  |  | 理由 | 二次加工も可能であるEXCELファイル出力かスマホなどでの出力・閲覧も意識したPDF出力両方選択できるようにするため。 |  |  |
|  |  | ＦRQ0103 |  |  | 説明 | リンクで出力形式を選んで出力する想定（実装上難しい場合は出力形式を選択して、実行ボタンを押すような形式でも可） |  |  |
|  |  | ＦRQ0103 | SP010103 | A | 仕様 | ・排他チェックする。　<br>ロックされた場合、「現在、他のユーザーにて帳票作成中です。しばらく経ってから再度実行してください。」を表示し、帳票出力しない。<br>ロックされていない場合、ロックファイルを生成し、帳票出力する。<br>処理完了したら、ロック解除する。<br>・「EXCELファイル」「PDFファイル（表紙）」リンクをクリックした際、下記メッセージを表示した別画面に遷移して各ファイル作成処理を実行する。<br>====<br>ダウンロードデータの準備をしています。<br>そのまましばらくお待ち下さい。<br>ダウンロード完了後、下記のボタンを押して下さい。<br>【戻る】<br>==== |  |  |
|  |  | ＦRQ0104 |  | A | 要求 | 出力したファイル名から出力した条件が分かるようにしたい |  |  |
|  |  | ＦRQ0104 |  |  | 理由 | 後でどのような条件で出力したものか分かるようにするため。 |  |  |
|  |  | ＦRQ0104 |  |  | 説明 |  |  |  |
|  |  | ＦRQ0104 | SP010104 | A | 仕様 | ファイル名は以下の通り、条件を付ける<br>対象年月の場合：ネット注文支部別TOP15_YYYYMM.xlsx(pdf)<br>期間指定の場合：ネット注文支部別TOP15_YYYYMMDD-YYYYMMDD.xlsx(pdf) |  |  |
|  |  | ＦRQ0105 |  | A | 要求 | 取得したデータをEXCELの決まったシートに張り付ける。また順位について支部CD順と支部取込CD順2パターンほしい。 |  |  |
|  |  | ＦRQ0105 |  |  | 理由 | 支部CD、支部取込CD順になるようテンプレートEXCEL上で数式をあらかじめ組んでいるため |  |  |
|  |  | ＦRQ0105 |  |  | 説明 |  |  |  |
|  |  | ＦRQ0105 | SP010105 | A | 仕様 | SQL上のorder byを張り付けるシートによって切り替えて2回実行し、2つのシートにデータを張り付ける。<br>    1,3,5,7,9 --dataシート張り付けの場合<br>    7,9 --data_area_daiシート張り付けの場合<br>※データは各シートのJ5セルから張り付ける |  |  |

---

## 画面構成

### 基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | BBR019 |
| 画面名 | ネット注文帳票 |
| 機能概要 | ネット注文帳票のダウンロードを行う。 |
| パッケージルート | jp.co.isid.mos.bird.bizreport.netorderreport |
| 画面タイプ | 検索エンジン型 |

### 構成概要

#### 使用テーブル

| テーブル名 |
|------------|
| BM11ONER（グループ統合オーナマスタ） |
| BM10GSIB（汎用店舗グループ（支部）） |
| BT63SNIP（営業日報（日次）） |

#### View-Action-Logic-DAO構成

|  |  | view |  |  |  | action |  |  |  | logic |  |  |  |  | dao |  |  | テーブル |  | BM01TENM（店統合マスタ） |  |  |  |  |  |
|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|

---

## アクション

### 基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | BBR019 |
| 画面名 | ネット注文帳票 |
| ビュー名 | ネット注文帳票画面 |

---

## コンポーネント一覧

### 基本情報

| 項目 | 内容 |
|------|------|
| 画面ID | BBR019 |
| 画面名 | ネット注文帳票 |
| ビュー名 | ネット注文帳票画面 |

### コンポーネント一覧

| 項目名 |  |  | 編集 | 表示 | データタイプ |  | 桁数 | コントロール |  | 初期値 |  |  | 必須 | 対応プロパティ・アクション |  |  |  |  | 備考 |  |  |  |  |  |  |
|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|------|
| 条件エリア |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| 対象期間 |  |  | × | ○ | 文字列 |  |  | プルダウン |  | 対象年月 |  |  | ○ |  |  |  |  |  |  |  |  |  |  |  |  |
| 期間指定 |  |  | × | ○ | 日付文字列(文字列) |  |  | プルダウン |  | 当月 |  |  | ○ |  |  |  |  |  | 対象期間＝「対象年月」の時、表示し、入力可能 |  |  |  |  |  |  |
| 期間指定FROM |  |  | × | ○ | 日付文字列(文字列) |  |  | プルダウン |  | アプリ日付 |  |  | ○ |  |  |  |  |  | 対象期間＝「期間指定」の時、表示し、入力可能 |  |  |  |  |  |  |
| 期間指定TO |  |  | × | ○ | 日付文字列(文字列) |  |  | プルダウン |  | アプリ日付 |  |  | ○ |  |  |  |  |  | 対象期間＝「期間指定」の時、表示し、入力可能 |  |  |  |  |  |  |
| EXCELリンク |  |  | × | ○ |  |  |  | リンク |  |  |  |  | ○ | アクション【EXCELダウンロード】を実行する。 |  |  |  |  |  |  |  |  |  |  |  |
| PDFファイル(表紙) |  |  | × | ○ |  |  |  | リンク |  |  |  |  | ○ | アクション【PDFダウンロード】を実行する。 |  |  |  |  |  |  |  |  |  |  |  |

---

## 読み取りが難しかった項目

以下の項目はExcel変換時に読み取りが困難であった、または情報が失われた可能性がある項目です：

- **数式セル**: 「アクション」シートおよび「コンポーネント一覧」シートのヘッダー部分に数式参照（例：`=画面構成!A2`）が含まれており、計算結果ではなく数式がそのまま表示されています。
- **結合セルのレイアウト**: 各シートのヘッダー部分で結合セルが使用されており、展開後のレイアウトが元のExcelファイルと異なる場合があります。
- **画像の配置情報**: 画像は抽出されましたが、元のExcelファイルでの正確な配置位置（セル座標）との対応関係が完全には再現されていません。
- **アクションシートの処理詳細**: アクションシートには複雑なレイアウトで処理内容が記載されており、一部の詳細情報が省略されている可能性があります。

## 不明点・不明瞭な点

以下の項目は仕様として不明確、または追加の確認が必要な点です：

- **画面レイアウトの詳細仕様**: 画面レイアウト図は画像として抽出されていますが、各UI要素の詳細な動作仕様（バリデーション、エラーメッセージ等）については、別途確認が必要です。
- **アクションの遷移先ビュー**: 一部のアクション定義で「遷移先ビュー」の記載が空欄となっており、意図的な省略か記載漏れか不明です。
- **コンポーネントの初期値**: コンポーネント一覧の「初期値」列が空欄の項目について、初期値なしなのか記載漏れなのか確認が必要です。
- **関連文書への参照**: 本文書から参照されている他の設計書（Dao設計書、業務ロジック設計書等）との整合性確認が必要です。
