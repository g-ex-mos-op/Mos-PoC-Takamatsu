# DN-030110-021.01 Dao設計書(ネット注文帳票)

## 概要

本文書は、ネット注文帳票システムにおけるDao（Data Access Object）設計書です。ネット注文帳票情報を取得するためのデータアクセス層の設計を定義しています。主な内容として、エンティティ定義（NetOrderReport）、Dao情報（NetOrderReportDataDao）、およびSQL検索メソッド（selectNetOrderReport）の仕様が含まれています。

## 文書情報

| 項目 | 内容 |
|------|------|
| 管理番号 | DN-030110-021.01 |
| 分類 | Dao設計書 |
| 作成者 | 王増文 |
| 作成日 | 2018/09/06 |
| 更新者 | 王増文 |
| 更新日 | 2018/09/06 |

## 更新履歴

| 作成・更新日 | 更新内容 | 作成・更新者 | レビュー/承認者 | レビュー/承認日 |
|--------------|----------|--------------|-----------------|-----------------|
| 2018-09-06 | 新規作成（バージョン 01） | 王増文 | 田村雄一 / 竹内裕二 | 2018-09-06 / 2018-09-06 |

---

## 変更履歴

### 承認履歴

| バージョン | 変更管理NO | 作成担当者 | 作成日付 | レビュー担当者 | レビュー日付 | 承認担当者 | 承認日付 |
|------------|------------|------------|----------|----------------|--------------|------------|----------|
| 01 | ネット注文帳票 | 王増文 | 2018-09-06 | 田村雄一 | 2018-09-06 | 竹内裕二 | 2018-09-06 |

### 変更履歴

| バージョン | 変更内容 |
|------------|----------|
| 01 | 新規作成 |

---

## 設定＆実行

### 基本設定

| 項目 | 値 |
|------|-----|
| エンティティ出力先 | `C:\Temp` |

### 作成対象シート

- 変更履歴
- ネット注文帳票情報取得(NetOrderReportDataDao)

### 図: 設計書テンプレート説明

![設計書テンプレート説明](./DN-030110-021.01 Dao設計書(ネット注文帳票)_assets/images/image2.png)

> この図は設計書テンプレートの使用方法を説明するコールアウトです。

---

## NetOrderReportDataDao

### エンティティ情報

| 項目 | 内容 |
|------|------|
| エンティティ名 | ネット注文帳票情報(NetOrderReport) |
| 対象テーブル | BT63SNIP |
| パッケージ | jp.co.isid.mos.bird.bizreport.netorderreport.entity.NetOrderReport |

### プロパティ定義

| プロパティ名 | 論理名 | Java型 | 列型 | 参照 | 対象テーブル |
|--------------|--------|--------|------|------|--------------|
| jigyouCd | 事業本部コード | java.lang.String | - | JIGYOU_CD | BM10GSIB |
| jigyouName | 事業本部名称 | java.lang.String | - | JIGYOU_NAME | BM10GSIB |
| slareaCd | 営業エリアコード | java.lang.String | - | SLAREA_CD | BM10GSIB |
| slareaName | 営業エリア名称 | java.lang.String | - | SLAREA_NAME | BM10GSIB |
| sibuCd | 支部コード | java.lang.String | - | SIBU_CD | BM01TENM |
| sibuName | 支部名称 | java.lang.String | - | SIBU_NAME | BM10GSIB |
| areaDai | 支部取込コード | java.lang.String | - | AREA_DAI | BM01TENM |
| areaName | 支部取込名 | java.lang.String | - | AREA_NAME | BM10GSIB |
| miseCd | 店コード | java.lang.String | - | MISE_CD | BM45ZDAY |
| miseNameKj | 店名称 | java.lang.String | - | MISE_NAME_KJ | BM01TENM |
| onerCd | オーナーコード | java.lang.String | - | ONER_CD | BM01TENM |
| onerNameKj | オーナー名称 | java.lang.String | - | ONER_NAME_KJ | BM11ONER |
| otherKin7 | ネットテイク金額 | java.lang.String | - | SUM(B1.OTHER_KIN_7) | BT63SNIP |
| otherKin8 | ネット宅配金額 | java.lang.String | - | SUM(B1.OTHER_KIN_8) | BT63SNIP |
| eat_kin | EAT-IN金額 | java.lang.String | - | SUM(B1.EAT_KIN) | BT63SNIP |
| takeKin | TAKE-OUT金額 | java.lang.String | - | SUM(B1.TAKE_KIN) | BT63SNIP |
| telKin | TEL-ORDER金額 | java.lang.String | - | SUM(B1.TEL_KIN) | BT63SNIP |
| driveKin | DRV-TH金額 | java.lang.String | - | SUM(B1.DRIVE_KIN) | BT63SNIP |
| otherKin1 | 宅配金額 | java.lang.String | - | SUM(B1.OTHER_KIN_1) | BT63SNIP |
| otherKin2 | 外販金額 | java.lang.String | - | SUM(B1.OTHER_KIN_2) | BT63SNIP |
| otherKen7 | ネットテイク件数 | java.lang.String | - | SUM(B1.OTHER_KEN_7) | BT63SNIP |
| otherKen8 | ネット宅配件数 | java.lang.String | - | SUM(B1.OTHER_KEN_8) | BT63SNIP |
| eatKen | EAT-IN件数 | java.lang.String | - | SUM(B1.EAT_KEN) | BT63SNIP |
| takeKen | TAKE-OUT件数 | java.lang.String | - | SUM(B1.TAKE_KEN) | BT63SNIP |
| telKen | TEL-ORDER件数 | java.lang.String | - | SUM(B1.TEL_KEN) | BT63SNIP |
| driveKen | DRV-TH件数 | java.lang.String | - | SUM(B1.DRIVE_KEN) | BT63SNIP |
| otherKen1 | 宅配件数 | java.lang.String | - | SUM(B1.OTHER_KEN_1) | BT63SNIP |
| otherKen2 | 外販件数 | java.lang.String | - | SUM(B1.OTHER_KEN_2) | BT63SNIP |
| otherKin7Zen | 前年ネットテイク金額 | java.lang.String | - | SUM(B2.OTHER_KIN_7) | BT63SNIP |
| otherKin8Zen | 前年ネット宅配金額 | java.lang.String | - | SUM(B2.OTHER_KIN_8) | BT63SNIP |
| eatKinZen | 前年EAT-IN金額 | java.lang.String | - | SUM(B2.EAT_KIN) | BT63SNIP |
| takeKinZen | 前年TAKE-OUT金額 | java.lang.String | - | SUM(B2.TAKE_KIN) | BT63SNIP |
| telKinZen | 前年TEL-ORDER金額 | java.lang.String | - | SUM(B2.TEL_KIN) | BT63SNIP |
| driveKinZen | 前年DRV-TH金額 | java.lang.String | - | SUM(B2.DRIVE_KIN) | BT63SNIP |
| otherKin1Zen | 前年宅配金額 | java.lang.String | - | SUM(B2.OTHER_KIN_1) | BT63SNIP |
| otherKin2Zen | 前年外販金額 | java.lang.String | - | SUM(B2.OTHER_KIN_2) | BT63SNIP |
| otherKen7Zen | 前年ネットテイク件数 | java.lang.String | - | SUM(B2.OTHER_KEN_7) | BT63SNIP |
| otherKen8Zen | 前年ネット宅配件数 | java.lang.String | - | SUM(B2.OTHER_KEN_8) | BT63SNIP |
| eatKenZen | 前年EAT-IN件数 | java.lang.String | - | SUM(B2.EAT_KEN) | BT63SNIP |
| takeKenZen | 前年TAKE-OUT件数 | java.lang.String | - | SUM(B2.TAKE_KEN) | BT63SNIP |
| telKenZen | 前年TEL-ORDER件数 | java.lang.String | - | SUM(B2.TEL_KEN) | BT63SNIP |
| driveKenZen | 前年DRV-TH件数 | java.lang.String | - | SUM(B2.DRIVE_KEN) | BT63SNIP |
| otherKen1Zen | 前年宅配件数 | java.lang.String | - | SUM(B2.OTHER_KEN_1) | BT63SNIP |
| otherKen2Zen | 前年外販件数 | java.lang.String | - | SUM(B2.OTHER_KEN_2) | BT63SNIP |

### Dao情報

| 項目 | 内容 |
|------|------|
| Dao名 | ネット注文帳票情報(NetOrderReportDataDao) |
| パッケージ | jp.co.isid.mos.bird.bizreport.netorderreport.dao.NetOrderReportDataDao |

### メソッド: ネット注文帳票情報検索(selectNetOrderReport)

#### パラメータ情報

| パラメータ名 |
|--------------|
| 検索FROM日付 |
| 検索TO日付 |
| ソート順キー |

#### 使用テーブル

| テーブル論理名 | テーブル物理名 | 補足 |
|----------------|----------------|------|
| 営業日報（日次） | BT63SNIP |  |
| 前年営業日情報 | BM45ZDAY |  |
| グループ統合オーナマスタ | BM11ONER |  |
| 店統合マスタ | BM01TENM |  |
| 汎用店舗グループ（支部） | BM10GSIB |  |
| ネット注文帳票除外店舗マスタ | BM82NOJT |  |

#### サブクエリー: 本年データ

##### JOIN情報

| 項目 | 営業日報（日次） | 前年営業日情報 | グループ統合オーナマスタ | 店統合マスタ | 汎用店舗グループ（支部） | ネット注文帳票除外店舗マスタ |
|------|------------------|----------------|--------------------------|--------------|--------------------------|------------------------------|
| テーブル | BT63SNIP | BM45ZDAY | BM11ONER | BM01TENM | BM10GSIB | BM82NOJT |
| カラム（会社コード） | 会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | - |
| カラム（店舗コード） | 店舗コード | ⇔店舗コード | - | ⇔店舗コード | - | - |
| カラム（営業日） | 営業日 | ⇔営業日 | - | - | - | - |
| カラム（エリア大コード） | - | - | - | エリア大コード | ⇔支部コード | - |
| カラム（オーナーコード） | - | - | オーナーコード | ⇔オーナーコード | - | - |
| 除外条件 | - | 会社コード, 店舗コード | - | - | - | NOT IN (会社コード, 店舗コード) |

> **矢印の凡例**
> - `→`、`←`：outerジョイン。矢印が向いている方がメイン
> - `⇔`：innerジョイン

#### サブクエリー: 前年データ

##### JOIN情報

| 項目 | 営業日報（日次） | 前年営業日情報 | グループ統合オーナマスタ | 店統合マスタ | 汎用店舗グループ（支部） | ネット注文帳票除外店舗マスタ |
|------|------------------|----------------|--------------------------|--------------|--------------------------|------------------------------|
| テーブル | BT63SNIP | BM45ZDAY | BM11ONER | BM01TENM | BM10GSIB | BM82NOJT |
| カラム（会社コード） | 会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | - |
| カラム（店舗コード） | 店舗コード | ⇔前年同月店舗コード | - | ⇔店舗コード | - | - |
| カラム（営業日） | 営業日 | ⇔前年同月営業日 | - | - | - | - |
| カラム（エリア大コード） | - | - | - | エリア大コード | ⇔支部コード | - |
| カラム（オーナーコード） | - | - | オーナーコード | ⇔オーナーコード | - | - |
| 除外条件 | - | 会社コード, 店舗コード | - | - | - | NOT IN (会社コード, 店舗コード) |

#### 本年データと前年データの結合

| 項目 | 本年データ | 前年データ |
|------|------------|------------|
| 結合方法 | 全てUNION ALL | 全てUNION ALL |

#### 検索条件

```sql
BM45ZDAY.EIGYO_DT BETWEEN パラメータ.検索FROM日付 AND パラメータ.検索TO日付
```

#### ソート情報

##### パラメータのソートキー＝「data」の場合

```sql
ORDER BY
    JIGYOU_CD ASC,
    SLAREA_CD ASC,
    SIBU_CD ASC,
    AREA_DAI ASC,
    MISE_CD ASC
```

##### パラメータのソートキー＝「data_area_dai」の場合

```sql
ORDER BY
    AREA_DAI ASC,
    MISE_CD ASC
```

### 図: Dao設計書ヘッダー

![Dao設計書ヘッダー](./DN-030110-021.01 Dao設計書(ネット注文帳票)_assets/images/image1.png)

> この図はDao設計書のヘッダー部分に表示されるロゴです。

---

## 読み取りが難しかった項目

以下の項目はExcel変換時に読み取りが困難だった、または情報が失われた可能性がある項目です：

1. **画像の配置情報**: 画像ファイル（image1.png, image2.png, image3.jpeg, image4.jpeg）は抽出できましたが、元のExcelファイルでの正確な配置位置（セル座標）は完全には再現できていません。

2. **結合セルのレイアウト**: 「変更履歴」シートおよび「設定＆実行」シートの結合セルは展開して処理しましたが、元のレイアウトの視覚的な表現は完全には再現できていません。

3. **コールアウト図形のテキスト**: 「設定＆実行」シートに含まれるコールアウト図形（吹き出し）内のテキストは、DrawingMLから抽出しましたが、完全な内容は元のExcelファイルを参照してください。

4. **外部画像参照**: 一部の画像は外部URL（http://www.isid.co.jp/images/logo/0001.gif）を参照しており、ローカルには保存されていません。

## 不明点・不明瞭な点

以下の項目は仕様として不明確、または追加の確認が必要な点です：

1. **プロパティ定義の「説明」列**: プロパティ定義テーブルの「説明」列はすべて空欄となっています。これが意図的な省略か記載漏れかは不明です。

2. **使用テーブルの「補足」列**: 使用テーブル一覧の「補足」列はすべて空欄となっています。

3. **パラメータの詳細仕様**: パラメータ情報（検索FROM日付、検索TO日付、ソート順キー）の詳細な型定義や制約条件は記載されていません。

4. **SQL文の完全な定義**: 本文書にはSQL文の概要（使用テーブル、JOIN条件、ソート順）は記載されていますが、完全なSELECT文は含まれていません。実際のSQL実装は別途確認が必要です。

5. **エンティティ出力先のパス**: エンティティ出力先が `C:\Temp` となっていますが、これが開発環境固有の設定か、本番環境でも使用される設定かは不明です。
