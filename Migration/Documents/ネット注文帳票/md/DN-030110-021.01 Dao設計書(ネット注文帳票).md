# DN-030110-021.01 Dao設計書(ネット注文帳票)

## 概要

本文書はDao設計書であり、ネット注文帳票機能に関するデータアクセスオブジェクト（DAO）の設計内容を記載しています。本文書には3個のシートが含まれています。

## 文書情報

| 項目 | 内容 |
|------|------|
| 管理番号 | DN-030110-021.01 |
| 分類 | Dao設計書 |
| 作成者 | 王増文 |
| 作成日 | 2018/09/06 |
| 更新者 | 王増文 |
| 更新日 | 2018/09/06 |

## 更新履歴

| 作成・更新日 | 更新内容 | 作成・更新者 | レビュー/承認者 | レビュー/承認日 |
|--------------|----------|--------------|-----------------|-----------------|
|  | バージョン | 変更管理NO | 担当者 | 日付 |
|  | 01 | ネット注文帳票 | 王増文 | 2018/09/06 |
|  | 変更履歴 |  |  |  |
|  | バージョン | 変更内容 | 変更内容 | 変更内容 |
|  | 01 | 新規作成 | 新規作成 | 新規作成 |

---

## 設定＆実行
### [BIRD]Dao設計書

- エンティティ出力先
  - C:\Temp

| 作成対象シート |
|------|
| 変更履歴 |
| ネット注文帳票情報取得(NetOrderReportDataDao) |

---

## NetOrderReportDataDao

### [BIRD]Dao設計書

#### **ネット注文帳票情報(NetOrderReport)**
- BT63SNIP
- jp.co.isid.mos.bird.bizreport.netorderreport.entity.NetOrderReport

| プロパティ名 | 論理名 |  | Java型 | 列型 | 参照 | 対象テーブル | 説明 |  |  |
|------|------|------|------|------|------|------|------|------|------|
| jigyouCd | 事業本部コード |  | java.lang.String | - | JIGYOU_CD | BM10GSIB |  |  |  |
| jigyouName | 事業本部名称 |  | java.lang.String | - | JIGYOU_NAME | BM10GSIB |  |  |  |
| slareaCd | 営業エリアコード |  | java.lang.String | - | SLAREA_CD | BM10GSIB |  |  |  |
| slareaName | 営業エリア名称 |  | java.lang.String | - | SLAREA_NAME | BM10GSIB |  |  |  |
| sibuCd | 支部コード |  | java.lang.String | - | SIBU_CD | BM01TENM |  |  |  |
| sibuName | 支部名称 |  | java.lang.String | - | SIBU_NAME | BM10GSIB |  |  |  |
| areaDai | 支部取込コード |  | java.lang.String | - | AREA_DAI | BM01TENM |  |  |  |
| areaName | 支部取込名 |  | java.lang.String | - | AREA_NAME | BM10GSIB |  |  |  |
| miseCd | 店コード |  | java.lang.String | - | MISE_CD | BM45ZDAY |  |  |  |
| miseNameKj | 店名称 |  | java.lang.String | - | MISE_NAME_KJ | BM01TENM |  |  |  |
| onerCd | オーナーコード |  | java.lang.String | - | ONER_CD | BM01TENM |  |  |  |
| onerNameKj | オーナー名称 |  | java.lang.String | - | ONER_NAME_KJ | BM11ONER |  |  |  |
| otherKin7 | ネットテイク金額 |  | java.lang.String | - | SUM(B1.OTHER_KIN_7) | BT63SNIP |  |  |  |
| otherKin8 | ネット宅配金額 |  | java.lang.String | - | SUM(B1.OTHER_KIN_8) | BT63SNIP |  |  |  |
| eat_kin | EAT-IN金額 |  | java.lang.String | - | SUM(B1.EAT_KIN) | BT63SNIP |  |  |  |
| takeKin | TAKE-OUT金額 |  | java.lang.String | - | SUM(B1.TAKE_KIN) | BT63SNIP |  |  |  |
| telKin | TEL-ORDER金額 |  | java.lang.String | - | SUM(B1.TEL_KIN) | BT63SNIP |  |  |  |
| driveKin | DRV-TH金額 |  | java.lang.String | - | SUM(B1.DRIVE_KIN) | BT63SNIP |  |  |  |
| otherKin1 | 宅配金額 |  | java.lang.String | - | SUM(B1.OTHER_KIN_1) | BT63SNIP |  |  |  |
| otherKin2 | 外販金額 |  | java.lang.String | - | SUM(B1.OTHER_KIN_2) | BT63SNIP |  |  |  |
| otherKen7 | ネットテイク件数 |  | java.lang.String | - | SUM(B1.OTHER_KEN_7) | BT63SNIP |  |  |  |
| otherKen8 | ネット宅配件数 |  | java.lang.String | - | SUM(B1.OTHER_KEN_8) | BT63SNIP |  |  |  |
| eatKen | EAT-IN件数 |  | java.lang.String | - | SUM(B1.EAT_KEN) | BT63SNIP |  |  |  |
| takeKen | TAKE-OUT件数 |  | java.lang.String | - | SUM(B1.TAKE_KEN) | BT63SNIP |  |  |  |
| telKen | TEL-ORDER件数 |  | java.lang.String | - | SUM(B1.TEL_KEN) | BT63SNIP |  |  |  |
| driveKen | DRV-TH件数 |  | java.lang.String | - | SUM(B1.DRIVE_KEN) | BT63SNIP |  |  |  |
| otherKen1 | 宅配件数 |  | java.lang.String | - | SUM(B1.OTHER_KEN_1) | BT63SNIP |  |  |  |
| otherKen2 | 外販件数 |  | java.lang.String | - | SUM(B1.OTHER_KEN_2) | BT63SNIP |  |  |  |
| otherKin7Zen | 前年ネットテイク金額 |  | java.lang.String | - | SUM(B2.OTHER_KIN_7) | BT63SNIP |  |  |  |
| otherKin8Zen | 前年ネット宅配金額 |  | java.lang.String | - | SUM(B2.OTHER_KIN_8) | BT63SNIP |  |  |  |
| eatKinZen | 前年EAT-IN金額 |  | java.lang.String | - | SUM(B2.EAT_KIN) | BT63SNIP |  |  |  |
| takeKinZen | 前年TAKE-OUT金額 |  | java.lang.String | - | SUM(B2.TAKE_KIN) | BT63SNIP |  |  |  |
| telKinZen | 前年TEL-ORDER金額 |  | java.lang.String | - | SUM(B2.TEL_KIN) | BT63SNIP |  |  |  |
| driveKinZen | 前年DRV-TH金額 |  | java.lang.String | - | SUM(B2.DRIVE_KIN) | BT63SNIP |  |  |  |
| otherKin1Zen | 前年宅配金額 |  | java.lang.String | - | SUM(B2.OTHER_KIN_1) | BT63SNIP |  |  |  |
| otherKin2Zen | 前年外販金額 |  | java.lang.String | - | SUM(B2.OTHER_KIN_2) | BT63SNIP |  |  |  |
| otherKen7Zen | 前年ネットテイク件数 |  | java.lang.String | - | SUM(B2.OTHER_KEN_7) | BT63SNIP |  |  |  |
| otherKen8Zen | 前年ネット宅配件数 |  | java.lang.String | - | SUM(B2.OTHER_KEN_8) | BT63SNIP |  |  |  |
| eatKenZen | 前年EAT-IN件数 |  | java.lang.String | - | SUM(B2.EAT_KEN) | BT63SNIP |  |  |  |
| takeKenZen | 前年TAKE-OUT件数 |  | java.lang.String | - | SUM(B2.TAKE_KEN) | BT63SNIP |  |  |  |
| telKenZen | 前年TEL-ORDER件数 |  | java.lang.String | - | SUM(B2.TEL_KEN) | BT63SNIP |  |  |  |
| driveKenZen | 前年DRV-TH件数 |  | java.lang.String | - | SUM(B2.DRIVE_KEN) | BT63SNIP |  |  |  |
| otherKen1Zen | 前年宅配件数 |  | java.lang.String | - | SUM(B2.OTHER_KEN_1) | BT63SNIP |  |  |  |
| otherKen2Zen | 前年外販件数 |  | java.lang.String | - | SUM(B2.OTHER_KEN_2) | BT63SNIP |  |  |  |

#### Dao情報
- ネット注文帳票情報(NetOrderReportDataDao)
- jp.co.isid.mos.bird.bizreport.netorderreport.dao.NetOrderReportDataDao
##### ネット注文帳票情報検索(selectNetOrderReport)

**パラメータ情報**

| パラメータ名 |
|------|
| 検索FROM日付 |
| 検索TO日付 |
| ソート順キー |

**SQL**

```sql
SELECT
     JIGYOU_CD              AS  JIGYOU_CD,
     JIGYOU_NAME            AS  JIGYOU_NAME,
     SLAREA_CD              AS  SLAREA_CD,
     SLAREA_NAME            AS  SLAREA_NAME,
     SIBU_CD                AS  SIBU_CD,
     SIBU_NAME              AS  SIBU_NAME,
     AREA_DAI               AS  AREA_DAI,
     AREA_NAME              AS  AREA_NAME,
     MISE_CD                AS  MISE_CD,
     MISE_NAME_KJ           AS  MISE_NAME_KJ,
     ONER_CD                AS  ONER_CD,
     ONER_NAME_KJ           AS  ONER_NAME_KJ,
     SUM(OTHER_KIN_7)       AS  OTHER_KIN_7,
     SUM(OTHER_KIN_8)       AS  OTHER_KIN_8,
     SUM(EAT_KIN)           AS  EAT_KIN,
     SUM(TAKE_KIN)          AS  TAKE_KIN,
     SUM(TEL_KIN)           AS  TEL_KIN,
     SUM(DRIVE_KIN)         AS  DRIVE_KIN,
     SUM(OTHER_KIN_1)       AS  OTHER_KIN_1,
     SUM(OTHER_KIN_2)       AS  OTHER_KIN_2,
     SUM(OTHER_KEN_7)       AS  OTHER_KEN_7,
     SUM(OTHER_KEN_8)       AS  OTHER_KEN_8,
     SUM(EAT_KEN)           AS  EAT_KEN,
     SUM(TAKE_KEN)          AS  TAKE_KEN,
     SUM(TEL_KEN)           AS  TEL_KEN,
     SUM(DRIVE_KEN)         AS  DRIVE_KEN,
     SUM(OTHER_KEN_1)       AS  OTHER_KEN_1,
     SUM(OTHER_KEN_2)       AS  OTHER_KEN_2,
     SUM(ZEN_OTHER_KIN_7)   AS  ZEN_OTHER_KIN_7,
     SUM(ZEN_OTHER_KIN_8)   AS  ZEN_OTHER_KIN_8,
     SUM(ZEN_EAT_KIN)       AS  ZEN_EAT_KIN,
     SUM(ZEN_TAKE_KIN)      AS  ZEN_TAKE_KIN,
     SUM(ZEN_TEL_KIN)       AS  ZEN_TEL_KIN,
     SUM(ZEN_DRIVE_KIN)     AS  ZEN_DRIVE_KIN,
     SUM(ZEN_OTHER_KIN_1)   AS  ZEN_OTHER_KIN_1,
     SUM(ZEN_OTHER_KIN_2)   AS  ZEN_OTHER_KIN_2,
     SUM(ZEN_OTHER_KEN_7)   AS  ZEN_OTHER_KEN_7,
     SUM(ZEN_OTHER_KEN_8)   AS  ZEN_OTHER_KEN_8,
     SUM(ZEN_EAT_KEN)       AS  ZEN_EAT_KEN,
     SUM(ZEN_TAKE_KEN)      AS  ZEN_TAKE_KEN,
     SUM(ZEN_TEL_KEN)       AS  ZEN_TEL_KEN,
     SUM(ZEN_DRIVE_KEN)     AS  ZEN_DRIVE_KEN,
     SUM(ZEN_OTHER_KEN_1)   AS  ZEN_OTHER_KEN_1,
     SUM(ZEN_OTHER_KEN_2)   AS  ZEN_OTHER_KEN_2
FROM
     (SELECT
           A1.EIGYO_DT,
           BM01TENM.COMPANY_CD,
           BM10GSIB.JIGYOU_CD,
           BM10GSIB.JIGYOU_NAME,
           BM10GSIB.SLAREA_CD,
           BM10GSIB.SLAREA_NAME,
           BM01TENM.SIBU_CD,
           BM10GSIB.SIBU_NAME,
           BM01TENM.AREA_DAI,
           BM10GSIB_AREA.SIBU_NAME AS AREA_NAME,
           A1.MISE_CD,
           BM01TENM.MISE_NAME_KJ,
           BM01TENM.ONER_CD,
           BM11ONER.ONER_NAME_KJ,
           BT63SNIP.OTHER_KIN_7,
           BT63SNIP.OTHER_KIN_8,
           BT63SNIP.EAT_KIN,
           BT63SNIP.TAKE_KIN,
           BT63SNIP.TEL_KIN,
           BT63SNIP.DRIVE_KIN,
           BT63SNIP.OTHER_KIN_1,
           BT63SNIP.OTHER_KIN_2,
           BT63SNIP.OTHER_KEN_7,
           BT63SNIP.OTHER_KEN_8,
           BT63SNIP.EAT_KEN,
           BT63SNIP.TAKE_KEN,
           BT63SNIP.TEL_KEN,
           BT63SNIP.DRIVE_KEN,
           BT63SNIP.OTHER_KEN_1,
           BT63SNIP.OTHER_KEN_2,
           0 AS ZEN_OTHER_KIN_7,
           0 AS ZEN_OTHER_KIN_8,
           0 AS ZEN_EAT_KIN,
           0 AS ZEN_TAKE_KIN,
           0 AS ZEN_TEL_KIN,
           0 AS ZEN_DRIVE_KIN,
           0 AS ZEN_OTHER_KIN_1,
           0 AS ZEN_OTHER_KIN_2,
           0 AS ZEN_OTHER_KEN_7,
           0 AS ZEN_OTHER_KEN_8,
           0 AS ZEN_EAT_KEN,
           0 AS ZEN_TAKE_KEN,
           0 AS ZEN_TEL_KEN,
           0 AS ZEN_DRIVE_KEN,
           0 AS ZEN_OTHER_KEN_1,
           0 AS ZEN_OTHER_KEN_2
         FROM
            BM11ONER
            INNER JOIN BM01TENM ON (BM01TENM.COMPANY_CD=BM11ONER.COMPANY_CD AND BM01TENM.ONER_CD=BM11ONER.ONER_CD)
            INNER JOIN BM10GSIB ON (BM01TENM.COMPANY_CD=BM10GSIB.COMPANY_CD AND BM01TENM.SIBU_CD=BM10GSIB.SIBU_CD)
            INNER JOIN BM10GSIB AS BM10GSIB_AREA ON (BM01TENM.COMPANY_CD=BM10GSIB_AREA.COMPANY_CD AND BM01TENM.AREA_DAI=BM10GSIB_AREA.SIBU_CD)
            ,BT63SNIP
            LEFT OUTER JOIN BM45ZDAY A1 ON (A1.EIGYO_DT = BT63SNIP.EIGYO_DT AND A1.COMPANY_CD = BT63SNIP.COMPANY_CD AND  A1.MISE_CD = BT63SNIP.MISE_CD )
         WHERE
            BM01TENM.COMPANY_CD = '00'
            AND  A1.COMPANY_CD = BM01TENM.COMPANY_CD AND A1.MISE_CD=BM01TENM.MISE_CD
            AND (A1.COMPANY_CD,A1.MISE_CD) NOT IN (SELECT COMPANY_CD,MISE_CD FROM BM82NOJT)
            AND A1.EIGYO_DT  BETWEEN /*staDate*/'20170907' AND  /*endDate*/'20180906'
            AND A1.OLDM_FLG='0' AND ( A1.OPEN_KBN=1 OR A1.OP_KBN_ZEN_DOGETU=1)
    UNION ALL
    SELECT
           A2.EIGYO_DT,
           BM01TENM.COMPANY_CD,
           BM10GSIB.JIGYOU_CD,
           BM10GSIB.JIGYOU_NAME,
           BM10GSIB.SLAREA_CD,
           BM10GSIB.SLAREA_NAME,
           BM01TENM.SIBU_CD,
           BM10GSIB.SIBU_NAME,
           BM01TENM.AREA_DAI,
           BM10GSIB_AREA.SIBU_NAME AS AREA_NAME,
           A2.MISE_CD,
           BM01TENM.MISE_NAME_KJ,
           BM01TENM.ONER_CD,
           BM11ONER.ONER_NAME_KJ,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           0,
           BT63SNIP.OTHER_KIN_7,
           BT63SNIP.OTHER_KIN_8,
           BT63SNIP.EAT_KIN,
           BT63SNIP.TAKE_KIN,
           BT63SNIP.TEL_KIN,
           BT63SNIP.DRIVE_KIN,
           BT63SNIP.OTHER_KIN_1,
           BT63SNIP.OTHER_KIN_2,
           BT63SNIP.OTHER_KEN_7,
           BT63SNIP.OTHER_KEN_8,
           BT63SNIP.EAT_KEN,
           BT63SNIP.TAKE_KEN,
           BT63SNIP.TEL_KEN,
           BT63SNIP.DRIVE_KEN,
           BT63SNIP.OTHER_KEN_1,
           BT63SNIP.OTHER_KEN_2
         FROM
            BM11ONER
            INNER JOIN BM01TENM ON (BM01TENM.COMPANY_CD=BM11ONER.COMPANY_CD AND BM01TENM.ONER_CD=BM11ONER.ONER_CD)
            INNER JOIN BM10GSIB ON (BM01TENM.COMPANY_CD=BM10GSIB.COMPANY_CD AND BM01TENM.SIBU_CD=BM10GSIB.SIBU_CD)
            INNER JOIN BM10GSIB AS BM10GSIB_AREA ON (BM01TENM.COMPANY_CD=BM10GSIB.COMPANY_CD AND BM01TENM.AREA_DAI=BM10GSIB_AREA.SIBU_CD)
            ,BT63SNIP
            LEFT OUTER JOIN BM45ZDAY A2 ON (A2.ZEN_DOGETU_DT = BT63SNIP.EIGYO_DT AND A2.COMPANY_CD = BT63SNIP.COMPANY_CD AND A2.ZEN_DOGETU_MISE = BT63SNIP.MISE_CD )
         WHERE
            BM01TENM.COMPANY_CD = '00'
            AND  A2.COMPANY_CD = BM01TENM.COMPANY_CD AND A2.MISE_CD=BM01TENM.MISE_CD
            AND (A2.COMPANY_CD,A2.MISE_CD) NOT IN (SELECT COMPANY_CD,MISE_CD FROM BM82NOJT)
            AND A2.EIGYO_DT  BETWEEN /*staDate*/'20170907' AND /*endDate*/'20180906'
            AND A2.OLDM_FLG='0' AND ( A2.OPEN_KBN=1 OR A2.OP_KBN_ZEN_DOGETU=1)
    )
GROUP BY
     JIGYOU_CD,
     JIGYOU_NAME,
     SLAREA_CD,
     SLAREA_NAME,
     SIBU_CD,
     SIBU_NAME,
     AREA_DAI,
     AREA_NAME,
     MISE_CD,
     MISE_NAME_KJ,
     ONER_CD,
     ONER_NAME_KJ
ORDER BY
/*IF orderByCd.equals("data")*/
    JIGYOU_CD,
    SLAREA_CD,
    SIBU_CD,
    AREA_DAI,
    MISE_CD
/*END*/
/*IF orderByCd.equals("data_area_dai")*/
    AREA_DAI,
    MISE_CD
/*END*/
```

#### 使用テーブル

| 論理名 | テーブル名 | 補足 |
|--------|------------|------|
| 営業日報（日次） | BT63SNIP | |
| 前年営業日情報 | BM45ZDAY | |
| グループ統合オーナマスタ | BM11ONER | |
| 店統合マスタ | BM01TENM | |
| 汎用店舗グループ（支部） | BM10GSIB | |
| ネット注文帳票除外店舗マスタ | BM82NOJT | |

#### サブクエリー: 本年データ

**JOIN情報**

|  | 営業日報（日次） | 前年営業日情報 | グループ統合オーナマスタ | 店統合マスタ | 汎用店舗グループ（支部） | ネット注文帳票除外店舗マスタ |
|------|------------------|----------------|--------------------------|--------------|--------------------------|------------------------------|
| テーブル | BT63SNIP | BM45ZDAY | BM11ONER | BM01TENM | BM10GSIB | BM82NOJT |
| カラム | 会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | |
|  | 店舗コード | ⇔店舗コード | | ⇔店舗コード | | |
|  | 営業日 | ⇔営業日 | | | | |
|  | | | | エリア大コード | ⇔支部コード | |
|  | | | オーナーコード | ⇔オーナーコード | | |
|  | | 会社コード, 店舗コード | | | | NOT IN (会社コード, 店舗コード) |

**矢印について**
- →、←：outerジョイン。矢印が向いている方がメイン
- ⇔：innerジョイン

#### サブクエリー: 前年データ

**JOIN情報**

|  | 営業日報（日次） | 前年営業日情報 | グループ統合オーナマスタ | 店統合マスタ | 汎用店舗グループ（支部） | ネット注文帳票除外店舗マスタ |
|------|------------------|----------------|--------------------------|--------------|--------------------------|------------------------------|
| テーブル | BT63SNIP | BM45ZDAY | BM11ONER | BM01TENM | BM10GSIB | BM82NOJT |
| カラム | 会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | |
|  | 店舗コード | ⇔前年同月店舗コード | | ⇔店舗コード | | |
|  | 営業日 | ⇔前年同月営業日 | | | | |
|  | | | | エリア大コード | ⇔支部コード | |
|  | | | オーナーコード | ⇔オーナーコード | | |
|  | | 会社コード, 店舗コード | | | | NOT IN (会社コード, 店舗コード) |

#### UNION ALL結合

| JOIN情報 | 本年データ | 前年データ |
|----------|------------|------------|
| カラム | 全てunion all | 全てunion all |

#### 条件

```
BM45ZDAY.EIGYO_DT BETWEEN パラメータ.検索FROM日付 AND パラメータ.検索TO日付
```

#### ソート情報

**パラメータのソートキー＝「data」の場合**

| カラム | 順序 |
|--------|------|
| JIGYOU_CD | 昇順 |
| SLAREA_CD | 昇順 |
| SIBU_CD | 昇順 |
| AREA_DAI | 昇順 |
| MISE_CD | 昇順 |

**パラメータのソートキー＝「data_area_dai」の場合**

| カラム | 順序 |
|--------|------|
| AREA_DAI | 昇順 |
| MISE_CD | 昇順 |

---

## 読み取りが難しかった項目

- シート「設定＆実行」に画像が含まれていますが、マークダウンへの埋め込みは行っていません。元のExcelファイルを参照してください。
- シート「NetOrderReportDataDao」に画像が含まれていますが、マークダウンへの埋め込みは行っていません。元のExcelファイルを参照してください。
- .wmf形式の画像が含まれている場合、openpyxlでは読み取りがサポートされていないため、画像の抽出ができませんでした。
- 結合セルを展開した結果、一部のレイアウトが元のExcelファイルと異なる場合があります。

## 不明点・不明瞭な点

- 一部の項目が空欄になっている箇所があります。意図的な省略か記載漏れかは確認が必要です。
- 略語や専門用語の定義については、別途用語集等を参照してください。
