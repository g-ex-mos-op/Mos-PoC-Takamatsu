# DN-030110-021.01 Dao設計書(ネット注文帳票)

## 概要

本文書は、ネット注文帳票システムにおけるDao（Data Access Object）設計書です。ネット注文帳票情報を取得するためのデータアクセス層の設計を定義しています。主な内容として、NetOrderReportDataDaoのエンティティ定義、プロパティ情報、SQL検索条件、テーブル結合情報、ソート条件などが含まれています。

## 文書情報

| 項目 | 内容 |
|------|------|
| 管理番号 | DN-030110-021.01 |
| 分類 | Dao設計書 |
| 作成者 | 王増文 |
| 作成日 | 2018/09/06 |
| 更新者 | 王増文 |
| 更新日 | 2018/09/06 |

## 更新履歴

| 作成・更新日 | 更新内容 | 作成・更新者 | レビュー/承認者 | レビュー/承認日 |
|--------------|----------|--------------|-----------------|-----------------|
| 2018-09-06 | 新規作成 | 王増文 | 田村雄一（レビュー）、竹内裕二（承認） | 2018-09-06 |

---

## 変更履歴

### 承認履歴

| バージョン | 変更管理NO | 作成担当者 | 作成日付 | レビュー担当者 | レビュー日付 | 承認担当者 | 承認日付 |
|------------|------------|------------|----------|----------------|--------------|------------|----------|
| 01 | ネット注文帳票 | 王増文 | 2018-09-06 | 田村雄一 | 2018-09-06 | 竹内裕二 | 2018-09-06 |

### 変更履歴

| バージョン | 変更内容 |
|------------|----------|
| 01 | 新規作成 |

---

## 設定＆実行

### 基本設定

| 項目 | 値 |
|------|-----|
| ドキュメント種別 | [BIRD]Dao設計書 |
| 管理番号 | DN-030110-021.01 |
| 分類 | Dao設計書 |
| エンティティ出力先 | C:\Temp |
| 更新者 | 王増文 |
| 更新日 | 2018/09/06 |
| 作成者 | 王増文 |
| 作成日 | 2018/09/06 |

### 作成対象シート

| シート名 |
|----------|
| 変更履歴 |
| ネット注文帳票情報取得(NetOrderReportDataDao) |

### 図: 設定画面

![設定画面1](./DN-030110-021.01%20Dao設計書(ネット注文帳票)_assets/images/image_3.png)

![設定画面2](./DN-030110-021.01%20Dao設計書(ネット注文帳票)_assets/images/image_1.jpeg)

![設定画面3](./DN-030110-021.01%20Dao設計書(ネット注文帳票)_assets/images/image_4.jpeg)

---

## NetOrderReportDataDao

### エンティティ情報

| 項目 | 値 |
|------|-----|
| エンティティ名 | ネット注文帳票情報(NetOrderReport) |
| テーブル名 | BT63SNIP |
| パッケージ | jp.co.isid.mos.bird.bizreport.netorderreport.entity.NetOrderReport |

### プロパティ情報

| プロパティ名 | 論理名 | Java型 | 列型 | 参照 | 対象テーブル |
|--------------|--------|--------|------|------|--------------|
| jigyouCd | 事業本部コード | java.lang.String | - | JIGYOU_CD | BM10GSIB |
| jigyouName | 事業本部名称 | java.lang.String | - | JIGYOU_NAME | BM10GSIB |
| slareaCd | 営業エリアコード | java.lang.String | - | SLAREA_CD | BM10GSIB |
| slareaName | 営業エリア名称 | java.lang.String | - | SLAREA_NAME | BM10GSIB |
| sibuCd | 支部コード | java.lang.String | - | SIBU_CD | BM01TENM |
| sibuName | 支部名称 | java.lang.String | - | SIBU_NAME | BM10GSIB |
| areaDai | 支部取込コード | java.lang.String | - | AREA_DAI | BM01TENM |
| areaName | 支部取込名 | java.lang.String | - | AREA_NAME | BM10GSIB |
| miseCd | 店コード | java.lang.String | - | MISE_CD | BM45ZDAY |
| miseNameKj | 店名称 | java.lang.String | - | MISE_NAME_KJ | BM01TENM |
| onerCd | オーナーコード | java.lang.String | - | ONER_CD | BM01TENM |
| onerNameKj | オーナー名称 | java.lang.String | - | ONER_NAME_KJ | BM11ONER |
| otherKin7 | ネットテイク金額 | java.lang.String | - | SUM(B1.OTHER_KIN_7) | BT63SNIP |
| otherKin8 | ネット宅配金額 | java.lang.String | - | SUM(B1.OTHER_KIN_8) | BT63SNIP |
| eat_kin | EAT-IN金額 | java.lang.String | - | SUM(B1.EAT_KIN) | BT63SNIP |
| takeKin | TAKE-OUT金額 | java.lang.String | - | SUM(B1.TAKE_KIN) | BT63SNIP |
| telKin | TEL-ORDER金額 | java.lang.String | - | SUM(B1.TEL_KIN) | BT63SNIP |
| driveKin | DRV-TH金額 | java.lang.String | - | SUM(B1.DRIVE_KIN) | BT63SNIP |
| otherKin1 | 宅配金額 | java.lang.String | - | SUM(B1.OTHER_KIN_1) | BT63SNIP |
| otherKin2 | 外販金額 | java.lang.String | - | SUM(B1.OTHER_KIN_2) | BT63SNIP |
| otherKen7 | ネットテイク件数 | java.lang.String | - | SUM(B1.OTHER_KEN_7) | BT63SNIP |
| otherKen8 | ネット宅配件数 | java.lang.String | - | SUM(B1.OTHER_KEN_8) | BT63SNIP |
| eatKen | EAT-IN件数 | java.lang.String | - | SUM(B1.EAT_KEN) | BT63SNIP |
| takeKen | TAKE-OUT件数 | java.lang.String | - | SUM(B1.TAKE_KEN) | BT63SNIP |
| telKen | TEL-ORDER件数 | java.lang.String | - | SUM(B1.TEL_KEN) | BT63SNIP |
| driveKen | DRV-TH件数 | java.lang.String | - | SUM(B1.DRIVE_KEN) | BT63SNIP |
| otherKen1 | 宅配件数 | java.lang.String | - | SUM(B1.OTHER_KEN_1) | BT63SNIP |
| otherKen2 | 外販件数 | java.lang.String | - | SUM(B1.OTHER_KEN_2) | BT63SNIP |
| otherKin7Zen | 前年ネットテイク金額 | java.lang.String | - | SUM(B2.OTHER_KIN_7) | BT63SNIP |
| otherKin8Zen | 前年ネット宅配金額 | java.lang.String | - | SUM(B2.OTHER_KIN_8) | BT63SNIP |
| eatKinZen | 前年EAT-IN金額 | java.lang.String | - | SUM(B2.EAT_KIN) | BT63SNIP |
| takeKinZen | 前年TAKE-OUT金額 | java.lang.String | - | SUM(B2.TAKE_KIN) | BT63SNIP |
| telKinZen | 前年TEL-ORDER金額 | java.lang.String | - | SUM(B2.TEL_KIN) | BT63SNIP |
| driveKinZen | 前年DRV-TH金額 | java.lang.String | - | SUM(B2.DRIVE_KIN) | BT63SNIP |
| otherKin1Zen | 前年宅配金額 | java.lang.String | - | SUM(B2.OTHER_KIN_1) | BT63SNIP |
| otherKin2Zen | 前年外販金額 | java.lang.String | - | SUM(B2.OTHER_KIN_2) | BT63SNIP |
| otherKen7Zen | 前年ネットテイク件数 | java.lang.String | - | SUM(B2.OTHER_KEN_7) | BT63SNIP |
| otherKen8Zen | 前年ネット宅配件数 | java.lang.String | - | SUM(B2.OTHER_KEN_8) | BT63SNIP |
| eatKenZen | 前年EAT-IN件数 | java.lang.String | - | SUM(B2.EAT_KEN) | BT63SNIP |
| takeKenZen | 前年TAKE-OUT件数 | java.lang.String | - | SUM(B2.TAKE_KEN) | BT63SNIP |
| telKenZen | 前年TEL-ORDER件数 | java.lang.String | - | SUM(B2.TEL_KEN) | BT63SNIP |
| driveKenZen | 前年DRV-TH件数 | java.lang.String | - | SUM(B2.DRIVE_KEN) | BT63SNIP |
| otherKen1Zen | 前年宅配件数 | java.lang.String | - | SUM(B2.OTHER_KEN_1) | BT63SNIP |
| otherKen2Zen | 前年外販件数 | java.lang.String | - | SUM(B2.OTHER_KEN_2) | BT63SNIP |

### Dao情報

| 項目 | 値 |
|------|-----|
| Dao名 | ネット注文帳票情報(NetOrderReportDataDao) |
| パッケージ | jp.co.isid.mos.bird.bizreport.netorderreport.dao.NetOrderReportDataDao |
| メソッド名 | ネット注文帳票情報検索(selectNetOrderReport) |

### パラメータ情報

| パラメータ名 | 説明 |
|--------------|------|
| 検索FROM日付 | 検索期間の開始日 |
| 検索TO日付 | 検索期間の終了日 |
| ソート順キー | ソート条件を指定するキー |

### 使用テーブル

| テーブル名 | テーブルID | 補足 |
|------------|------------|------|
| 営業日報（日次） | BT63SNIP | |
| 前年営業日情報 | BM45ZDAY | |
| グループ統合オーナマスタ | BM11ONER | |
| 店統合マスタ | BM01TENM | |
| 汎用店舗グループ（支部） | BM10GSIB | |
| ネット注文帳票除外店舗マスタ | BM82NOJT | |

### サブクエリー: 本年データ

#### JOIN情報

| 項目 | 営業日報（日次）<br>BT63SNIP | 前年営業日情報<br>BM45ZDAY | グループ統合オーナマスタ<br>BM11ONER | 店統合マスタ<br>BM01TENM | 汎用店舗グループ（支部）<br>BM10GSIB | ネット注文帳票除外店舗マスタ<br>BM82NOJT |
|------|------------------------------|----------------------------|--------------------------------------|--------------------------|--------------------------------------|----------------------------------------|
| カラム | 会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | |
| | 店舗コード | ⇔店舗コード | | ⇔店舗コード | | |
| | 営業日 | ⇔営業日 | | | | |
| | | | エリア大コード | | ⇔支部コード | |
| | | | オーナーコード | ⇔オーナーコード | | |
| | | 会社コード, 店舗コード | | | | NOT IN (会社コード, 店舗コード) |

**矢印について:**
- →、←：outerジョイン。矢印が向いている方がメイン
- ⇔：innerジョイン

### サブクエリー: 前年データ

#### JOIN情報

| 項目 | 営業日報（日次）<br>BT63SNIP | 前年営業日情報<br>BM45ZDAY | グループ統合オーナマスタ<br>BM11ONER | 店統合マスタ<br>BM01TENM | 汎用店舗グループ（支部）<br>BM10GSIB | ネット注文帳票除外店舗マスタ<br>BM82NOJT |
|------|------------------------------|----------------------------|--------------------------------------|--------------------------|--------------------------------------|----------------------------------------|
| カラム | 会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | ⇔会社コード | |
| | 店舗コード | ⇔前年同月店舗コード | | ⇔店舗コード | | |
| | 営業日 | ⇔前年同月営業日 | | | | |
| | | | エリア大コード | | ⇔支部コード | |
| | | | オーナーコード | ⇔オーナーコード | | |
| | | 会社コード, 店舗コード | | | | NOT IN (会社コード, 店舗コード) |

### UNION情報

| 項目 | 本年データ | 前年データ |
|------|------------|------------|
| カラム | 全てunion all | 全てunion all |

### 検索条件

```sql
BM45ZDAY.EIGYO_DT BETWEEN パラメータ.検索FROM日付 AND パラメータ.検索TO日付
```

### ソート情報

#### パラメータのソートキー＝「data」の場合

| カラム | 順序 |
|--------|------|
| JIGYOU_CD | 昇順 |
| SLAREA_CD | 昇順 |
| SIBU_CD | 昇順 |
| AREA_DAI | 昇順 |
| MISE_CD | 昇順 |

#### パラメータのソートキー＝「data_area_dai」の場合

| カラム | 順序 |
|--------|------|
| AREA_DAI | 昇順 |
| MISE_CD | 昇順 |

### 図: Dao設計

![Dao設計図](./DN-030110-021.01%20Dao設計書(ネット注文帳票)_assets/images/image_3.png)

---

## 読み取りが難しかった項目

以下の項目はExcel変換時に読み取りが困難であったか、情報が失われた可能性があります：

1. **画像の配置情報**: 画像は抽出できましたが、元のExcelファイルでの正確な配置位置（セル座標）は完全には再現できていません。画像は「設定＆実行」シートと「NetOrderReportDataDao」シートに含まれていました。

2. **結合セルのレイアウト**: 結合セルを展開して処理したため、元のレイアウトが完全に再現されていない箇所があります。特に「変更履歴」シートのヘッダー部分で結合セルが使用されていました。

3. **外部リンク画像**: 「設定＆実行」シートと「NetOrderReportDataDao」シートには外部URL（http://www.isid.co.jp/images/logo/0001.gif）への参照がありましたが、この画像は抽出できませんでした。

4. **SQL文の詳細**: 「NetOrderReportDataDao」シートにはSQL列への参照がありましたが、実際のSQL文の内容は空欄でした。

## 不明点・不明瞭な点

以下の点について、仕様として不明確または追加の確認が必要です：

1. **SQL文の詳細**: パラメータ情報セクションにSQL列への参照がありますが、実際のSQL文が記載されていません。完全なSQL文の確認が必要です。

2. **プロパティの説明列**: プロパティ情報テーブルの「説明」列は空欄になっています。各プロパティの詳細な説明が必要な場合は、別途確認が必要です。

3. **エンティティ出力先**: 「設定＆実行」シートに記載されている「C:\Temp」は開発環境固有の設定と思われますが、本番環境での出力先は別途確認が必要です。

4. **テーブル結合の詳細条件**: JOIN情報の一部で結合条件が省略されている箇所があります。完全な結合条件は元のExcelファイルまたは関連するSQL定義を参照してください。

5. **「設定＆実行」シートのFalse値**: シートの最下部に「False」という値がありますが、その意味や用途は不明です。
